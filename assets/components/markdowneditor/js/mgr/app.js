Ext.ns("MarkdownEditor"),MarkdownEditor=function(e){e=e||{},MarkdownEditor.superclass.constructor.call(this,e)},Ext.extend(MarkdownEditor,Ext.Component,{window:{},combo:{},config:{}}),Ext.reg("markdowneditor",MarkdownEditor),markdownEditor=new MarkdownEditor,markdownEditor.loadedElements={},markdownEditor.Editor=function(e){e=e||{},e.resource=MODx.request.id||0,markdownEditor.Editor.superclass.constructor.call(this,e),this.config=e},Ext.extend(markdownEditor.Editor,Ext.Component,{remarkable:"",fullScreen:!1,initComponent:function(){MarkdownEditor.superclass.initComponent.call(this),this.mdElementId&&Ext.onReady(this.render,this)},destroy:function(){this.editor.destroy(),this.mdContainer.remove(),this.taMarkdown.remove(),this.textarea.dom.style.display=null,this.textarea.dom.style.width=null,this.textarea.dom.style.height=null,MarkdownEditor.superclass.destroy.call(this)},render:function(){if(this.textarea=Ext.get(this.mdElementId),this.mdElementName=this.textarea.dom.name,this.textarea){this.buildUI(),this.registerAce(),this.registerMarked(),this.buildToolbox();var e=this.toolBox.child(".preview-button"),t=this.toolBox.child(".fullscreen-button"),i=this.toolBox.child(".splitscreen-button"),o=this.contentMD,r=Ext.get(Ext.DomHelper.append(o.parent(),{tag:"div","class":"preview-button-off",html:'<i class="icon icon-eye-slash icon-large"></i>',hidden:!0})),a=MODx.load({xtype:"modx-treedrop",target:o,targetEl:o,onInsert:function(e){return this.insert(e),this.focus(),!0}.bind(this.editor),iframe:!0});this.textarea.on("destroy",function(){a.destroy()});var n=parseInt(MODx.config["markdowneditor.general.split"]||0);1==n&&i.turnOn(),e.addListener("click",function(){this.showPreview(),this.hideContent(),this.statusBar.setDisplayed("none"),this.contentMD.parent().parent().addClass("preview"),r.show()},this),r.addListener("click",function(){this.hidePreview(),this.showContent(),this.statusBar.setDisplayed("block"),this.contentMD.parent().parent().removeClass("preview"),this.editor.focus(),r.hide()},this),i.addListener("click",function(){i.child("i").hasClass("icon-pause")?i.turnOn():i.turnOff()},this),t.addListener("click",function(){0==this.fullScreen?t.turnOn():t.turnOff(),this.statusBar.setDisplayed("block"),this.editor.resize(!0)},this),markdownEditor.content[this.mdElementName]&&this.editor.setValue(markdownEditor.content[this.mdElementName]),this.editor.selection.clearSelection(),this.preview.update(this.parse(this.editor.getValue())),this.preview.fixHeight(),this.editor.getSession().on("change",function(e){if("insertText"==e.data.action&&this.editor.getSession().getDocument().isNewLine(e.data.text)){var t=this.editor.getSession(),i=t.getDocument();null!=/^\s*(?:[*+-]|\d+\.)\s*$/.exec(i.getLine(e.data.range.start.row))&&i.removeLines(e.data.range.start.row,e.data.range.start.row)}this.parse(this.editor.getValue())}.bind(this))}},showContent:function(){this.contentMD.setDisplayed("block")},hideContent:function(){this.contentMD.setDisplayed("none")},showPreview:function(){this.preview.setDisplayed("block")},hidePreview:function(){this.preview.setDisplayed("none")},buildUI:function(){this.textarea.setDisplayed("none"),this.textarea.setWidth(0),this.textarea.setHeight(0),this.taMarkdown=Ext.get(Ext.DomHelper.insertBefore(this.textarea,{tag:"textarea",name:this.mdElementName+"_markdown","class":this.mdElementName+"_markdown"})),this.taMarkdown.setDisplayed("none"),this.taMarkdown.setWidth(0),this.taMarkdown.setHeight(0),this.mdContainer=Ext.get(Ext.DomHelper.insertBefore(this.textarea,{tag:"div","class":"markdown-container ace-"+(MODx.config["markdowneditor.general.theme"]||"monokai").toLowerCase()}));var e=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"fullscreen-header ace_gutter",html:'<input type="text" />'})),t=Ext.getCmp("modx-resource-pagetitle");if(t){var i=e.child("input");i.dom.value=t.getValue(),i.on("change",function(){t.setValue(this.dom.value)}),t.on("change",function(e,t){i.dom.value=t})}var o=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"markdown-wrapper"}));this.contentMD=Ext.get(Ext.DomHelper.append(o,{tag:"div","class":this.textarea.dom.className+" content-md "+this.mdElementName+"_markdown"})),this.preview=Ext.get(Ext.DomHelper.append(o,{tag:"div","class":"markdown-body preview-md"}));var r=this;this.preview.fixHeight=function(){var e=r.editor.getSession().getScreenLength()*r.editor.renderer.lineHeight+r.editor.renderer.scrollBar.getWidth()+30;this.setHeight(e)},1==MODx.config["markdowneditor.upload.enable_image_upload"]||1==MODx.config["markdowneditor.upload.enable_file_upload"]?(this.statusBar=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"status-bar ace_gutter"})),this.isMobileDevice()?(this.statusBar.dom.innerHTML='<div class="upload-bar"> <input class="hidden" name="md_file_'+this.statusBar.id+'" id="'+this.statusBar.id+'-file" type="file" multiple /><input class="hidden" name="md_file_'+this.statusBar.id+'-mobile" id="'+this.statusBar.id+'-file-mobile" type="file" accept="image/*" capture="camera" />'+_("markdowneditor.status_bar_message_mobile",{id:this.statusBar.id+"-file",id_mobile:this.statusBar.id+"-file-mobile"})+"</div>",this.statusBar.child("#"+this.statusBar.id+"-file-mobile").on("change",function(e,t){this.handleFiles(t.files,1),t.value=""},this)):(this.statusBar.dom.innerHTML='<div class="upload-bar"> <input class="hidden" name="md_file_'+this.statusBar.id+'" id="'+this.statusBar.id+'-file" type="file" multiple>'+_("markdowneditor.status_bar_message",{id:this.statusBar.id+"-file"})+"</div>",this.statusBar.child("#"+this.statusBar.id+"-file").on("change",function(e,t){this.handleFiles(t.files),t.value=""},this))):this.statusBar=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"status-bar",html:_("markdowneditor.status_bar_disabled")})),Ext.DomHelper.append(this.mdContainer.dom,{tag:"span",style:"clear: both"})},buildToolbox:function(){this.toolBox=Ext.get(Ext.DomHelper.append(this.statusBar,{tag:"div","class":"toolbox",cn:[{tag:"div","class":"preview-button",html:'<i class="icon icon-eye icon-large"></i>'},{tag:"div","class":"splitscreen-button",html:'<i class="icon icon-pause icon-large"></i>'},{tag:"div","class":"fullscreen-button",html:'<i class="icon icon-expand icon-large"></i>'}]}));var e=this;this.toolBox.child(".splitscreen-button").turnOn=function(){this.child("i").removeClass("icon-pause"),this.child("i").addClass("icon-stop"),e.contentMD.parent().parent().addClass("split")},this.toolBox.child(".splitscreen-button").turnOff=function(){this.child("i").addClass("icon-pause"),this.child("i").removeClass("icon-stop"),e.contentMD.parent().parent().removeClass("split")},this.toolBox.child(".fullscreen-button").turnOn=function(){this.child("i").removeClass("icon-expand"),this.child("i").addClass("icon-compress");var t=Ext.get("modx-action-buttons");t&&t.addClass("markdowneditor-fullscreen"),e.fullScreen=!0,1==parseInt(MODx.config["markdowneditor.general.split_fullscreen"]||1)?e.toolBox.child(".splitscreen-button").turnOn():e.toolBox.child(".splitscreen-button").turnOff(),e.showPreview(),e.showContent(),e.editor.focus(),e.contentMD.parent().parent().addClass("fullscreen"),e.editor.setOption("maxLines",null)},this.toolBox.child(".fullscreen-button").turnOff=function(){this.child("i").addClass("icon-expand"),this.child("i").removeClass("icon-compress");var t=Ext.get("modx-action-buttons");t&&t.removeClass("markdowneditor-fullscreen"),e.fullScreen=!1,1==parseInt(MODx.config["markdowneditor.general.split"]||0)?e.toolBox.child(".splitscreen-button").turnOn():e.toolBox.child(".splitscreen-button").turnOff(),e.hidePreview(),e.showContent(),e.editor.focus(),e.contentMD.parent().parent().removeClass("fullscreen"),e.editor.setOption("maxLines",1/0),e.preview.fixHeight()}},registerAce:function(){this.editor=ace.edit(Ext.DomQuery.selectNode("div."+this.mdElementName+"_markdown")),ace.require("ace/layer/gutter_toolbar"),this.editor.setOptions({maxLines:1/0,minLines:25,enableBasicAutocompletion:!0,printMargin:!1,showGutter:!0,useSoftTabs:!0,showFoldWidgets:!1,showLineNumbers:!1,fontSize:parseInt(MODx.config["markdowneditor.general.font_size"])||12,fontFamily:MODx.config["markdowneditor.general.font_family"]||""}),this.editor.getSession().setUseWrapMode(!0),this.editor.getSession().setWrapLimitRange(),this.editor.renderer.setScrollMargin(10,10),this.editor.getSession().setValue(this.textarea.getValue()),this.editor.getSession().setMode("ace/mode/markdowneditor"),this.editor.setTheme("ace/theme/"+(MODx.config["markdowneditor.general.theme"]||"monokai")),this.editor.selection.on("changeCursor",function(e,t){if(this.gutterToolbar&&this.gutterToolbar.update(""),""==t.session.doc.$lines[this.editor.getCursorPosition().row]){var i=Ext.DomQuery.selectNode("."+this.mdElementName+"_markdown .ace_gutter-cell:nth-child("+(this.editor.getCursorPosition().row+1)+")");i&&this.addGutterToolbar(i)}}.bind(this)),this.editor.session.gutterRenderer={getWidth:function(e,t,i){return i.characterWidth},getText:function(e,t,i){return i.element&&this.editor.getCursorPosition().row==t&&""==e.doc.$lines[t]?this.addGutterToolbar(i.element):i.element.innerHTML="",""}.bind(this)},this.editor.commands.addCommand({name:"Indent list",bindKey:{win:"Tab",mac:"Tab"},exec:function(e){var t=e.session.getLine(e.getCursorPosition().row),i=/^(\s*)(?:([-+*])|(\d+)\.)(\s+)/.exec(t);i?e.session.indentRows(e.getCursorPosition().row,e.getCursorPosition().row,"	"):e.indent()}}),this.editor.commands.addCommand({name:"Exit fullscreen",bindKey:{win:"Esc",mac:"Esc"},exec:function(){this.fullScreen&&this.toolBox.child(".fullscreen-button").turnOff()}.bind(this)});var e=ace.require("ace/ext/language_tools"),t={getCompletions:function(e,t,i,o,r){return 0===o.length?(r(null,[]),void 0):(MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/resource/getlist",prefix:o},listeners:{success:{fn:function(e){r(null,e.results)},scope:this}}}),void 0)}};e.addCompleter(t),this.editor.container.addEventListener("dragenter",this.catchAndDoNothing,!1),this.editor.container.addEventListener("dragover",this.catchAndDoNothing,!1),this.editor.container.addEventListener("drop",this.drop.bind(this),!1)},addGutterToolbar:function(e){this.gutterToolbar=Ext.get(e),this.gutterToolbar.update('<i class="icon icon-heart icon-large"></i><div class="inline-toolbar"><i class="icon icon-upload icon-large"></i><i class="icon icon-camera icon-large"></i></div>'),this.gutterToolbar.child("i").on("click",function(){var e=this.gutterToolbar.child("i"),t=this.gutterToolbar.child(".inline-toolbar"),i=t.child("i.icon-upload");i.on("click",function(){}),e.hasClass("icon-heart")?(e.addClass("icon-close"),e.removeClass("icon-heart"),t.show()):(e.addClass("icon-heart"),e.removeClass("icon-close"),t.hide())}.bind(this))},registerMarked:function(){this.remarkable=new Remarkable({html:!0,highlight:function(e,t){var i="";if(t&&hljs.getLanguage(t))try{return i=hljs.highlight(t,e).value,i=i.replace(/\[\[/g,"&#91;&#91;"),i=i.replace(/]]/g,"&#93;&#93;")}catch(o){}try{return i=hljs.highlightAuto(e).value,i=i.replace(/\[\[/g,"&#91;&#91;"),i=i.replace(/]]/g,"&#93;&#93;")}catch(o){}return""}}),this.remarkable.inline.ruler.disable(["backticks"])},parse:function(e){var t=this.remarkable.render(e);if(t=t.replace(/%5B/g,"["),t=t.replace(/%5D/g,"]"),1==MODx.config["markdowneditor.lp.parse_modx_tags"]){this.parseRequest&&clearTimeout(this.parseRequest);var i=parseInt(MODx.config["markdowneditor.lp.parse_modx_tags_timeout"]||300);this.parseRequest=setTimeout(function(){MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/editor/processcontent",content:t,resource:MODx.request.id},isUpload:!0,listeners:{success:{fn:function(e){this.preview.update(e.data),this.editor.getCursorPosition().row+2>=this.editor.getSession().getDocument().getLength()&&(this.preview.dom.scrollTop=this.preview.dom.scrollHeight),this.preview.fixHeight()},scope:this}}})}.bind(this),i)}else this.preview.update(t),this.editor.getCursorPosition().row+2>=this.editor.getSession().getDocument().getLength()&&(this.preview.dom.scrollTop=this.preview.dom.scrollHeight),this.preview.fixHeight();return this.taMarkdown.dom.value=this.editor.getValue(),this.textarea.dom.value=t,t},catchAndDoNothing:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault(),(1==MODx.config["markdowneditor.upload.enable_image_upload"]||1==MODx.config["markdowneditor.upload.enable_file_upload"])&&this.handleFiles(e.dataTransfer.files)},handleFiles:function(e,t){t=t||0,Ext.each(e,function(e){var i=/^image\//.test(e.type);if(i){if(0==MODx.config["markdowneditor.upload.enable_image_upload"])return!0;if(!this.checkType(MODx.config["markdowneditor.upload.image_types"],e))return this.failMessage(e,"image",_("markdowneditor.err.upload.unsupported_image")),!0;if(!this.checkSize(e.size))return this.failMessage(e,"image",_("markdowneditor.err.upload.too_big")),!0;1==MODx.config["markdowneditor.cropper.enable_cropper"]?MODx.load({xtype:"markdowneditor-window-cropper",file:e,md:this,mobile:t}).show():(this.uploadFile(e,"image",t),this.editor.focus())}else{if(0==MODx.config["markdowneditor.upload.enable_file_upload"])return!0;if(!this.checkType(MODx.config["markdowneditor.upload.file_types"],e))return this.failMessage(e,"file",_("markdowneditor.err.upload.unsupported_file")),!0;if(!this.checkSize(e.size))return this.failMessage(e,"file",_("markdowneditor.err.upload.too_big")),!0;this.uploadFile(e,"file"),this.editor.focus()}},this)},checkSize:function(e){var t=MODx.config["markdowneditor.upload.max_size"];return t&&""!=t||(t=MODx.config.upload_maxsize||"2097152"),t=parseInt(t),0==t?!0:t>=e},checkType:function(e,t){return e=e.split(","),-1!=e.indexOf(t.name.split(".").pop())},uploadFile:function(e,t,i){t=t||"file",i=i||0;var o=this.createUploader(),r=new FormData;r.append("file",e),r.append("action","mgr/editor/"+t+"upload"),r.append("name",e.name),r.append("resource",this.config.resource),r.append("mobile",i);var a=new XMLHttpRequest;a.open("POST",markdownEditor.config.connectorUrl),a.setRequestHeader("Powered-By","MODx"),a.setRequestHeader("modAuth",Ext.Ajax.defaultHeaders.modAuth),a.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;o.child(".progress").setWidth(t+"%")}}.bind(this),a.onload=function(){if(200===a.status){var e=JSON.parse(a.responseText);if(1==e.success){o.remove();var i="image"==t?"!":"",r="image"==t?"\n\n":"\n";this.editor.insert(i+"["+e.object.name+"]("+e.object.path+' "'+e.object.name+'")'+r)}else this.failUploader(o,e.message)}}.bind(this),a.send(r)},createUploader:function(e,t){var i=Ext.DomHelper.insertFirst(this.statusBar,{tag:"div",html:'<div class="progress"><i class="icon icon-spinner icon-spin"></i> <span>'+_("markdowneditor.uploading_"+e)+t+"</span></div>"});return Ext.get(i)},failUploader:function(e,t){e.child(".progress").addClass("error"),e.child(".progress").setWidth("100%"),e.child("i").addClass("remove-message"),e.child("i").replaceClass("icon-spinner","icon-remove"),e.child("i").removeClass("icon-spin"),e.child("span").dom.innerHTML+=" failed. "+t,e.child(".remove-message").on("click",function(){e.remove()})},failMessage:function(e,t,i){var o=this.createUploader(t,e.name);this.failUploader(o,i)},isMobileDevice:function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}}),MODx.loadRTE=function(e){new markdownEditor.Editor({mdElementId:e})},MODx.afterTVLoad=function(){var e=Ext.query("textarea.modx-richtext");Ext.each(e,function(e){return(e=Ext.get(e))?markdownEditor.loadedElements[e.id]?!0:(markdownEditor.loadedElements[e.id]=new markdownEditor.Editor({mdElementId:e.id}),void 0):!0})},MODx.unloadTVRTE=function(){var e=Ext.query(".modx-richtext");Ext.each(e,function(e){return(e=Ext.get(e))?markdownEditor.loadedElements[e.id]?(markdownEditor.loadedElements[e.id].destroy(),void 0):!0:!0})},markdownEditor.combo.CropperProfile=function(e){var t=JSON.parse(MODx.config["markdowneditor.cropper.profiles"]||"[]");e=e||{},Ext.applyIf(e,{store:new Ext.data.JsonStore({data:t,fields:["name","width","height","ratio"]}),displayField:"name",mode:"local",valueField:"name",editable:!1,value:t[0]?t[0].name:""});var i=parseInt(MODx.config["markdowneditor.cropper.show_description"]||0);i&&(e.tpl=new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-weight: bold">{name}</span>','<br /><tpl if="width">W:{width} </tpl><tpl if="height">H:{height} </tpl><tpl if="ratio">R:{ratio}</tpl></div></tpl>')),markdownEditor.combo.CropperProfile.superclass.constructor.call(this,e)},Ext.extend(markdownEditor.combo.CropperProfile,MODx.combo.ComboBox),Ext.reg("markdowneditor-combo-cropper-profile",markdownEditor.combo.CropperProfile),markdownEditor.window.Cropper=function(e){e=e||{},e.cropperSelector=e.cropperSelector||".image-upload-wrapper > img";var t=Ext.id();Ext.applyIf(e,{modal:!1,layout:"auto",closeAction:"hide",shadow:!0,resizable:!0,collapsible:!0,maximizable:!1,autoHeight:!1,autoScroll:!0,allowDrop:!0,width:800,mobile:0,title:_("markdowneditor.cropper.crop_image"),cls:"modx-window markdowneditor-cropper-window",items:[{layout:"column",border:!1,defaults:{layout:"form",labelAlign:"top",labelSeparator:"",anchor:"100%",border:!1},items:[{columnWidth:.1,defaults:{msgTarget:"under",anchor:"100%"},cls:"markdowneditor-toolbar",items:[{xtype:"button",text:'<i class="icon icon-arrows icon-large"></i>',tooltip:_("markdowneditor.cropper.move"),scope:this,param:"move",action:"setDragMode",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-crop icon-large"></i>',tooltip:_("markdowneditor.cropper.crop"),scope:this,param:"crop",action:"setDragMode",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-search-plus icon-large"></i>',tooltip:_("markdowneditor.cropper.zoom_in"),scope:this,param:.1,action:"zoom",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-search-minus icon-large"></i>',tooltip:_("markdowneditor.cropper.zoom_out"),scope:this,param:-.1,action:"zoom",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-rotate-left icon-large"></i>',tooltip:_("markdowneditor.cropper.rotate_left"),scope:this,param:-90,action:"rotate",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-rotate-right icon-large"></i>',tooltip:_("markdowneditor.cropper.rotate_right"),scope:this,param:90,action:"rotate",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-remove icon-large"></i>',tooltip:_("markdowneditor.cropper.clear_cropper"),scope:this,param:null,action:"clear",handler:this.callCropperAction}]},{columnWidth:.9,defaults:{msgTarget:"under",anchor:"100%"},cls:"markdowneditor-cropper",items:[{html:'<div class="image-upload-wrapper"><img src="'+URL.createObjectURL(e.file)+'"></div>'}]}]}],bbar:[{xtype:"markdowneditor-combo-cropper-profile",id:t+"-cropper-profile",listeners:{select:{fn:function(e,t){this.changeCropperProfile(t.data)},scope:this}}},"->",{text:_("cancel"),scope:this,handler:this.close},{text:_("markdowneditor.cropper.upload"),cls:"primary-button",scope:this,crop:0,handler:this.upload},{text:_("markdowneditor.cropper.crop_upload"),cls:"primary-button",scope:this,crop:1,handler:this.upload}],listeners:{show:{fn:function(){var i={};this.$cropperEl=$("#"+this.id+" "+e.cropperSelector),i.crop=function(e){this.imageData=['{"x":'+e.x,'"y":'+e.y,'"height":'+e.height,'"width":'+e.width,'"rotate":'+e.rotate+"}"].join()}.bind(this),this.$cropperEl.cropper(i);var o=Ext.getCmp(t+"-cropper-profile").store.getAt(0);this.changeCropperProfile(o.data)},scope:this}}}),markdownEditor.window.Cropper.superclass.constructor.call(this,e),this.config=e},Ext.extend(markdownEditor.window.Cropper,Ext.Window,{imageData:"",cropperProfile:{name:""},changeCropperProfile:function(profile){var ratio;if(""!=profile.ratio)ratio=profile.ratio,ratio.replace(/[^-:x()\d/*+.]/g,""),ratio=eval(ratio)||0/0;else if(profile.width&&profile.height){var width=parseInt(profile.width),height=parseInt(profile.height);ratio=width>0&&height>0?width/height:0/0}else ratio=0/0;this.cropperProfile=profile,this.callCropperAction({action:"setAspectRatio",param:ratio})},upload:function(e){var t=this.config.md.createUploader("image",this.config.file.name),i=new FormData;i.append("file",this.config.file),i.append("action","mgr/editor/imageupload"),i.append("imageData",this.imageData),i.append("name",this.config.file.name),i.append("crop",e.crop),i.append("resource",this.config.md.config.resource),i.append("mobile",this.config.mobile),i.append("profile",this.cropperProfile.name);var o=new XMLHttpRequest;o.open("POST",markdownEditor.config.connectorUrl),o.setRequestHeader("Powered-By","MODx"),o.setRequestHeader("modAuth",Ext.Ajax.defaultHeaders.modAuth),o.upload.onprogress=function(e){if(e.lengthComputable){var i=e.loaded/e.total*100|0;t.child(".progress").setWidth(i+"%")}}.bind(this),o.onload=function(){if(200===o.status){var e=JSON.parse(o.responseText);1==e.success?(t.remove(),this.config.md.editor.insert("!["+e.object.name+"]("+e.object.path+' "'+e.object.name+'")\n\n')):this.config.md.failUploader(t,e.message)}}.bind(this),o.send(i),this.close()},callCropperAction:function(e){this.$cropperEl.cropper(e.action,e.param)},close:function(){this.$cropperEl.cropper("destroy"),markdownEditor.window.Cropper.superclass.close.call(this),this.config.md.editor.focus()}}),Ext.reg("markdowneditor-window-cropper",markdownEditor.window.Cropper);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbWJvLmpzIiwibWFya2Rvd25lZGl0b3Iud2luZG93LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsR0FBQSxrQkFDQSxlQUFBLFNBQUEsR0FDQSxFQUFBLE1BQ0EsZUFBQSxXQUFBLFlBQUEsS0FBQSxLQUFBLElBRUEsSUFBQSxPQUFBLGVBQUEsSUFBQSxXQUNBLFVBQUEsU0FBQSxZQUVBLElBQUEsSUFBQSxpQkFBQSxnQkFDQSxlQUFBLEdBQUEsZ0JBRUEsZUFBQSxrQkFFQSxlQUFBLE9BQUEsU0FBQSxHQUNBLEVBQUEsTUFDQSxFQUFBLFNBQUEsS0FBQSxRQUFBLElBQUEsRUFDQSxlQUFBLE9BQUEsV0FBQSxZQUFBLEtBQUEsS0FBQSxHQUNBLEtBQUEsT0FBQSxHQUVBLElBQUEsT0FBQSxlQUFBLE9BQUEsSUFBQSxXQUNBLFdBQUEsR0FDQSxZQUFBLEVBQ0EsY0FBQSxXQUNBLGVBQUEsV0FBQSxjQUFBLEtBQUEsTUFFQSxLQUFBLGFBQ0EsSUFBQSxRQUFBLEtBQUEsT0FBQSxPQUlBLFFBQUEsV0FDQSxLQUFBLE9BQUEsVUFFQSxLQUFBLFlBQUEsU0FDQSxLQUFBLFdBQUEsU0FFQSxLQUFBLFNBQUEsSUFBQSxNQUFBLFFBQUEsS0FDQSxLQUFBLFNBQUEsSUFBQSxNQUFBLE1BQUEsS0FDQSxLQUFBLFNBQUEsSUFBQSxNQUFBLE9BQUEsS0FFQSxlQUFBLFdBQUEsUUFBQSxLQUFBLE9BR0EsT0FBQSxXQUlBLEdBSEEsS0FBQSxTQUFBLElBQUEsSUFBQSxLQUFBLGFBQ0EsS0FBQSxjQUFBLEtBQUEsU0FBQSxJQUFBLEtBRUEsS0FBQSxTQUFBLENBRUEsS0FBQSxVQUNBLEtBQUEsY0FDQSxLQUFBLGlCQUNBLEtBQUEsY0FFQSxJQUFBLEdBQUEsS0FBQSxRQUFBLE1BQUEsbUJBQ0EsRUFBQSxLQUFBLFFBQUEsTUFBQSxzQkFDQSxFQUFBLEtBQUEsUUFBQSxNQUFBLHVCQUVBLEVBQUEsS0FBQSxVQUVBLEVBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEVBQUEsVUFDQSxJQUFBLE1BQ0EsUUFBQSxxQkFDQSxLQUFBLGlEQUNBLFFBQUEsS0FHQSxFQUFBLEtBQUEsTUFDQSxNQUFBLGdCQUNBLE9BQUEsRUFDQSxTQUFBLEVBQ0EsU0FBQSxTQUFBLEdBR0EsTUFGQSxNQUFBLE9BQUEsR0FDQSxLQUFBLFNBQ0EsR0FDQSxLQUFBLEtBQUEsUUFDQSxRQUFBLEdBRUEsTUFBQSxTQUFBLEdBQUEsVUFBQSxXQUFBLEVBQUEsV0FFQSxJQUFBLEdBQUEsU0FBQSxLQUFBLE9BQUEsaUNBQUEsRUFDQSxJQUFBLEdBQ0EsRUFBQSxTQUVBLEVBQUEsWUFBQSxRQUFBLFdBQ0EsS0FBQSxjQUNBLEtBQUEsY0FDQSxLQUFBLFVBQUEsYUFBQSxRQUVBLEtBQUEsVUFBQSxTQUFBLFNBQUEsU0FBQSxXQUVBLEVBQUEsUUFDQSxNQUVBLEVBQUEsWUFBQSxRQUFBLFdBQ0EsS0FBQSxjQUNBLEtBQUEsY0FDQSxLQUFBLFVBQUEsYUFBQSxTQUVBLEtBQUEsVUFBQSxTQUFBLFNBQUEsWUFBQSxXQUVBLEtBQUEsT0FBQSxRQUVBLEVBQUEsUUFDQSxNQUVBLEVBQUEsWUFBQSxRQUFBLFdBQ0EsRUFBQSxNQUFBLEtBQUEsU0FBQSxjQUNBLEVBQUEsU0FFQSxFQUFBLFdBRUEsTUFFQSxFQUFBLFlBQUEsUUFBQSxXQUNBLEdBQUEsS0FBQSxXQUNBLEVBQUEsU0FFQSxFQUFBLFVBR0EsS0FBQSxVQUFBLGFBQUEsU0FDQSxLQUFBLE9BQUEsUUFBQSxJQUVBLE1BRUEsZUFBQSxRQUFBLEtBQUEsZ0JBQ0EsS0FBQSxPQUFBLFNBQUEsZUFBQSxRQUFBLEtBQUEsZ0JBRUEsS0FBQSxPQUFBLFVBQUEsaUJBRUEsS0FBQSxRQUFBLE9BQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxhQUVBLEtBQUEsUUFBQSxZQUVBLEtBQUEsT0FBQSxhQUFBLEdBQUEsU0FBQSxTQUFBLEdBQ0EsR0FBQSxjQUFBLEVBQUEsS0FBQSxRQUFBLEtBQUEsT0FBQSxhQUFBLGNBQUEsVUFBQSxFQUFBLEtBQUEsTUFBQSxDQUNBLEdBQUEsR0FBQSxLQUFBLE9BQUEsYUFDQSxFQUFBLEVBQUEsYUFFQSxPQUFBLDBCQUFBLEtBQUEsRUFBQSxRQUFBLEVBQUEsS0FBQSxNQUFBLE1BQUEsT0FDQSxFQUFBLFlBQUEsRUFBQSxLQUFBLE1BQUEsTUFBQSxJQUFBLEVBQUEsS0FBQSxNQUFBLE1BQUEsS0FJQSxLQUFBLE1BQUEsS0FBQSxPQUFBLGFBQ0EsS0FBQSxTQUdBLFlBQUEsV0FDQSxLQUFBLFVBQUEsYUFBQSxVQUdBLFlBQUEsV0FDQSxLQUFBLFVBQUEsYUFBQSxTQUdBLFlBQUEsV0FDQSxLQUFBLFFBQUEsYUFBQSxVQUdBLFlBQUEsV0FDQSxLQUFBLFFBQUEsYUFBQSxTQUdBLFFBQUEsV0FDQSxLQUFBLFNBQUEsYUFBQSxRQUNBLEtBQUEsU0FBQSxTQUFBLEdBQ0EsS0FBQSxTQUFBLFVBQUEsR0FFQSxLQUFBLFdBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxhQUFBLEtBQUEsVUFDQSxJQUFBLFdBQ0EsS0FBQSxLQUFBLGNBQUEsWUFDQSxRQUFBLEtBQUEsY0FBQSxlQUdBLEtBQUEsV0FBQSxhQUFBLFFBQ0EsS0FBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLFdBQUEsVUFBQSxHQUVBLEtBQUEsWUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLGFBQUEsS0FBQSxVQUNBLElBQUEsTUFDQSxRQUFBLDJCQUFBLEtBQUEsT0FBQSxpQ0FBQSxXQUFBLGdCQUdBLElBQUEsR0FBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxZQUFBLEtBQ0EsSUFBQSxNQUNBLFFBQUEsK0JBQ0EsS0FBQSwyQkFHQSxFQUFBLElBQUEsT0FBQSwwQkFDQSxJQUFBLEVBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxNQUFBLFFBQ0EsR0FBQSxJQUFBLE1BQUEsRUFBQSxXQUVBLEVBQUEsR0FBQSxTQUFBLFdBQ0EsRUFBQSxTQUFBLEtBQUEsSUFBQSxTQUdBLEVBQUEsR0FBQSxTQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsSUFBQSxNQUFBLElBSUEsR0FBQSxHQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxLQUFBLFlBQUEsS0FDQSxJQUFBLE1BQ0EsUUFBQSxxQkFHQSxNQUFBLFVBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEdBQ0EsSUFBQSxNQUNBLFFBQUEsS0FBQSxTQUFBLElBQUEsVUFBQSxlQUFBLEtBQUEsY0FBQSxlQUdBLEtBQUEsUUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsR0FDQSxJQUFBLE1BQ0EsUUFBQSw2QkFHQSxJQUFBLEdBQUEsSUFDQSxNQUFBLFFBQUEsVUFBQSxXQUNBLEdBQUEsR0FBQSxFQUFBLE9BQUEsYUFBQSxrQkFBQSxFQUFBLE9BQUEsU0FBQSxXQUFBLEVBQUEsT0FBQSxTQUFBLFVBQUEsV0FBQSxFQUVBLE1BQUEsVUFBQSxJQUdBLEdBQUEsS0FBQSxPQUFBLDhDQUFBLEdBQUEsS0FBQSxPQUFBLDZDQUNBLEtBQUEsVUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxZQUFBLEtBQ0EsSUFBQSxNQUNBLFFBQUEsMkJBR0EsS0FBQSxrQkFDQSxLQUFBLFVBQUEsSUFBQSxVQUFBLGdFQUFBLEtBQUEsVUFBQSxHQUFBLFNBQUEsS0FBQSxVQUFBLEdBQUEscUVBQUEsS0FBQSxVQUFBLEdBQUEsZ0JBQUEsS0FBQSxVQUFBLEdBQUEsaUVBQUEsRUFBQSw0Q0FBQSxHQUFBLEtBQUEsVUFBQSxHQUFBLFFBQUEsVUFBQSxLQUFBLFVBQUEsR0FBQSxpQkFBQSxTQUVBLEtBQUEsVUFBQSxNQUFBLElBQUEsS0FBQSxVQUFBLEdBQUEsZ0JBQUEsR0FBQSxTQUFBLFNBQUEsRUFBQSxHQUNBLEtBQUEsWUFBQSxFQUFBLE1BQUEsR0FDQSxFQUFBLE1BQUEsSUFDQSxRQUVBLEtBQUEsVUFBQSxJQUFBLFVBQUEsZ0VBQUEsS0FBQSxVQUFBLEdBQUEsU0FBQSxLQUFBLFVBQUEsR0FBQSwrQkFBQSxFQUFBLHFDQUFBLEdBQUEsS0FBQSxVQUFBLEdBQUEsVUFBQSxTQUVBLEtBQUEsVUFBQSxNQUFBLElBQUEsS0FBQSxVQUFBLEdBQUEsU0FBQSxHQUFBLFNBQUEsU0FBQSxFQUFBLEdBQ0EsS0FBQSxZQUFBLEVBQUEsT0FDQSxFQUFBLE1BQUEsSUFDQSxRQUlBLEtBQUEsVUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxZQUFBLEtBQ0EsSUFBQSxNQUNBLFFBQUEsYUFDQSxLQUFBLEVBQUEseUNBSUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxZQUFBLEtBQ0EsSUFBQSxPQUNBLE1BQUEsaUJBSUEsYUFBQSxXQUNBLEtBQUEsUUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxXQUNBLElBQUEsTUFDQSxRQUFBLFVBQ0EsS0FDQSxJQUFBLE1BQ0EsUUFBQSxpQkFDQSxLQUFBLDZDQUVBLElBQUEsTUFDQSxRQUFBLHFCQUNBLEtBQUEsK0NBRUEsSUFBQSxNQUNBLFFBQUEsb0JBQ0EsS0FBQSxrREFJQSxJQUFBLEdBQUEsSUFFQSxNQUFBLFFBQUEsTUFBQSx1QkFBQSxPQUFBLFdBQ0EsS0FBQSxNQUFBLEtBQUEsWUFBQSxjQUNBLEtBQUEsTUFBQSxLQUFBLFNBQUEsYUFFQSxFQUFBLFVBQUEsU0FBQSxTQUFBLFNBQUEsVUFHQSxLQUFBLFFBQUEsTUFBQSx1QkFBQSxRQUFBLFdBQ0EsS0FBQSxNQUFBLEtBQUEsU0FBQSxjQUNBLEtBQUEsTUFBQSxLQUFBLFlBQUEsYUFFQSxFQUFBLFVBQUEsU0FBQSxTQUFBLFlBQUEsVUFHQSxLQUFBLFFBQUEsTUFBQSxzQkFBQSxPQUFBLFdBQ0EsS0FBQSxNQUFBLEtBQUEsWUFBQSxlQUNBLEtBQUEsTUFBQSxLQUFBLFNBQUEsZ0JBRUEsSUFBQSxHQUFBLElBQUEsSUFBQSxzQkFDQSxJQUNBLEVBQUEsU0FBQSw2QkFHQSxFQUFBLFlBQUEsRUFFQSxHQUFBLFNBQUEsS0FBQSxPQUFBLDRDQUFBLEdBQ0EsRUFBQSxRQUFBLE1BQUEsdUJBQUEsU0FFQSxFQUFBLFFBQUEsTUFBQSx1QkFBQSxVQUdBLEVBQUEsY0FDQSxFQUFBLGNBRUEsRUFBQSxPQUFBLFFBRUEsRUFBQSxVQUFBLFNBQUEsU0FBQSxTQUFBLGNBRUEsRUFBQSxPQUFBLFVBQUEsV0FBQSxPQUdBLEtBQUEsUUFBQSxNQUFBLHNCQUFBLFFBQUEsV0FDQSxLQUFBLE1BQUEsS0FBQSxTQUFBLGVBQ0EsS0FBQSxNQUFBLEtBQUEsWUFBQSxnQkFFQSxJQUFBLEdBQUEsSUFBQSxJQUFBLHNCQUNBLElBQ0EsRUFBQSxZQUFBLDZCQUdBLEVBQUEsWUFBQSxFQUVBLEdBQUEsU0FBQSxLQUFBLE9BQUEsaUNBQUEsR0FDQSxFQUFBLFFBQUEsTUFBQSx1QkFBQSxTQUVBLEVBQUEsUUFBQSxNQUFBLHVCQUFBLFVBR0EsRUFBQSxjQUNBLEVBQUEsY0FFQSxFQUFBLE9BQUEsUUFFQSxFQUFBLFVBQUEsU0FBQSxTQUFBLFlBQUEsY0FFQSxFQUFBLE9BQUEsVUFBQSxXQUFBLEtBRUEsRUFBQSxRQUFBLGNBSUEsWUFBQSxXQUNBLEtBQUEsT0FBQSxJQUFBLEtBQUEsSUFBQSxTQUFBLFdBQUEsT0FBQSxLQUFBLGNBQUEsY0FDQSxJQUFBLFFBQUEsNEJBRUEsS0FBQSxPQUFBLFlBQ0EsU0FBQSxJQUNBLFNBQUEsR0FDQSwyQkFBQSxFQUNBLGFBQUEsRUFDQSxZQUFBLEVBQ0EsYUFBQSxFQUNBLGlCQUFBLEVBQ0EsaUJBQUEsRUFDQSxTQUFBLFNBQUEsS0FBQSxPQUFBLHNDQUFBLEdBQ0EsV0FBQSxLQUFBLE9BQUEsdUNBQUEsS0FFQSxLQUFBLE9BQUEsYUFBQSxnQkFBQSxHQUNBLEtBQUEsT0FBQSxhQUFBLG9CQUNBLEtBQUEsT0FBQSxTQUFBLGdCQUFBLEdBQUEsSUFDQSxLQUFBLE9BQUEsYUFBQSxTQUFBLEtBQUEsU0FBQSxZQUNBLEtBQUEsT0FBQSxhQUFBLFFBQUEsMkJBQ0EsS0FBQSxPQUFBLFNBQUEsY0FBQSxLQUFBLE9BQUEsaUNBQUEsWUFFQSxLQUFBLE9BQUEsVUFBQSxHQUFBLGVBQUEsU0FBQSxFQUFBLEdBS0EsR0FKQSxLQUFBLGVBQ0EsS0FBQSxjQUFBLE9BQUEsSUFHQSxJQUFBLEVBQUEsUUFBQSxJQUFBLE9BQUEsS0FBQSxPQUFBLG9CQUFBLEtBQUEsQ0FDQSxHQUFBLEdBQUEsSUFBQSxTQUFBLFdBQUEsSUFBQSxLQUFBLGNBQUEseUNBQUEsS0FBQSxPQUFBLG9CQUFBLElBQUEsR0FBQSxJQUNBLElBQ0EsS0FBQSxpQkFBQSxLQUdBLEtBQUEsT0FFQSxLQUFBLE9BQUEsUUFBQSxnQkFDQSxTQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsTUFBQSxHQUFBLGdCQUVBLFFBQUEsU0FBQSxFQUFBLEVBQUEsR0FPQSxNQU5BLEdBQUEsU0FBQSxLQUFBLE9BQUEsb0JBQUEsS0FBQSxHQUFBLElBQUEsRUFBQSxJQUFBLE9BQUEsR0FDQSxLQUFBLGlCQUFBLEVBQUEsU0FFQSxFQUFBLFFBQUEsVUFBQSxHQUdBLElBQ0EsS0FBQSxPQUdBLEtBQUEsT0FBQSxTQUFBLFlBQ0EsS0FBQSxjQUNBLFNBQUEsSUFBQSxNQUFBLElBQUEsT0FDQSxLQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxRQUFBLFFBQUEsRUFBQSxvQkFBQSxLQUNBLEVBQUEsaUNBQUEsS0FBQSxFQUNBLEdBQ0EsRUFBQSxRQUFBLFdBQUEsRUFBQSxvQkFBQSxJQUFBLEVBQUEsb0JBQUEsSUFBQSxLQUVBLEVBQUEsWUFLQSxLQUFBLE9BQUEsU0FBQSxZQUNBLEtBQUEsa0JBQ0EsU0FBQSxJQUFBLE1BQUEsSUFBQSxPQUNBLEtBQUEsV0FDQSxLQUFBLFlBQ0EsS0FBQSxRQUFBLE1BQUEsc0JBQUEsV0FFQSxLQUFBLE9BR0EsSUFBQSxHQUFBLElBQUEsUUFBQSwwQkFDQSxHQUNBLGVBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsTUFBQSxLQUFBLEVBQUEsUUFBQSxFQUFBLFNBQUEsU0FFQSxLQUFBLEtBQUEsU0FDQSxJQUFBLGVBQUEsT0FBQSxhQUNBLFFBQ0EsT0FBQSx1QkFDQSxPQUFBLEdBRUEsV0FDQSxTQUNBLEdBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxFQUFBLFVBRUEsTUFBQSxTQVhBLFNBa0JBLEdBQUEsYUFBQSxHQUVBLEtBQUEsT0FBQSxVQUFBLGlCQUFBLFlBQUEsS0FBQSxtQkFBQSxHQUNBLEtBQUEsT0FBQSxVQUFBLGlCQUFBLFdBQUEsS0FBQSxtQkFBQSxHQUNBLEtBQUEsT0FBQSxVQUFBLGlCQUFBLE9BQUEsS0FBQSxLQUFBLEtBQUEsT0FBQSxJQUdBLGlCQUFBLFNBQUEsR0FDQSxLQUFBLGNBQUEsSUFBQSxJQUFBLEdBQ0EsS0FBQSxjQUFBLE9BQUEsc0tBRUEsS0FBQSxjQUFBLE1BQUEsS0FBQSxHQUFBLFFBQUEsV0FDQSxHQUFBLEdBQUEsS0FBQSxjQUFBLE1BQUEsS0FDQSxFQUFBLEtBQUEsY0FBQSxNQUFBLG1CQUVBLEVBQUEsRUFBQSxNQUFBLGdCQUNBLEdBQUEsR0FBQSxRQUFBLGNBSUEsRUFBQSxTQUFBLGVBQ0EsRUFBQSxTQUFBLGNBQ0EsRUFBQSxZQUFBLGNBRUEsRUFBQSxTQUVBLEVBQUEsU0FBQSxjQUNBLEVBQUEsWUFBQSxjQUVBLEVBQUEsU0FFQSxLQUFBLFFBR0EsZUFBQSxXQUNBLEtBQUEsV0FBQSxHQUFBLGFBQ0EsTUFBQSxFQUNBLFVBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQ0EsSUFBQSxHQUFBLEtBQUEsWUFBQSxHQUNBLElBTUEsTUFMQSxHQUFBLEtBQUEsVUFBQSxFQUFBLEdBQUEsTUFFQSxFQUFBLEVBQUEsUUFBQSxRQUFBLGNBQ0EsRUFBQSxFQUFBLFFBQUEsTUFBQSxjQUdBLE1BQUEsSUFHQSxJQU1BLE1BTEEsR0FBQSxLQUFBLGNBQUEsR0FBQSxNQUVBLEVBQUEsRUFBQSxRQUFBLFFBQUEsY0FDQSxFQUFBLEVBQUEsUUFBQSxNQUFBLGNBR0EsTUFBQSxJQUVBLE1BQUEsTUFHQSxLQUFBLFdBQUEsT0FBQSxNQUFBLFNBQUEsZUFHQSxNQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxXQUFBLE9BQUEsRUFLQSxJQUhBLEVBQUEsRUFBQSxRQUFBLE9BQUEsS0FDQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBRUEsR0FBQSxLQUFBLE9BQUEscUNBQUEsQ0FDQSxLQUFBLGNBQ0EsYUFBQSxLQUFBLGFBR0EsSUFBQSxHQUFBLFNBQUEsS0FBQSxPQUFBLDhDQUFBLElBRUEsTUFBQSxhQUFBLFdBQUEsV0FDQSxLQUFBLEtBQUEsU0FDQSxJQUFBLGVBQUEsT0FBQSxhQUNBLFFBQ0EsT0FBQSw0QkFDQSxRQUFBLEVBQ0EsU0FBQSxLQUFBLFFBQUEsSUFFQSxVQUFBLEVBQ0EsV0FDQSxTQUNBLEdBQUEsU0FBQSxHQUNBLEtBQUEsUUFBQSxPQUFBLEVBQUEsTUFFQSxLQUFBLE9BQUEsb0JBQUEsSUFBQSxHQUFBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FDQSxLQUFBLFFBQUEsSUFBQSxVQUFBLEtBQUEsUUFBQSxJQUFBLGNBR0EsS0FBQSxRQUFBLGFBRUEsTUFBQSxVQUlBLEtBQUEsTUFBQSxPQUVBLE1BQUEsUUFBQSxPQUFBLEdBRUEsS0FBQSxPQUFBLG9CQUFBLElBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxjQUFBLGNBQ0EsS0FBQSxRQUFBLElBQUEsVUFBQSxLQUFBLFFBQUEsSUFBQSxjQUdBLEtBQUEsUUFBQSxXQU1BLE9BSEEsTUFBQSxXQUFBLElBQUEsTUFBQSxLQUFBLE9BQUEsV0FDQSxLQUFBLFNBQUEsSUFBQSxNQUFBLEVBRUEsR0FHQSxrQkFBQSxTQUFBLEdBQ0EsRUFBQSxrQkFDQSxFQUFBLGtCQUdBLEtBQUEsU0FBQSxHQUNBLEVBQUEsa0JBQ0EsRUFBQSxrQkFFQSxHQUFBLEtBQUEsT0FBQSw4Q0FBQSxHQUFBLEtBQUEsT0FBQSw4Q0FDQSxLQUFBLFlBQUEsRUFBQSxhQUFBLFFBSUEsWUFBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLEdBQUEsRUFFQSxJQUFBLEtBQUEsRUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLFdBQUEsS0FBQSxFQUFBLEtBRUEsSUFBQSxFQUFBLENBQ0EsR0FBQSxHQUFBLEtBQUEsT0FBQSw2Q0FBQSxPQUFBLENBRUEsS0FBQSxLQUFBLFVBQUEsS0FBQSxPQUFBLHFDQUFBLEdBR0EsTUFGQSxNQUFBLFlBQUEsRUFBQSxRQUFBLEVBQUEsaURBRUEsQ0FJQSxLQUFBLEtBQUEsVUFBQSxFQUFBLE1BR0EsTUFGQSxNQUFBLFlBQUEsRUFBQSxRQUFBLEVBQUEsdUNBRUEsQ0FHQSxJQUFBLEtBQUEsT0FBQSx5Q0FDQSxLQUFBLE1BQ0EsTUFBQSxnQ0FDQSxLQUFBLEVBQ0EsR0FBQSxLQUNBLE9BQUEsSUFDQSxRQUVBLEtBQUEsV0FBQSxFQUFBLFFBQUEsR0FDQSxLQUFBLE9BQUEsYUFFQSxDQUNBLEdBQUEsR0FBQSxLQUFBLE9BQUEsNENBQUEsT0FBQSxDQUVBLEtBQUEsS0FBQSxVQUFBLEtBQUEsT0FBQSxvQ0FBQSxHQUdBLE1BRkEsTUFBQSxZQUFBLEVBQUEsT0FBQSxFQUFBLGdEQUVBLENBR0EsS0FBQSxLQUFBLFVBQUEsRUFBQSxNQUdBLE1BRkEsTUFBQSxZQUFBLEVBQUEsT0FBQSxFQUFBLHVDQUVBLENBR0EsTUFBQSxXQUFBLEVBQUEsUUFDQSxLQUFBLE9BQUEsVUFHQSxPQUdBLFVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxLQUFBLE9BQUEsaUNBS0EsT0FKQSxJQUFBLElBQUEsSUFBQSxFQUFBLEtBQUEsT0FBQSxnQkFBQSxXQUVBLEVBQUEsU0FBQSxHQUVBLEdBQUEsR0FBQSxFQUVBLEdBQUEsR0FHQSxVQUFBLFNBQUEsRUFBQSxHQUdBLE1BRkEsR0FBQSxFQUFBLE1BQUEsS0FFQSxJQUFBLEVBQUEsUUFBQSxFQUFBLEtBQUEsTUFBQSxLQUFBLFFBR0EsV0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsR0FBQSxPQUNBLEVBQUEsR0FBQSxDQUVBLElBQUEsR0FBQSxLQUFBLGlCQUVBLEVBQUEsR0FBQSxTQUNBLEdBQUEsT0FBQSxPQUFBLEdBQ0EsRUFBQSxPQUFBLFNBQUEsY0FBQSxFQUFBLFVBQ0EsRUFBQSxPQUFBLE9BQUEsRUFBQSxNQUNBLEVBQUEsT0FBQSxXQUFBLEtBQUEsT0FBQSxVQUNBLEVBQUEsT0FBQSxTQUFBLEVBRUEsSUFBQSxHQUFBLEdBQUEsZUFDQSxHQUFBLEtBQUEsT0FBQSxlQUFBLE9BQUEsY0FDQSxFQUFBLGlCQUFBLGFBQUEsUUFDQSxFQUFBLGlCQUFBLFVBQUEsSUFBQSxLQUFBLGVBQUEsU0FFQSxFQUFBLE9BQUEsV0FBQSxTQUFBLEdBQ0EsR0FBQSxFQUFBLGlCQUFBLENBQ0EsR0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsSUFBQSxDQUNBLEdBQUEsTUFBQSxhQUFBLFNBQUEsRUFBQSxPQUVBLEtBQUEsTUFFQSxFQUFBLE9BQUEsV0FDQSxHQUFBLE1BQUEsRUFBQSxPQUFBLENBQ0EsR0FBQSxHQUFBLEtBQUEsTUFBQSxFQUFBLGFBQ0EsSUFBQSxHQUFBLEVBQUEsUUFBQSxDQUNBLEVBQUEsUUFDQSxJQUFBLEdBQUEsU0FBQSxFQUFBLElBQUEsR0FDQSxFQUFBLFNBQUEsRUFBQSxPQUFBLElBQ0EsTUFBQSxPQUFBLE9BQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxLQUFBLEtBQUEsRUFBQSxPQUFBLEtBQUEsS0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLE9BRUEsTUFBQSxhQUFBLEVBQUEsRUFBQSxXQUdBLEtBQUEsTUFFQSxFQUFBLEtBQUEsSUFHQSxlQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxJQUFBLFVBQUEsWUFBQSxLQUFBLFdBQ0EsSUFBQSxNQUNBLEtBQUEsMkVBQUEsRUFBQSw0QkFBQSxHQUFBLEVBQUEsaUJBR0EsT0FBQSxLQUFBLElBQUEsSUFHQSxhQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsTUFBQSxhQUFBLFNBQUEsU0FDQSxFQUFBLE1BQUEsYUFBQSxTQUFBLFFBRUEsRUFBQSxNQUFBLEtBQUEsU0FBQSxrQkFDQSxFQUFBLE1BQUEsS0FBQSxhQUFBLGVBQUEsZUFDQSxFQUFBLE1BQUEsS0FBQSxZQUFBLGFBRUEsRUFBQSxNQUFBLFFBQUEsSUFBQSxXQUFBLFlBQUEsRUFDQSxFQUFBLE1BQUEsbUJBQUEsR0FBQSxRQUFBLFdBQ0EsRUFBQSxZQUlBLFlBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxlQUFBLEVBQUEsRUFBQSxLQUNBLE1BQUEsYUFBQSxFQUFBLElBR0EsZUFBQSxXQUNBLE1BQUEsbUJBQUEsUUFBQSxhQUFBLEtBQUEsVUFBQSxVQUFBLFFBQUEsZUFJQSxLQUFBLFFBQUEsU0FBQSxHQUNBLEdBQUEsZ0JBQUEsUUFDQSxZQUFBLEtBSUEsS0FBQSxZQUFBLFdBQ0EsR0FBQSxHQUFBLElBQUEsTUFBQSx5QkFFQSxLQUFBLEtBQUEsRUFBQSxTQUFBLEdBRUEsT0FEQSxFQUFBLElBQUEsSUFBQSxJQUdBLGVBQUEsZUFBQSxFQUFBLEtBQUEsR0FFQSxlQUFBLGVBQUEsRUFBQSxJQUFBLEdBQUEsZ0JBQUEsUUFDQSxZQUFBLEVBQUEsS0FEQSxTQUpBLEtBWUEsS0FBQSxZQUFBLFdBQ0EsR0FBQSxHQUFBLElBQUEsTUFBQSxpQkFFQSxLQUFBLEtBQUEsRUFBQSxTQUFBLEdBRUEsT0FEQSxFQUFBLElBQUEsSUFBQSxJQUdBLGVBQUEsZUFBQSxFQUFBLEtBRUEsZUFBQSxlQUFBLEVBQUEsSUFBQSxVQUFBLFNBRkEsR0FGQSxLQ3p2QkEsZUFBQSxNQUFBLGVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLG9DQUFBLEtBRUEsR0FBQSxNQUNBLElBQUEsUUFBQSxHQUNBLE1BQUEsR0FBQSxLQUFBLEtBQUEsV0FDQSxLQUFBLEVBQ0EsUUFBQSxPQUFBLFFBQUEsU0FBQSxXQUVBLGFBQUEsT0FDQSxLQUFBLFFBQ0EsV0FBQSxPQUNBLFVBQUEsRUFDQSxNQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsS0FBQSxJQUdBLElBQUEsR0FBQSxTQUFBLEtBQUEsT0FBQSw0Q0FBQSxFQUNBLEtBQ0EsRUFBQSxJQUFBLEdBQUEsS0FBQSxVQUFBLDRGQUNBLHdIQUdBLGVBQUEsTUFBQSxlQUFBLFdBQUEsWUFBQSxLQUFBLEtBQUEsSUFFQSxJQUFBLE9BQUEsZUFBQSxNQUFBLGVBQUEsS0FBQSxNQUFBLFVBQ0EsSUFBQSxJQUFBLHVDQUFBLGVBQUEsTUFBQSxnQkN6QkEsZUFBQSxPQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsTUFDQSxFQUFBLGdCQUFBLEVBQUEsaUJBQUEsNkJBRUEsSUFBQSxHQUFBLElBQUEsSUFFQSxLQUFBLFFBQUEsR0FDQSxPQUFBLEVBQ0EsT0FBQSxPQUNBLFlBQUEsT0FDQSxRQUFBLEVBQ0EsV0FBQSxFQUNBLGFBQUEsRUFDQSxhQUFBLEVBQ0EsWUFBQSxFQUNBLFlBQUEsRUFDQSxXQUFBLEVBQ0EsTUFBQSxJQUNBLE9BQUEsRUFDQSxNQUFBLEVBQUEscUNBQ0EsSUFBQSw0Q0FDQSxRQUNBLE9BQUEsU0FDQSxRQUFBLEVBQ0EsVUFDQSxPQUFBLE9BQ0EsV0FBQSxNQUNBLGVBQUEsR0FDQSxPQUFBLE9BQ0EsUUFBQSxHQUVBLFFBQ0EsWUFBQSxHQUNBLFVBQ0EsVUFBQSxRQUNBLE9BQUEsUUFFQSxJQUFBLHlCQUNBLFFBQ0EsTUFBQSxTQUNBLEtBQUEsOENBQ0EsUUFBQSxFQUFBLCtCQUNBLE1BQUEsS0FDQSxNQUFBLE9BQ0EsT0FBQSxjQUNBLFFBQUEsS0FBQSxvQkFFQSxNQUFBLFNBQ0EsS0FBQSw0Q0FDQSxRQUFBLEVBQUEsK0JBQ0EsTUFBQSxLQUNBLE1BQUEsT0FDQSxPQUFBLGNBQ0EsUUFBQSxLQUFBLG9CQUVBLE1BQUEsU0FDQSxLQUFBLG1EQUNBLFFBQUEsRUFBQSxrQ0FDQSxNQUFBLEtBQ0EsTUFBQSxHQUNBLE9BQUEsT0FDQSxRQUFBLEtBQUEsb0JBRUEsTUFBQSxTQUNBLEtBQUEsb0RBQ0EsUUFBQSxFQUFBLG1DQUNBLE1BQUEsS0FDQSxPQUFBLEdBQ0EsT0FBQSxPQUNBLFFBQUEsS0FBQSxvQkFFQSxNQUFBLFNBQ0EsS0FBQSxtREFDQSxRQUFBLEVBQUEsc0NBQ0EsTUFBQSxLQUNBLE1BQUEsSUFDQSxPQUFBLFNBQ0EsUUFBQSxLQUFBLG9CQUVBLE1BQUEsU0FDQSxLQUFBLG9EQUNBLFFBQUEsRUFBQSx1Q0FDQSxNQUFBLEtBQ0EsTUFBQSxHQUNBLE9BQUEsU0FDQSxRQUFBLEtBQUEsb0JBRUEsTUFBQSxTQUNBLEtBQUEsOENBQ0EsUUFBQSxFQUFBLHdDQUNBLE1BQUEsS0FDQSxNQUFBLEtBQ0EsT0FBQSxRQUNBLFFBQUEsS0FBQSxzQkFHQSxZQUFBLEdBQ0EsVUFDQSxVQUFBLFFBQ0EsT0FBQSxRQUVBLElBQUEseUJBQ0EsUUFDQSxLQUFBLCtDQUFBLElBQUEsZ0JBQUEsRUFBQSxNQUFBLGlCQUlBLE9BQ0EsTUFBQSx1Q0FDQSxHQUFBLEVBQUEsbUJBQ0EsV0FDQSxRQUNBLEdBQUEsU0FBQSxFQUFBLEdBQ0EsS0FBQSxxQkFBQSxFQUFBLE9BRUEsTUFBQSxRQUdBLE1BQ0EsS0FBQSxFQUFBLFVBQ0EsTUFBQSxLQUNBLFFBQUEsS0FBQSxRQUVBLEtBQUEsRUFBQSxpQ0FDQSxJQUFBLGlCQUNBLE1BQUEsS0FDQSxLQUFBLEVBQ0EsUUFBQSxLQUFBLFNBRUEsS0FBQSxFQUFBLHNDQUNBLElBQUEsaUJBQ0EsTUFBQSxLQUNBLEtBQUEsRUFDQSxRQUFBLEtBQUEsU0FFQSxXQUNBLE1BQ0EsR0FBQSxXQUNBLEdBQUEsS0FDQSxNQUFBLFdBQUEsRUFBQSxJQUFBLEtBQUEsR0FBQSxJQUFBLEVBQUEsaUJBRUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxLQUFBLFdBQ0EsUUFBQSxFQUFBLEVBQ0EsT0FBQSxFQUFBLEVBQ0EsWUFBQSxFQUFBLE9BQ0EsV0FBQSxFQUFBLE1BQ0EsWUFBQSxFQUFBLE9BQUEsS0FDQSxRQUNBLEtBQUEsTUFFQSxLQUFBLFdBQUEsUUFBQSxFQUVBLElBQUEsR0FBQSxJQUFBLE9BQUEsRUFBQSxvQkFBQSxNQUFBLE1BQUEsRUFDQSxNQUFBLHFCQUFBLEVBQUEsT0FFQSxNQUFBLFNBSUEsZUFBQSxPQUFBLFFBQUEsV0FBQSxZQUFBLEtBQUEsS0FBQSxHQUNBLEtBQUEsT0FBQSxHQUdBLElBQUEsT0FBQSxlQUFBLE9BQUEsUUFBQSxJQUFBLFFBQ0EsVUFBQSxHQUNBLGdCQUFBLEtBQUEsSUFFQSxxQkFBQSxTQUFBLFNBQ0EsR0FBQSxNQUVBLElBQUEsSUFBQSxRQUFBLE1BQ0EsTUFBQSxRQUFBLE1BQ0EsTUFBQSxRQUFBLGtCQUFBLElBQ0EsTUFBQSxLQUFBLFFBQUEsUUFFQSxJQUFBLFFBQUEsT0FBQSxRQUFBLE9BQUEsQ0FDQSxHQUFBLE9BQUEsU0FBQSxRQUFBLE9BQ0EsT0FBQSxTQUFBLFFBQUEsT0FFQSxPQURBLE1BQUEsR0FBQSxPQUFBLEVBQ0EsTUFBQSxPQUVBLFFBR0EsT0FBQSxHQUlBLE1BQUEsZUFBQSxRQUVBLEtBQUEsbUJBQUEsT0FBQSxpQkFBQSxNQUFBLFNBR0EsT0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEtBQUEsT0FBQSxHQUFBLGVBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxNQUVBLEVBQUEsR0FBQSxTQUNBLEdBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxNQUNBLEVBQUEsT0FBQSxTQUFBLDBCQUNBLEVBQUEsT0FBQSxZQUFBLEtBQUEsV0FDQSxFQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsS0FBQSxNQUNBLEVBQUEsT0FBQSxPQUFBLEVBQUEsTUFDQSxFQUFBLE9BQUEsV0FBQSxLQUFBLE9BQUEsR0FBQSxPQUFBLFVBQ0EsRUFBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLFFBQ0EsRUFBQSxPQUFBLFVBQUEsS0FBQSxlQUFBLEtBRUEsSUFBQSxHQUFBLEdBQUEsZUFDQSxHQUFBLEtBQUEsT0FBQSxlQUFBLE9BQUEsY0FDQSxFQUFBLGlCQUFBLGFBQUEsUUFDQSxFQUFBLGlCQUFBLFVBQUEsSUFBQSxLQUFBLGVBQUEsU0FFQSxFQUFBLE9BQUEsV0FBQSxTQUFBLEdBQ0EsR0FBQSxFQUFBLGlCQUFBLENBQ0EsR0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsSUFBQSxDQUNBLEdBQUEsTUFBQSxhQUFBLFNBQUEsRUFBQSxPQUVBLEtBQUEsTUFFQSxFQUFBLE9BQUEsV0FDQSxHQUFBLE1BQUEsRUFBQSxPQUFBLENBQ0EsR0FBQSxHQUFBLEtBQUEsTUFBQSxFQUFBLGFBRUEsSUFBQSxFQUFBLFNBQ0EsRUFBQSxTQUNBLEtBQUEsT0FBQSxHQUFBLE9BQUEsT0FBQSxLQUFBLEVBQUEsT0FBQSxLQUFBLEtBQUEsRUFBQSxPQUFBLEtBQUEsS0FBQSxFQUFBLE9BQUEsS0FBQSxXQUVBLEtBQUEsT0FBQSxHQUFBLGFBQUEsRUFBQSxFQUFBLFdBR0EsS0FBQSxNQUVBLEVBQUEsS0FBQSxHQUVBLEtBQUEsU0FHQSxrQkFBQSxTQUFBLEdBQ0EsS0FBQSxXQUFBLFFBQUEsRUFBQSxPQUFBLEVBQUEsUUFHQSxNQUFBLFdBQ0EsS0FBQSxXQUFBLFFBQUEsV0FFQSxlQUFBLE9BQUEsUUFBQSxXQUFBLE1BQUEsS0FBQSxNQUNBLEtBQUEsT0FBQSxHQUFBLE9BQUEsV0FHQSxJQUFBLElBQUEsZ0NBQUEsZUFBQSxPQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIkV4dC5ucygnTWFya2Rvd25FZGl0b3InKTtcbk1hcmtkb3duRWRpdG9yID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICAgIE1hcmtkb3duRWRpdG9yLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLGNvbmZpZyk7XG59O1xuRXh0LmV4dGVuZChNYXJrZG93bkVkaXRvcixFeHQuQ29tcG9uZW50LHtcbiAgICB3aW5kb3c6e30sY29tYm86e30sY29uZmlnOiB7fVxufSk7XG5FeHQucmVnKCdtYXJrZG93bmVkaXRvcicsTWFya2Rvd25FZGl0b3IpO1xubWFya2Rvd25FZGl0b3IgPSBuZXcgTWFya2Rvd25FZGl0b3IoKTtcblxubWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHMgPSB7fTtcblxubWFya2Rvd25FZGl0b3IuRWRpdG9yID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICAgIGNvbmZpZy5yZXNvdXJjZSA9IE1PRHgucmVxdWVzdC5pZCB8fCAwO1xuICAgIG1hcmtkb3duRWRpdG9yLkVkaXRvci5zdXBlcmNsYXNzLmNvbnN0cnVjdG9yLmNhbGwodGhpcyxjb25maWcpO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xufTtcbkV4dC5leHRlbmQobWFya2Rvd25FZGl0b3IuRWRpdG9yLEV4dC5Db21wb25lbnQse1xuICAgIHJlbWFya2FibGU6ICcnXG4gICAgLGZ1bGxTY3JlZW46IGZhbHNlXG4gICAgLGluaXRDb21wb25lbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBNYXJrZG93bkVkaXRvci5zdXBlcmNsYXNzLmluaXRDb21wb25lbnQuY2FsbCh0aGlzKTtcblxuICAgICAgICBpZiAodGhpcy5tZEVsZW1lbnRJZCl7XG4gICAgICAgICAgICBFeHQub25SZWFkeSh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAsZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5lZGl0b3IuZGVzdHJveSgpO1xuXG4gICAgICAgIHRoaXMubWRDb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMudGFNYXJrZG93bi5yZW1vdmUoKTtcblxuICAgICAgICB0aGlzLnRleHRhcmVhLmRvbS5zdHlsZS5kaXNwbGF5ID0gbnVsbDtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5kb20uc3R5bGUud2lkdGggPSBudWxsO1xuICAgICAgICB0aGlzLnRleHRhcmVhLmRvbS5zdHlsZS5oZWlnaHQgPSBudWxsO1xuXG4gICAgICAgIE1hcmtkb3duRWRpdG9yLnN1cGVyY2xhc3MuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgICxyZW5kZXI6IGZ1bmN0aW9uKGNvbnRhaW5lciwgcG9zaXRpb24pIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYSA9IEV4dC5nZXQodGhpcy5tZEVsZW1lbnRJZCk7XG4gICAgICAgIHRoaXMubWRFbGVtZW50TmFtZSA9IHRoaXMudGV4dGFyZWEuZG9tLm5hbWU7XG5cbiAgICAgICAgaWYgKCF0aGlzLnRleHRhcmVhKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5idWlsZFVJKCk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJBY2UoKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlck1hcmtlZCgpO1xuICAgICAgICB0aGlzLmJ1aWxkVG9vbGJveCgpO1xuXG4gICAgICAgIHZhciBwcmV2aWV3QnV0dG9uID0gdGhpcy50b29sQm94LmNoaWxkKCcucHJldmlldy1idXR0b24nKTtcbiAgICAgICAgdmFyIGZ1bGxzY3JlZW5CdXR0b24gPSB0aGlzLnRvb2xCb3guY2hpbGQoJy5mdWxsc2NyZWVuLWJ1dHRvbicpO1xuICAgICAgICB2YXIgc3BsaXRzY3JlZW5CdXR0b24gPSB0aGlzLnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKTtcblxuICAgICAgICB2YXIgY29udGVudCA9IHRoaXMuY29udGVudE1EO1xuXG4gICAgICAgIHZhciBwcmV2aWV3QnV0dG9uT2ZmID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZChjb250ZW50LnBhcmVudCgpLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogJ3ByZXZpZXctYnV0dG9uLW9mZicsXG4gICAgICAgICAgICBodG1sOiAnPGkgY2xhc3M9XCJpY29uIGljb24tZXllLXNsYXNoIGljb24tbGFyZ2VcIj48L2k+JyxcbiAgICAgICAgICAgIGhpZGRlbjogdHJ1ZVxuICAgICAgICB9KSk7XG5cbiAgICAgICAgdmFyIGRyb3BUYXJnZXQgPSBNT0R4LmxvYWQoe1xuICAgICAgICAgICAgeHR5cGU6ICdtb2R4LXRyZWVkcm9wJyxcbiAgICAgICAgICAgIHRhcmdldDogY29udGVudCxcbiAgICAgICAgICAgIHRhcmdldEVsOiBjb250ZW50LFxuICAgICAgICAgICAgb25JbnNlcnQ6IChmdW5jdGlvbihzKXtcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydChzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMuZWRpdG9yKSxcbiAgICAgICAgICAgIGlmcmFtZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5vbignZGVzdHJveScsIGZ1bmN0aW9uKCkge2Ryb3BUYXJnZXQuZGVzdHJveSgpO30pO1xuXG4gICAgICAgIHZhciBkZWZhdWx0U3BsaXQgPSBwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC5zcGxpdCddIHx8IDApO1xuICAgICAgICBpZiAoZGVmYXVsdFNwbGl0ID09IDEpIHtcbiAgICAgICAgICAgIHNwbGl0c2NyZWVuQnV0dG9uLnR1cm5PbigpO1xuICAgICAgICB9XG4gICAgICAgIHByZXZpZXdCdXR0b24uYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zaG93UHJldmlldygpO1xuICAgICAgICAgICAgdGhpcy5oaWRlQ29udGVudCgpO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuc2V0RGlzcGxheWVkKCdub25lJyk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLmFkZENsYXNzKCdwcmV2aWV3Jyk7XG5cbiAgICAgICAgICAgIHByZXZpZXdCdXR0b25PZmYuc2hvdygpXG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHByZXZpZXdCdXR0b25PZmYuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5oaWRlUHJldmlldygpO1xuICAgICAgICAgICAgdGhpcy5zaG93Q29udGVudCgpO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRNRC5wYXJlbnQoKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygncHJldmlldycpO1xuXG4gICAgICAgICAgICB0aGlzLmVkaXRvci5mb2N1cygpO1xuXG4gICAgICAgICAgICBwcmV2aWV3QnV0dG9uT2ZmLmhpZGUoKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgc3BsaXRzY3JlZW5CdXR0b24uYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmIChzcGxpdHNjcmVlbkJ1dHRvbi5jaGlsZCgnaScpLmhhc0NsYXNzKCdpY29uLXBhdXNlJykpIHtcbiAgICAgICAgICAgICAgICBzcGxpdHNjcmVlbkJ1dHRvbi50dXJuT24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3BsaXRzY3JlZW5CdXR0b24udHVybk9mZigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBmdWxsc2NyZWVuQnV0dG9uLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5mdWxsU2NyZWVuID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkJ1dHRvbi50dXJuT24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkJ1dHRvbi50dXJuT2ZmKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyLnNldERpc3BsYXllZCgnYmxvY2snKTtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnJlc2l6ZSh0cnVlKTtcblxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAobWFya2Rvd25FZGl0b3IuY29udGVudFt0aGlzLm1kRWxlbWVudE5hbWVdKSB7XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5zZXRWYWx1ZShtYXJrZG93bkVkaXRvci5jb250ZW50W3RoaXMubWRFbGVtZW50TmFtZV0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWRpdG9yLnNlbGVjdGlvbi5jbGVhclNlbGVjdGlvbigpO1xuXG4gICAgICAgIHRoaXMucHJldmlldy51cGRhdGUodGhpcy5wYXJzZSh0aGlzLmVkaXRvci5nZXRWYWx1ZSgpKSk7XG5cbiAgICAgICAgdGhpcy5wcmV2aWV3LmZpeEhlaWdodCgpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZSxiLGMsZCl7XG4gICAgICAgICAgICBpZiAoZS5kYXRhLmFjdGlvbiA9PSAnaW5zZXJ0VGV4dCcgJiYgdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLmdldERvY3VtZW50KCkuaXNOZXdMaW5lKGUuZGF0YS50ZXh0KSkge1xuICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpO1xuICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudCA9IHNlc3Npb24uZ2V0RG9jdW1lbnQoKTtcblxuICAgICAgICAgICAgICAgIGlmICgvXlxccyooPzpbKistXXxcXGQrXFwuKVxccyokLy5leGVjKGRvY3VtZW50LmdldExpbmUoZS5kYXRhLnJhbmdlLnN0YXJ0LnJvdykpICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlTGluZXMoZS5kYXRhLnJhbmdlLnN0YXJ0LnJvdywgZS5kYXRhLnJhbmdlLnN0YXJ0LnJvdyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBhcnNlKHRoaXMuZWRpdG9yLmdldFZhbHVlKCkpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgICxzaG93Q29udGVudDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jb250ZW50TUQuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuICAgIH1cblxuICAgICxoaWRlQ29udGVudDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jb250ZW50TUQuc2V0RGlzcGxheWVkKCdub25lJyk7XG4gICAgfVxuXG4gICAgLHNob3dQcmV2aWV3OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnByZXZpZXcuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuICAgIH1cblxuICAgICxoaWRlUHJldmlldzogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5wcmV2aWV3LnNldERpc3BsYXllZCgnbm9uZScpO1xuICAgIH1cblxuICAgICxidWlsZFVJOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXREaXNwbGF5ZWQoJ25vbmUnKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRXaWR0aCgwKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRIZWlnaHQoMCk7XG5cbiAgICAgICAgdGhpcy50YU1hcmtkb3duID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmluc2VydEJlZm9yZSh0aGlzLnRleHRhcmVhLCB7XG4gICAgICAgICAgICB0YWc6ICd0ZXh0YXJlYScsXG4gICAgICAgICAgICBuYW1lOiB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJyxcbiAgICAgICAgICAgIGNsYXNzOiB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJ1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgdGhpcy50YU1hcmtkb3duLnNldERpc3BsYXllZCgnbm9uZScpO1xuICAgICAgICB0aGlzLnRhTWFya2Rvd24uc2V0V2lkdGgoMCk7XG4gICAgICAgIHRoaXMudGFNYXJrZG93bi5zZXRIZWlnaHQoMCk7XG5cbiAgICAgICAgdGhpcy5tZENvbnRhaW5lciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5pbnNlcnRCZWZvcmUodGhpcy50ZXh0YXJlYSwge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAnbWFya2Rvd24tY29udGFpbmVyIGFjZS0nICsgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnRoZW1lJ10gfHwgJ21vbm9rYWknKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgZnVsbFNjcmVlbkhlYWRlciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAnZnVsbHNjcmVlbi1oZWFkZXIgYWNlX2d1dHRlcicsXG4gICAgICAgICAgICBodG1sOiAnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgLz4nXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgcGFnZVRpdGxlID0gRXh0LmdldENtcCgnbW9keC1yZXNvdXJjZS1wYWdldGl0bGUnKTtcbiAgICAgICAgaWYgKHBhZ2VUaXRsZSkge1xuICAgICAgICAgICAgdmFyIGhlYWRlcklucHV0ID0gZnVsbFNjcmVlbkhlYWRlci5jaGlsZCgnaW5wdXQnKTtcbiAgICAgICAgICAgIGhlYWRlcklucHV0LmRvbS52YWx1ZSA9IHBhZ2VUaXRsZS5nZXRWYWx1ZSgpO1xuXG4gICAgICAgICAgICBoZWFkZXJJbnB1dC5vbignY2hhbmdlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBwYWdlVGl0bGUuc2V0VmFsdWUodGhpcy5kb20udmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBhZ2VUaXRsZS5vbignY2hhbmdlJywgZnVuY3Rpb24oZmllbGQsdmFsdWUpe1xuICAgICAgICAgICAgICAgIGhlYWRlcklucHV0LmRvbS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgd3JhcHBlciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAnbWFya2Rvd24td3JhcHBlcidcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHRoaXMuY29udGVudE1EID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh3cmFwcGVyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogdGhpcy50ZXh0YXJlYS5kb20uY2xhc3NOYW1lICsgJyBjb250ZW50LW1kICcgKyB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJ1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgdGhpcy5wcmV2aWV3ID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh3cmFwcGVyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogJ21hcmtkb3duLWJvZHkgcHJldmlldy1tZCdcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5wcmV2aWV3LmZpeEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGF0LmVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0U2NyZWVuTGVuZ3RoKCkgKiB0aGF0LmVkaXRvci5yZW5kZXJlci5saW5lSGVpZ2h0ICsgdGhhdC5lZGl0b3IucmVuZGVyZXIuc2Nyb2xsQmFyLmdldFdpZHRoKCkgICsgMzA7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0SGVpZ2h0KGhlaWdodCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ltYWdlX3VwbG9hZCddID09IDEgfHwgTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5lbmFibGVfZmlsZV91cGxvYWQnXSA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0JhciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdzdGF0dXMtYmFyIGFjZV9ndXR0ZXInXG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzTW9iaWxlRGV2aWNlKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5kb20uaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJ1cGxvYWQtYmFyXCI+IDxpbnB1dCBjbGFzcz1cImhpZGRlblwiIG5hbWU9XCJtZF9maWxlXycrIHRoaXMuc3RhdHVzQmFyLmlkICsnXCIgaWQ9XCInICsgdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGVcIiB0eXBlPVwiZmlsZVwiIG11bHRpcGxlIC8+PGlucHV0IGNsYXNzPVwiaGlkZGVuXCIgbmFtZT1cIm1kX2ZpbGVfJysgdGhpcy5zdGF0dXNCYXIuaWQgKyctbW9iaWxlXCIgaWQ9XCInICsgdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGUtbW9iaWxlXCIgdHlwZT1cImZpbGVcIiBhY2NlcHQ9XCJpbWFnZS8qXCIgY2FwdHVyZT1cImNhbWVyYVwiIC8+JyArIF8oJ21hcmtkb3duZWRpdG9yLnN0YXR1c19iYXJfbWVzc2FnZV9tb2JpbGUnLCB7aWQ6IHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlJywgaWRfbW9iaWxlOiB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZS1tb2JpbGUnfSkgKyAnPC9kaXY+JztcblxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyLmNoaWxkKCcjJyArIHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlLW1vYmlsZScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLCBpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUZpbGVzKGlucHV0LmZpbGVzLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5kb20uaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJ1cGxvYWQtYmFyXCI+IDxpbnB1dCBjbGFzcz1cImhpZGRlblwiIG5hbWU9XCJtZF9maWxlXycrIHRoaXMuc3RhdHVzQmFyLmlkICsnXCIgaWQ9XCInICsgdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGVcIiB0eXBlPVwiZmlsZVwiIG11bHRpcGxlPicgKyBfKCdtYXJrZG93bmVkaXRvci5zdGF0dXNfYmFyX21lc3NhZ2UnLCB7aWQ6IHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlJ30pICsgJzwvZGl2Pic7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5jaGlsZCgnIycgKyB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLCBpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUZpbGVzKGlucHV0LmZpbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0JhciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdzdGF0dXMtYmFyJyxcbiAgICAgICAgICAgICAgICBodG1sOiBfKCdtYXJrZG93bmVkaXRvci5zdGF0dXNfYmFyX2Rpc2FibGVkJylcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIEV4dC5Eb21IZWxwZXIuYXBwZW5kKHRoaXMubWRDb250YWluZXIuZG9tLHtcbiAgICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgICAgc3R5bGU6ICdjbGVhcjogYm90aCdcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLGJ1aWxkVG9vbGJveDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy50b29sQm94ID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh0aGlzLnN0YXR1c0Jhcix7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3M6ICd0b29sYm94JyxcbiAgICAgICAgICAgIGNuOiBbe1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdwcmV2aWV3LWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgaHRtbDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLWV5ZSBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdzcGxpdHNjcmVlbi1idXR0b24nLFxuICAgICAgICAgICAgICAgIGh0bWw6ICc8aSBjbGFzcz1cImljb24gaWNvbi1wYXVzZSBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdmdWxsc2NyZWVuLWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgaHRtbDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLWV4cGFuZCBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhpcy50b29sQm94LmNoaWxkKCcuc3BsaXRzY3JlZW4tYnV0dG9uJykudHVybk9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykucmVtb3ZlQ2xhc3MoJ2ljb24tcGF1c2UnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5hZGRDbGFzcygnaWNvbi1zdG9wJyk7XG5cbiAgICAgICAgICAgIHRoYXQuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLmFkZENsYXNzKCdzcGxpdCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpLnR1cm5PZmYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5hZGRDbGFzcygnaWNvbi1wYXVzZScpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZCgnaScpLnJlbW92ZUNsYXNzKCdpY29uLXN0b3AnKTtcblxuICAgICAgICAgICAgdGhhdC5jb250ZW50TUQucGFyZW50KCkucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ3NwbGl0Jyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy50b29sQm94LmNoaWxkKCcuZnVsbHNjcmVlbi1idXR0b24nKS50dXJuT24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5yZW1vdmVDbGFzcygnaWNvbi1leHBhbmQnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5hZGRDbGFzcygnaWNvbi1jb21wcmVzcycpO1xuXG4gICAgICAgICAgICB2YXIgbW9keEJ1dHRvbnMgPSBFeHQuZ2V0KCdtb2R4LWFjdGlvbi1idXR0b25zJyk7XG4gICAgICAgICAgICBpZiAobW9keEJ1dHRvbnMpIHtcbiAgICAgICAgICAgICAgICBtb2R4QnV0dG9ucy5hZGRDbGFzcygnbWFya2Rvd25lZGl0b3ItZnVsbHNjcmVlbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LmZ1bGxTY3JlZW4gPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwuc3BsaXRfZnVsbHNjcmVlbiddIHx8IDEpID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC50b29sQm94LmNoaWxkKCcuc3BsaXRzY3JlZW4tYnV0dG9uJykudHVybk9mZigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LnNob3dQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGF0LnNob3dDb250ZW50KCk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIHRoYXQuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLmFkZENsYXNzKCdmdWxsc2NyZWVuJyk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLnNldE9wdGlvbignbWF4TGluZXMnLCBudWxsKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnRvb2xCb3guY2hpbGQoJy5mdWxsc2NyZWVuLWJ1dHRvbicpLnR1cm5PZmYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5hZGRDbGFzcygnaWNvbi1leHBhbmQnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5yZW1vdmVDbGFzcygnaWNvbi1jb21wcmVzcycpO1xuXG4gICAgICAgICAgICB2YXIgbW9keEJ1dHRvbnMgPSBFeHQuZ2V0KCdtb2R4LWFjdGlvbi1idXR0b25zJyk7XG4gICAgICAgICAgICBpZiAobW9keEJ1dHRvbnMpIHtcbiAgICAgICAgICAgICAgICBtb2R4QnV0dG9ucy5yZW1vdmVDbGFzcygnbWFya2Rvd25lZGl0b3ItZnVsbHNjcmVlbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LmZ1bGxTY3JlZW4gPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNwbGl0J10gfHwgMCkgPT0gMSkge1xuICAgICAgICAgICAgICAgIHRoYXQudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpLnR1cm5PbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0LnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT2ZmKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoYXQuaGlkZVByZXZpZXcoKTtcbiAgICAgICAgICAgIHRoYXQuc2hvd0NvbnRlbnQoKTtcblxuICAgICAgICAgICAgdGhhdC5lZGl0b3IuZm9jdXMoKTtcblxuICAgICAgICAgICAgdGhhdC5jb250ZW50TUQucGFyZW50KCkucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2Z1bGxzY3JlZW4nKTtcblxuICAgICAgICAgICAgdGhhdC5lZGl0b3Iuc2V0T3B0aW9uKCdtYXhMaW5lcycsIEluZmluaXR5KTtcblxuICAgICAgICAgICAgdGhhdC5wcmV2aWV3LmZpeEhlaWdodCgpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgICxyZWdpc3RlckFjZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZWRpdG9yID0gYWNlLmVkaXQoRXh0LkRvbVF1ZXJ5LnNlbGVjdE5vZGUoJ2Rpdi4nICsgdGhpcy5tZEVsZW1lbnROYW1lICsgJ19tYXJrZG93bicpKTtcbiAgICAgICAgYWNlLnJlcXVpcmUoXCJhY2UvbGF5ZXIvZ3V0dGVyX3Rvb2xiYXJcIik7XG5cbiAgICAgICAgdGhpcy5lZGl0b3Iuc2V0T3B0aW9ucyh7XG4gICAgICAgICAgICBtYXhMaW5lczogSW5maW5pdHksXG4gICAgICAgICAgICBtaW5MaW5lczogMjUsXG4gICAgICAgICAgICBlbmFibGVCYXNpY0F1dG9jb21wbGV0aW9uOiB0cnVlLFxuICAgICAgICAgICAgcHJpbnRNYXJnaW46IGZhbHNlLFxuICAgICAgICAgICAgc2hvd0d1dHRlcjogdHJ1ZSxcbiAgICAgICAgICAgIHVzZVNvZnRUYWJzOiB0cnVlLFxuICAgICAgICAgICAgc2hvd0ZvbGRXaWRnZXRzOiBmYWxzZSxcbiAgICAgICAgICAgIHNob3dMaW5lTnVtYmVyczogZmFsc2UsXG4gICAgICAgICAgICBmb250U2l6ZTogcGFyc2VJbnQoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwuZm9udF9zaXplJ10pIHx8IDEyLFxuICAgICAgICAgICAgZm9udEZhbWlseTogTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwuZm9udF9mYW1pbHknXSB8fCAnJ1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLnNldFVzZVdyYXBNb2RlKHRydWUpO1xuICAgICAgICB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0V3JhcExpbWl0UmFuZ2UoKTtcbiAgICAgICAgdGhpcy5lZGl0b3IucmVuZGVyZXIuc2V0U2Nyb2xsTWFyZ2luKDEwLCAxMCk7XG4gICAgICAgIHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRWYWx1ZSh0aGlzLnRleHRhcmVhLmdldFZhbHVlKCkpO1xuICAgICAgICB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0TW9kZShcImFjZS9tb2RlL21hcmtkb3duZWRpdG9yXCIpO1xuICAgICAgICB0aGlzLmVkaXRvci5zZXRUaGVtZShcImFjZS90aGVtZS9cIiArIChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC50aGVtZSddIHx8ICdtb25va2FpJykpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLnNlbGVjdGlvbi5vbignY2hhbmdlQ3Vyc29yJywgZnVuY3Rpb24gKGEsIHNlbGVjdGlvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3V0dGVyVG9vbGJhcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3V0dGVyVG9vbGJhci51cGRhdGUoJycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0aW9uLnNlc3Npb24uZG9jLiRsaW5lc1t0aGlzLmVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvd10gPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gRXh0LkRvbVF1ZXJ5LnNlbGVjdE5vZGUoJy4nICsgdGhpcy5tZEVsZW1lbnROYW1lICsgJ19tYXJrZG93biAuYWNlX2d1dHRlci1jZWxsOm50aC1jaGlsZCgnICsgKHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93ICsgMSkgKyAnKScpO1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkR3V0dGVyVG9vbGJhcihub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5ndXR0ZXJSZW5kZXJlciA9ICB7XG4gICAgICAgICAgICBnZXRXaWR0aDogZnVuY3Rpb24oc2Vzc2lvbiwgbGFzdExpbmVOdW1iZXIsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuY2hhcmFjdGVyV2lkdGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0VGV4dDogZnVuY3Rpb24oc2Vzc2lvbiwgcm93LCBjZWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNlbGwuZWxlbWVudCAmJiB0aGlzLmVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvdyA9PSByb3cgJiYgc2Vzc2lvbi5kb2MuJGxpbmVzW3Jvd10gPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEd1dHRlclRvb2xiYXIoY2VsbC5lbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5lZGl0b3IuY29tbWFuZHMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBuYW1lOiBcIkluZGVudCBsaXN0XCIsXG4gICAgICAgICAgICBiaW5kS2V5OiB7d2luOiBcIlRhYlwiLCBtYWM6IFwiVGFiXCJ9LFxuICAgICAgICAgICAgZXhlYzogZnVuY3Rpb24oZWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBlZGl0b3Iuc2Vzc2lvbi5nZXRMaW5lKGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvdyk7XG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gL14oXFxzKikoPzooWy0rKl0pfChcXGQrKVxcLikoXFxzKykvLmV4ZWMobGluZSk7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZXNzaW9uLmluZGVudFJvd3MoZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93LCBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKS5yb3csICdcXHQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IuaW5kZW50KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVkaXRvci5jb21tYW5kcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIG5hbWU6IFwiRXhpdCBmdWxsc2NyZWVuXCIsXG4gICAgICAgICAgICBiaW5kS2V5OiB7d2luOiBcIkVzY1wiLCBtYWM6IFwiRXNjXCJ9LFxuICAgICAgICAgICAgZXhlYzogZnVuY3Rpb24oZWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZnVsbFNjcmVlbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvb2xCb3guY2hpbGQoJy5mdWxsc2NyZWVuLWJ1dHRvbicpLnR1cm5PZmYoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGxhbmdUb29scyA9IGFjZS5yZXF1aXJlKFwiYWNlL2V4dC9sYW5ndWFnZV90b29sc1wiKTtcbiAgICAgICAgdmFyIHJlc291cmNlc0NvbXBsZXRlciA9IHtcbiAgICAgICAgICAgIGdldENvbXBsZXRpb25zOiBmdW5jdGlvbihlZGl0b3IsIHNlc3Npb24sIHBvcywgcHJlZml4LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmIChwcmVmaXgubGVuZ3RoID09PSAwKSB7IGNhbGxiYWNrKG51bGwsIFtdKTsgcmV0dXJuIH1cblxuICAgICAgICAgICAgICAgIE1PRHguQWpheC5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBtYXJrZG93bkVkaXRvci5jb25maWcuY29ubmVjdG9yVXJsXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ21nci9yZXNvdXJjZS9nZXRsaXN0J1xuICAgICAgICAgICAgICAgICAgICAgICAgLHByZWZpeDogcHJlZml4XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgci5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBsYW5nVG9vbHMuYWRkQ29tcGxldGVyKHJlc291cmNlc0NvbXBsZXRlcik7XG5cbiAgICAgICAgdGhpcy5lZGl0b3IuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW50ZXJcIiwgdGhpcy5jYXRjaEFuZERvTm90aGluZywgZmFsc2UpO1xuICAgICAgICB0aGlzLmVkaXRvci5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuY2F0Y2hBbmREb05vdGhpbmcsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5lZGl0b3IuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuZHJvcC5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgLGFkZEd1dHRlclRvb2xiYXI6IGZ1bmN0aW9uKGNlbGwpe1xuICAgICAgICB0aGlzLmd1dHRlclRvb2xiYXIgPSBFeHQuZ2V0KGNlbGwpO1xuICAgICAgICB0aGlzLmd1dHRlclRvb2xiYXIudXBkYXRlKCc8aSBjbGFzcz1cImljb24gaWNvbi1oZWFydCBpY29uLWxhcmdlXCI+PC9pPjxkaXYgY2xhc3M9XCJpbmxpbmUtdG9vbGJhclwiPjxpIGNsYXNzPVwiaWNvbiBpY29uLXVwbG9hZCBpY29uLWxhcmdlXCI+PC9pPjxpIGNsYXNzPVwiaWNvbiBpY29uLWNhbWVyYSBpY29uLWxhcmdlXCI+PC9pPjwvZGl2PicpO1xuXG4gICAgICAgIHRoaXMuZ3V0dGVyVG9vbGJhci5jaGlsZCgnaScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgc3dpdGNoZXIgPSB0aGlzLmd1dHRlclRvb2xiYXIuY2hpbGQoJ2knKTtcbiAgICAgICAgICAgIHZhciBpbmxpbmVUb29sYmFyID0gdGhpcy5ndXR0ZXJUb29sYmFyLmNoaWxkKCcuaW5saW5lLXRvb2xiYXInKTtcblxuICAgICAgICAgICAgdmFyIHVwbG9hZEJ1dHRvbiA9IGlubGluZVRvb2xiYXIuY2hpbGQoJ2kuaWNvbi11cGxvYWQnKTtcbiAgICAgICAgICAgIHVwbG9hZEJ1dHRvbi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihzd2l0Y2hlci5oYXNDbGFzcygnaWNvbi1oZWFydCcpKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoZXIuYWRkQ2xhc3MoJ2ljb24tY2xvc2UnKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2hlci5yZW1vdmVDbGFzcygnaWNvbi1oZWFydCcpO1xuXG4gICAgICAgICAgICAgICAgaW5saW5lVG9vbGJhci5zaG93KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN3aXRjaGVyLmFkZENsYXNzKCdpY29uLWhlYXJ0Jyk7XG4gICAgICAgICAgICAgICAgc3dpdGNoZXIucmVtb3ZlQ2xhc3MoJ2ljb24tY2xvc2UnKTtcblxuICAgICAgICAgICAgICAgIGlubGluZVRvb2xiYXIuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgICxyZWdpc3Rlck1hcmtlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMucmVtYXJrYWJsZSA9IG5ldyBSZW1hcmthYmxlKHtcbiAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICBoaWdobGlnaHQ6IGZ1bmN0aW9uIChzdHIsIGxhbmcpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAnJztcbiAgICAgICAgICAgICAgICBpZiAobGFuZyAmJiBobGpzLmdldExhbmd1YWdlKGxhbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGhsanMuaGlnaGxpZ2h0KGxhbmcsIHN0cikudmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxbXFxbL2csICcmIzkxOyYjOTE7Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL11dL2csICcmIzkzOyYjOTM7Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gaGxqcy5oaWdobGlnaHRBdXRvKHN0cikudmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXFtcXFsvZywgJyYjOTE7JiM5MTsnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9dXS9nLCAnJiM5MzsmIzkzOycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlbWFya2FibGUuaW5saW5lLnJ1bGVyLmRpc2FibGUoWyAnYmFja3RpY2tzJyBdKTtcbiAgICB9XG5cbiAgICAscGFyc2U6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLnJlbWFya2FibGUucmVuZGVyKGlucHV0KTtcblxuICAgICAgICBvdXRwdXQgPSBvdXRwdXQucmVwbGFjZSgvJTVCL2csICdbJyk7XG4gICAgICAgIG91dHB1dCA9IG91dHB1dC5yZXBsYWNlKC8lNUQvZywgJ10nKTtcblxuICAgICAgICBpZiAoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmxwLnBhcnNlX21vZHhfdGFncyddID09IDEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcnNlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnBhcnNlUmVxdWVzdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB0aW1lb3V0ID0gcGFyc2VJbnQoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmxwLnBhcnNlX21vZHhfdGFnc190aW1lb3V0J10gfHwgMzAwKTtcblxuICAgICAgICAgICAgdGhpcy5wYXJzZVJlcXVlc3QgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgTU9EeC5BamF4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IG1hcmtkb3duRWRpdG9yLmNvbmZpZy5jb25uZWN0b3JVcmxcbiAgICAgICAgICAgICAgICAgICAgLHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnbWdyL2VkaXRvci9wcm9jZXNzY29udGVudCdcbiAgICAgICAgICAgICAgICAgICAgICAgICxjb250ZW50OiBvdXRwdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICxyZXNvdXJjZTogTU9EeC5yZXF1ZXN0LmlkXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzVXBsb2FkIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24ocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcudXBkYXRlKHIuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh0aGlzLmVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvdyArIDIpID49IHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5nZXREb2N1bWVudCgpLmdldExlbmd0aCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcuZG9tLnNjcm9sbFRvcCA9IHRoaXMucHJldmlldy5kb20uc2Nyb2xsSGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcuZml4SGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcyksIHRpbWVvdXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3LnVwZGF0ZShvdXRwdXQpO1xuXG4gICAgICAgICAgICBpZiAoKHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93ICsgMikgPj0gdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLmdldERvY3VtZW50KCkuZ2V0TGVuZ3RoKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcuZG9tLnNjcm9sbFRvcCA9IHRoaXMucHJldmlldy5kb20uc2Nyb2xsSGVpZ2h0XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucHJldmlldy5maXhIZWlnaHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFNYXJrZG93bi5kb20udmFsdWUgPSB0aGlzLmVkaXRvci5nZXRWYWx1ZSgpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLmRvbS52YWx1ZSA9IG91dHB1dDtcblxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cblxuICAgICxjYXRjaEFuZERvTm90aGluZzogZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgLGRyb3A6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmIChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmVuYWJsZV9pbWFnZV91cGxvYWQnXSA9PSAxIHx8IE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ZpbGVfdXBsb2FkJ10gPT0gMSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGaWxlcyhlLmRhdGFUcmFuc2Zlci5maWxlcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAsaGFuZGxlRmlsZXM6IGZ1bmN0aW9uKGZpbGVzLCBtb2JpbGUpIHtcbiAgICAgICAgbW9iaWxlID0gbW9iaWxlIHx8IDA7XG5cbiAgICAgICAgRXh0LmVhY2goZmlsZXMsIGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgIHZhciBpc0ltYWdlID0gL15pbWFnZVxcLy8udGVzdChmaWxlLnR5cGUpO1xuXG4gICAgICAgICAgICBpZiAoaXNJbWFnZSkge1xuICAgICAgICAgICAgICAgIGlmIChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmVuYWJsZV9pbWFnZV91cGxvYWQnXSA9PSAwKSByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jaGVja1R5cGUoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5pbWFnZV90eXBlcyddLCBmaWxlKSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbE1lc3NhZ2UoZmlsZSwgJ2ltYWdlJywgXygnbWFya2Rvd25lZGl0b3IuZXJyLnVwbG9hZC51bnN1cHBvcnRlZF9pbWFnZScpKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jaGVja1NpemUoZmlsZS5zaXplKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxNZXNzYWdlKGZpbGUsICdpbWFnZScsIF8oJ21hcmtkb3duZWRpdG9yLmVyci51cGxvYWQudG9vX2JpZycpKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuZW5hYmxlX2Nyb3BwZXInXSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIE1PRHgubG9hZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB4dHlwZTogJ21hcmtkb3duZWRpdG9yLXdpbmRvdy1jcm9wcGVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgLGZpbGU6IGZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICxtZDogdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgLG1vYmlsZTogbW9iaWxlXG4gICAgICAgICAgICAgICAgICAgIH0pLnNob3coKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGUoZmlsZSwgJ2ltYWdlJywgbW9iaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmVuYWJsZV9maWxlX3VwbG9hZCddID09IDApIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrVHlwZShNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmZpbGVfdHlwZXMnXSwgZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsTWVzc2FnZShmaWxlLCAnZmlsZScsIF8oJ21hcmtkb3duZWRpdG9yLmVyci51cGxvYWQudW5zdXBwb3J0ZWRfZmlsZScpKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tTaXplKGZpbGUuc2l6ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsTWVzc2FnZShmaWxlLCAnZmlsZScsIF8oJ21hcmtkb3duZWRpdG9yLmVyci51cGxvYWQudG9vX2JpZycpKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGUoZmlsZSwgJ2ZpbGUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cblxuICAgICxjaGVja1NpemU6IGZ1bmN0aW9uKHNpemUpe1xuICAgICAgICB2YXIgbWF4U2l6ZSA9IE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQubWF4X3NpemUnXTtcbiAgICAgICAgaWYgKCFtYXhTaXplIHx8IG1heFNpemUgPT0gJycpIG1heFNpemUgPSAoTU9EeC5jb25maWdbJ3VwbG9hZF9tYXhzaXplJ10gfHwgJzIwOTcxNTInKTtcblxuICAgICAgICBtYXhTaXplID0gcGFyc2VJbnQobWF4U2l6ZSk7XG5cbiAgICAgICAgaWYgKG1heFNpemUgPT0gMCkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHNpemUgPD0gbWF4U2l6ZTtcbiAgICB9XG5cbiAgICAsY2hlY2tUeXBlOiBmdW5jdGlvbihhbGxvd2VkVHlwZXMsIGZpbGUpIHtcbiAgICAgICAgYWxsb3dlZFR5cGVzID0gYWxsb3dlZFR5cGVzLnNwbGl0KCcsJyk7XG5cbiAgICAgICAgcmV0dXJuIGFsbG93ZWRUeXBlcy5pbmRleE9mKGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpKSAhPSAtMTtcbiAgICB9XG5cbiAgICAsdXBsb2FkRmlsZTogZnVuY3Rpb24oZmlsZSwgdHlwZSwgbW9iaWxlKSB7XG4gICAgICAgIHR5cGUgPSB0eXBlIHx8ICdmaWxlJztcbiAgICAgICAgbW9iaWxlID0gbW9iaWxlIHx8IDA7XG5cbiAgICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcy5jcmVhdGVVcGxvYWRlcigpO1xuXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdhY3Rpb24nLCAnbWdyL2VkaXRvci8nICsgdHlwZSArICd1cGxvYWQnKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1lJywgZmlsZS5uYW1lKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdyZXNvdXJjZScsIHRoaXMuY29uZmlnLnJlc291cmNlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtb2JpbGUnLCBtb2JpbGUpO1xuXG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9wZW4oJ1BPU1QnLCBtYXJrZG93bkVkaXRvci5jb25maWcuY29ubmVjdG9yVXJsKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1Bvd2VyZWQtQnknLCAnTU9EeCcpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignbW9kQXV0aCcsIEV4dC5BamF4LmRlZmF1bHRIZWFkZXJzLm1vZEF1dGgpO1xuXG4gICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50Lmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGUgPSAoZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDAgfCAwKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlci5jaGlsZCgnLnByb2dyZXNzJykuc2V0V2lkdGgoY29tcGxldGUgKyAnJScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlUHJlZml4ID0gKHR5cGUgPT0gJ2ltYWdlJykgPyAnIScgOiAnJztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZExpbmUgPSAodHlwZSA9PSAnaW1hZ2UnKSA/ICdcXG5cXG4nIDogJ1xcbic7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmluc2VydChpbWFnZVByZWZpeCArICdbJyArIHJlcy5vYmplY3QubmFtZSArICddKCcgKyByZXMub2JqZWN0LnBhdGggKyAnIFwiJyArIHJlcy5vYmplY3QubmFtZSArICdcIiknICsgZW5kTGluZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsVXBsb2FkZXIodXBsb2FkZXIsIHJlcy5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICB4aHIuc2VuZChmb3JtRGF0YSk7XG4gICAgfVxuXG4gICAgLGNyZWF0ZVVwbG9hZGVyOiBmdW5jdGlvbih0eXBlLCBmaWxlTmFtZSkge1xuICAgICAgICB2YXIgdXBsb2FkZXIgPSBFeHQuRG9tSGVscGVyLmluc2VydEZpcnN0KHRoaXMuc3RhdHVzQmFyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBodG1sOiAnPGRpdiBjbGFzcz1cInByb2dyZXNzXCI+PGkgY2xhc3M9XCJpY29uIGljb24tc3Bpbm5lciBpY29uLXNwaW5cIj48L2k+IDxzcGFuPicgKyBfKCdtYXJrZG93bmVkaXRvci51cGxvYWRpbmdfJyArIHR5cGUpICsgZmlsZU5hbWUgKyAnPC9zcGFuPjwvZGl2PidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIEV4dC5nZXQodXBsb2FkZXIpO1xuICAgIH1cblxuICAgICxmYWlsVXBsb2FkZXI6IGZ1bmN0aW9uKHVwbG9hZGVyLCBtZXNzYWdlKSB7XG4gICAgICAgIHVwbG9hZGVyLmNoaWxkKCcucHJvZ3Jlc3MnKS5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJy5wcm9ncmVzcycpLnNldFdpZHRoKCcxMDAlJyk7XG5cbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJ2knKS5hZGRDbGFzcygncmVtb3ZlLW1lc3NhZ2UnKTtcbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJ2knKS5yZXBsYWNlQ2xhc3MoJ2ljb24tc3Bpbm5lcicsICdpY29uLXJlbW92ZScpO1xuICAgICAgICB1cGxvYWRlci5jaGlsZCgnaScpLnJlbW92ZUNsYXNzKCdpY29uLXNwaW4nKTtcblxuICAgICAgICB1cGxvYWRlci5jaGlsZCgnc3BhbicpLmRvbS5pbm5lckhUTUwgKz0gJyBmYWlsZWQuICcgKyBtZXNzYWdlO1xuICAgICAgICB1cGxvYWRlci5jaGlsZCgnLnJlbW92ZS1tZXNzYWdlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLGZhaWxNZXNzYWdlOiBmdW5jdGlvbihmaWxlLCB0eXBlLCBtZXNzYWdlKSB7XG4gICAgICAgIHZhciB1cGxvYWRlciA9IHRoaXMuY3JlYXRlVXBsb2FkZXIodHlwZSwgZmlsZS5uYW1lKTtcbiAgICAgICAgdGhpcy5mYWlsVXBsb2FkZXIodXBsb2FkZXIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgICxpc01vYmlsZURldmljZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIHdpbmRvdy5vcmllbnRhdGlvbiAhPT0gXCJ1bmRlZmluZWRcIikgfHwgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignSUVNb2JpbGUnKSAhPT0gLTEpO1xuICAgIH1cbn0pO1xuXG5NT0R4LmxvYWRSVEUgPSBmdW5jdGlvbihpZCkge1xuICAgIG5ldyBtYXJrZG93bkVkaXRvci5FZGl0b3Ioe1xuICAgICAgICBtZEVsZW1lbnRJZDogaWRcbiAgICB9KTtcbn07XG5cbk1PRHguYWZ0ZXJUVkxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWxzID0gRXh0LnF1ZXJ5KCd0ZXh0YXJlYS5tb2R4LXJpY2h0ZXh0Jyk7XG5cbiAgICBFeHQuZWFjaChlbHMsIGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICBlbGVtZW50ID0gRXh0LmdldChlbGVtZW50KTtcbiAgICAgICAgaWYgKCFlbGVtZW50KSByZXR1cm4gdHJ1ZTtcblxuICAgICAgICBpZiAobWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHNbZWxlbWVudC5pZF0pIHJldHVybiB0cnVlO1xuXG4gICAgICAgIG1hcmtkb3duRWRpdG9yLmxvYWRlZEVsZW1lbnRzW2VsZW1lbnQuaWRdID0gbmV3IG1hcmtkb3duRWRpdG9yLkVkaXRvcih7XG4gICAgICAgICAgICBtZEVsZW1lbnRJZDogZWxlbWVudC5pZFxuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG59O1xuXG5NT0R4LnVubG9hZFRWUlRFID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVscyA9IEV4dC5xdWVyeSgnLm1vZHgtcmljaHRleHQnKTtcblxuICAgIEV4dC5lYWNoKGVscywgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSBFeHQuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmICghbWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHNbZWxlbWVudC5pZF0pIHJldHVybiB0cnVlO1xuXG4gICAgICAgIG1hcmtkb3duRWRpdG9yLmxvYWRlZEVsZW1lbnRzW2VsZW1lbnQuaWRdLmRlc3Ryb3koKTtcblxuICAgIH0pO1xufTsiLCJtYXJrZG93bkVkaXRvci5jb21iby5Dcm9wcGVyUHJvZmlsZSA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuY3JvcHBlci5wcm9maWxlcyddIHx8ICdbXScpO1xuXG4gICAgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICAgIEV4dC5hcHBseUlmKGNvbmZpZyx7XG4gICAgICAgIHN0b3JlOiBuZXcgRXh0LmRhdGEuSnNvblN0b3JlKHtcbiAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICxmaWVsZHM6IFsnbmFtZScsICd3aWR0aCcsICdoZWlnaHQnLCAncmF0aW8nXVxuICAgICAgICB9KVxuICAgICAgICAsZGlzcGxheUZpZWxkOiAnbmFtZSdcbiAgICAgICAgLG1vZGU6ICdsb2NhbCdcbiAgICAgICAgLHZhbHVlRmllbGQ6ICduYW1lJ1xuICAgICAgICAsZWRpdGFibGU6IGZhbHNlXG4gICAgICAgICx2YWx1ZTogZGF0YVswXSA/IGRhdGFbMF0ubmFtZSA6ICcnXG4gICAgfSk7XG5cbiAgICB2YXIgc2hvd0Rlc2NyaXB0aW9uID0gcGFyc2VJbnQoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuc2hvd19kZXNjcmlwdGlvbiddIHx8IDApO1xuICAgIGlmIChzaG93RGVzY3JpcHRpb24pIHtcbiAgICAgICAgY29uZmlnLnRwbCA9IG5ldyBFeHQuWFRlbXBsYXRlKCc8dHBsIGZvcj1cIi5cIj48ZGl2IGNsYXNzPVwieC1jb21iby1saXN0LWl0ZW1cIj48c3BhbiBzdHlsZT1cImZvbnQtd2VpZ2h0OiBib2xkXCI+e25hbWV9PC9zcGFuPidcbiAgICAgICAgICAgICwnPGJyIC8+PHRwbCBpZj1cIndpZHRoXCI+Vzp7d2lkdGh9IDwvdHBsPjx0cGwgaWY9XCJoZWlnaHRcIj5IOntoZWlnaHR9IDwvdHBsPjx0cGwgaWY9XCJyYXRpb1wiPlI6e3JhdGlvfTwvdHBsPjwvZGl2PjwvdHBsPicpO1xuICAgIH1cblxuICAgIG1hcmtkb3duRWRpdG9yLmNvbWJvLkNyb3BwZXJQcm9maWxlLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLGNvbmZpZyk7XG59O1xuRXh0LmV4dGVuZChtYXJrZG93bkVkaXRvci5jb21iby5Dcm9wcGVyUHJvZmlsZSxNT0R4LmNvbWJvLkNvbWJvQm94KTtcbkV4dC5yZWcoJ21hcmtkb3duZWRpdG9yLWNvbWJvLWNyb3BwZXItcHJvZmlsZScsbWFya2Rvd25FZGl0b3IuY29tYm8uQ3JvcHBlclByb2ZpbGUpOyIsIm1hcmtkb3duRWRpdG9yLndpbmRvdy5Dcm9wcGVyID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICAgIGNvbmZpZy5jcm9wcGVyU2VsZWN0b3IgPSBjb25maWcuY3JvcHBlclNlbGVjdG9yIHx8ICcuaW1hZ2UtdXBsb2FkLXdyYXBwZXIgPiBpbWcnO1xuXG4gICAgdmFyIGlkID0gRXh0LmlkKCk7XG5cbiAgICBFeHQuYXBwbHlJZihjb25maWcse1xuICAgICAgICBtb2RhbDogZmFsc2VcbiAgICAgICAgLGxheW91dDogJ2F1dG8nXG4gICAgICAgICxjbG9zZUFjdGlvbjogJ2hpZGUnXG4gICAgICAgICxzaGFkb3c6IHRydWVcbiAgICAgICAgLHJlc2l6YWJsZTogdHJ1ZVxuICAgICAgICAsY29sbGFwc2libGU6IHRydWVcbiAgICAgICAgLG1heGltaXphYmxlOiBmYWxzZVxuICAgICAgICAsYXV0b0hlaWdodDogZmFsc2VcbiAgICAgICAgLGF1dG9TY3JvbGw6IHRydWVcbiAgICAgICAgLGFsbG93RHJvcDogdHJ1ZVxuICAgICAgICAsd2lkdGg6IDgwMFxuICAgICAgICAsbW9iaWxlOiAwXG4gICAgICAgICx0aXRsZTogXygnbWFya2Rvd25lZGl0b3IuY3JvcHBlci5jcm9wX2ltYWdlJylcbiAgICAgICAgLGNsczogJ21vZHgtd2luZG93IG1hcmtkb3duZWRpdG9yLWNyb3BwZXItd2luZG93J1xuICAgICAgICAsaXRlbXM6W3tcbiAgICAgICAgICAgIGxheW91dDogJ2NvbHVtbidcbiAgICAgICAgICAgICxib3JkZXI6IGZhbHNlXG4gICAgICAgICAgICAsZGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICBsYXlvdXQ6ICdmb3JtJ1xuICAgICAgICAgICAgICAgICxsYWJlbEFsaWduOiAndG9wJ1xuICAgICAgICAgICAgICAgICxsYWJlbFNlcGFyYXRvcjogJydcbiAgICAgICAgICAgICAgICAsYW5jaG9yOiAnMTAwJSdcbiAgICAgICAgICAgICAgICAsYm9yZGVyOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLGl0ZW1zOiBbe1xuICAgICAgICAgICAgICAgIGNvbHVtbldpZHRoOiAwLjFcbiAgICAgICAgICAgICAgICAsZGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgbXNnVGFyZ2V0OiAndW5kZXInXG4gICAgICAgICAgICAgICAgICAgICxhbmNob3I6ICcxMDAlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAsY2xzOiAnbWFya2Rvd25lZGl0b3ItdG9vbGJhcidcbiAgICAgICAgICAgICAgICAsaXRlbXM6IFt7XG4gICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICAsdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLWFycm93cyBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgICAgICAgICAgLHRvb2x0aXA6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIubW92ZScpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06ICdtb3ZlJ1xuICAgICAgICAgICAgICAgICAgICAsYWN0aW9uOiAnc2V0RHJhZ01vZGUnXG4gICAgICAgICAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICAsdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLWNyb3AgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICAgICAgICAgICx0b29sdGlwOiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLmNyb3AnKVxuICAgICAgICAgICAgICAgICAgICAsc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLHBhcmFtOiAnY3JvcCdcbiAgICAgICAgICAgICAgICAgICAgLGFjdGlvbjogJ3NldERyYWdNb2RlJ1xuICAgICAgICAgICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgICAgICB4dHlwZTogJ2J1dHRvbidcbiAgICAgICAgICAgICAgICAgICAgLHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1zZWFyY2gtcGx1cyBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgICAgICAgICAgLHRvb2x0aXA6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuem9vbV9pbicpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06IDAuMVxuICAgICAgICAgICAgICAgICAgICAsYWN0aW9uOiAnem9vbSdcbiAgICAgICAgICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2FsbENyb3BwZXJBY3Rpb25cbiAgICAgICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdidXR0b24nXG4gICAgICAgICAgICAgICAgICAgICx0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tc2VhcmNoLW1pbnVzIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAsdG9vbHRpcDogXygnbWFya2Rvd25lZGl0b3IuY3JvcHBlci56b29tX291dCcpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06IC0wLjFcbiAgICAgICAgICAgICAgICAgICAgLGFjdGlvbjogJ3pvb20nXG4gICAgICAgICAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICAsdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLXJvdGF0ZS1sZWZ0IGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAsdG9vbHRpcDogXygnbWFya2Rvd25lZGl0b3IuY3JvcHBlci5yb3RhdGVfbGVmdCcpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06IC05MFxuICAgICAgICAgICAgICAgICAgICAsYWN0aW9uOiAncm90YXRlJ1xuICAgICAgICAgICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgICAgICB4dHlwZTogJ2J1dHRvbidcbiAgICAgICAgICAgICAgICAgICAgLHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1yb3RhdGUtcmlnaHQgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICAgICAgICAgICx0b29sdGlwOiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnJvdGF0ZV9yaWdodCcpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06IDkwXG4gICAgICAgICAgICAgICAgICAgICxhY3Rpb246ICdyb3RhdGUnXG4gICAgICAgICAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICAsdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLXJlbW92ZSBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgICAgICAgICAgLHRvb2x0aXA6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuY2xlYXJfY3JvcHBlcicpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06IG51bGxcbiAgICAgICAgICAgICAgICAgICAgLGFjdGlvbjogJ2NsZWFyJ1xuICAgICAgICAgICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBjb2x1bW5XaWR0aDogMC45XG4gICAgICAgICAgICAgICAgLGRlZmF1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgIG1zZ1RhcmdldDogJ3VuZGVyJ1xuICAgICAgICAgICAgICAgICAgICAsYW5jaG9yOiAnMTAwJSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLGNsczogJ21hcmtkb3duZWRpdG9yLWNyb3BwZXInXG4gICAgICAgICAgICAgICAgLGl0ZW1zOiBbe1xuICAgICAgICAgICAgICAgICAgICBodG1sOiAnPGRpdiBjbGFzcz1cImltYWdlLXVwbG9hZC13cmFwcGVyXCI+PGltZyBzcmM9XCInICsgVVJMLmNyZWF0ZU9iamVjdFVSTChjb25maWcuZmlsZSkgKyAnXCI+PC9kaXY+J1xuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgICAgICAsYmJhcjogW3tcbiAgICAgICAgICAgIHh0eXBlOiAnbWFya2Rvd25lZGl0b3ItY29tYm8tY3JvcHBlci1wcm9maWxlJ1xuICAgICAgICAgICAgLGlkOiBpZCArICctY3JvcHBlci1wcm9maWxlJ1xuICAgICAgICAgICAgLGxpc3RlbmVyczoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24oY29tYm8sIHZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlQ3JvcHBlclByb2ZpbGUodmFsdWUuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCctPicse1xuICAgICAgICAgICAgdGV4dDogXygnY2FuY2VsJylcbiAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2xvc2VcbiAgICAgICAgfSx7XG4gICAgICAgICAgICB0ZXh0OiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnVwbG9hZCcpXG4gICAgICAgICAgICAsY2xzOiAncHJpbWFyeS1idXR0b24nXG4gICAgICAgICAgICAsc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICxjcm9wOiAwXG4gICAgICAgICAgICAsaGFuZGxlcjogdGhpcy51cGxvYWRcbiAgICAgICAgfSx7XG4gICAgICAgICAgICB0ZXh0OiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLmNyb3BfdXBsb2FkJylcbiAgICAgICAgICAgICxjbHM6ICdwcmltYXJ5LWJ1dHRvbidcbiAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgLGNyb3A6IDFcbiAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLnVwbG9hZFxuICAgICAgICB9XVxuICAgICAgICAsbGlzdGVuZXJzOiB7XG4gICAgICAgICAgICAnc2hvdyc6IHtcbiAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjcm9wcGVyT3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjcm9wcGVyRWwgPSAkKCcjJyArIHRoaXMuaWQgKyAnICcgKyBjb25maWcuY3JvcHBlclNlbGVjdG9yKTtcblxuICAgICAgICAgICAgICAgICAgICBjcm9wcGVyT3B0aW9ucy5jcm9wID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VEYXRhID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd7XCJ4XCI6JyArIGRhdGEueCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXCJ5XCI6JyArIGRhdGEueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXCJoZWlnaHRcIjonICsgZGF0YS5oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1wid2lkdGhcIjonICsgZGF0YS53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXCJyb3RhdGVcIjonICsgZGF0YS5yb3RhdGUgKyAnfSdcbiAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbigpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY3JvcHBlckVsLmNyb3BwZXIoY3JvcHBlck9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9maWxlID0gRXh0LmdldENtcChpZCArICctY3JvcHBlci1wcm9maWxlJykuc3RvcmUuZ2V0QXQoMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlQ3JvcHBlclByb2ZpbGUocHJvZmlsZS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNjb3BlOiB0aGlzXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBtYXJrZG93bkVkaXRvci53aW5kb3cuQ3JvcHBlci5zdXBlcmNsYXNzLmNvbnN0cnVjdG9yLmNhbGwodGhpcyxjb25maWcpO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuXG59O1xuRXh0LmV4dGVuZChtYXJrZG93bkVkaXRvci53aW5kb3cuQ3JvcHBlciwgRXh0LldpbmRvdyx7XG4gICAgaW1hZ2VEYXRhOiAnJ1xuICAgICxjcm9wcGVyUHJvZmlsZToge25hbWU6ICcnfVxuXG4gICAgLGNoYW5nZUNyb3BwZXJQcm9maWxlOiBmdW5jdGlvbihwcm9maWxlKXtcbiAgICAgICAgdmFyIHJhdGlvO1xuXG4gICAgICAgIGlmIChwcm9maWxlLnJhdGlvICE9IFwiXCIpIHtcbiAgICAgICAgICAgIHJhdGlvID0gcHJvZmlsZS5yYXRpbztcbiAgICAgICAgICAgIHJhdGlvLnJlcGxhY2UoL1teLTp4KClcXGQvKisuXS9nLCAnJyk7XG4gICAgICAgICAgICByYXRpbyA9IGV2YWwocmF0aW8pIHx8IE5hTjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChwcm9maWxlLndpZHRoICYmIHByb2ZpbGUuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gcGFyc2VJbnQocHJvZmlsZS53aWR0aCk7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KHByb2ZpbGUuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBpZiAod2lkdGggPiAwICYmIGhlaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmF0aW8gPSB3aWR0aCAvIGhlaWdodDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByYXRpbyA9IE5hTjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhdGlvID0gTmFOO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jcm9wcGVyUHJvZmlsZSA9IHByb2ZpbGU7XG5cbiAgICAgICAgdGhpcy5jYWxsQ3JvcHBlckFjdGlvbih7YWN0aW9uOiAnc2V0QXNwZWN0UmF0aW8nLCBwYXJhbTogcmF0aW99KTtcbiAgICB9XG5cbiAgICAsdXBsb2FkOiBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcy5jb25maWcubWQuY3JlYXRlVXBsb2FkZXIoJ2ltYWdlJywgdGhpcy5jb25maWcuZmlsZS5uYW1lKTtcblxuICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgdGhpcy5jb25maWcuZmlsZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnYWN0aW9uJywgJ21nci9lZGl0b3IvaW1hZ2V1cGxvYWQnKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdpbWFnZURhdGEnLCB0aGlzLmltYWdlRGF0YSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbmFtZScsIHRoaXMuY29uZmlnLmZpbGUubmFtZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnY3JvcCcsIGJ1dHRvbi5jcm9wKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdyZXNvdXJjZScsIHRoaXMuY29uZmlnLm1kLmNvbmZpZy5yZXNvdXJjZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbW9iaWxlJywgdGhpcy5jb25maWcubW9iaWxlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwcm9maWxlJywgdGhpcy5jcm9wcGVyUHJvZmlsZS5uYW1lKTtcblxuICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci5vcGVuKCdQT1NUJywgbWFya2Rvd25FZGl0b3IuY29uZmlnLmNvbm5lY3RvclVybCk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdQb3dlcmVkLUJ5JywgJ01PRHgnKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ21vZEF1dGgnLCBFeHQuQWpheC5kZWZhdWx0SGVhZGVycy5tb2RBdXRoKTtcblxuICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5sZW5ndGhDb21wdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbXBsZXRlID0gKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsICogMTAwIHwgMCk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXIuY2hpbGQoJy5wcm9ncmVzcycpLnNldFdpZHRoKGNvbXBsZXRlICsgJyUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWQuZWRpdG9yLmluc2VydCgnIVsnICsgcmVzLm9iamVjdC5uYW1lICsgJ10oJyArIHJlcy5vYmplY3QucGF0aCArICcgXCInICsgcmVzLm9iamVjdC5uYW1lICsgJ1wiKVxcblxcbicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLm1kLmZhaWxVcGxvYWRlcih1cGxvYWRlciwgcmVzLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcblxuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgLGNhbGxDcm9wcGVyQWN0aW9uOiBmdW5jdGlvbihidG4pIHtcbiAgICAgICAgdGhpcy4kY3JvcHBlckVsLmNyb3BwZXIoYnRuLmFjdGlvbiwgYnRuLnBhcmFtKTtcbiAgICB9XG5cbiAgICAsY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLiRjcm9wcGVyRWwuY3JvcHBlcihcImRlc3Ryb3lcIik7XG5cbiAgICAgICAgbWFya2Rvd25FZGl0b3Iud2luZG93LkNyb3BwZXIuc3VwZXJjbGFzcy5jbG9zZS5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLmNvbmZpZy5tZC5lZGl0b3IuZm9jdXMoKTtcbiAgICB9XG59KTtcbkV4dC5yZWcoJ21hcmtkb3duZWRpdG9yLXdpbmRvdy1jcm9wcGVyJyxtYXJrZG93bkVkaXRvci53aW5kb3cuQ3JvcHBlcik7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=