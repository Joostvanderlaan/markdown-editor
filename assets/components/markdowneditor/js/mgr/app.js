Ext.ns("MarkdownEditor"),MarkdownEditor=function(e){e=e||{},MarkdownEditor.superclass.constructor.call(this,e)},Ext.extend(MarkdownEditor,Ext.Component,{window:{},combo:{},config:{}}),Ext.reg("markdowneditor",MarkdownEditor),markdownEditor=new MarkdownEditor,markdownEditor.loadedElements={},markdownEditor.Editor=function(e){e=e||{},e.resource=MODx.request.id||0,markdownEditor.Editor.superclass.constructor.call(this,e),this.config=e},Ext.extend(markdownEditor.Editor,Ext.Component,{remarkable:"",fullScreen:!1,diffDOM:null,localCache:{oEmbed:{}},initComponent:function(){MarkdownEditor.superclass.initComponent.call(this),this.diffDOM=new diffDOM,this.mdElementId&&Ext.onReady(this.render,this)},destroy:function(){this.editor.destroy(),this.mdContainer.remove(),this.taMarkdown.remove(),this.textarea.dom.style.display=null,this.textarea.dom.style.width=null,this.textarea.dom.style.height=null,MarkdownEditor.superclass.destroy.call(this)},render:function(){if(this.textarea=Ext.get(this.mdElementId),this.mdElementName=this.textarea.dom.name,this.textarea){this.buildUI(),this.registerAce(),this.registerRemarkable(),this.buildToolbox();var e=this.toolBox.child(".preview-button"),t=this.toolBox.child(".fullscreen-button"),i=this.toolBox.child(".splitscreen-button"),o=this.contentMD,r=Ext.get(Ext.DomHelper.append(o.parent(),{tag:"div","class":"preview-button-off",html:'<i class="icon icon-eye-slash icon-large"></i>',hidden:!0})),n=MODx.load({xtype:"modx-treedrop",target:o,targetEl:o,onInsert:function(e){return this.insert(e),this.focus(),!0}.bind(this.editor),iframe:!0});this.textarea.on("destroy",function(){n.destroy()});var a=parseInt(MODx.config["markdowneditor.general.split"]||0);1==a&&i.turnOn(),e.addListener("click",function(){this.showPreview(),this.hideContent(),this.statusBar.setDisplayed("none"),this.contentMD.parent().parent().addClass("preview"),r.show()},this),r.addListener("click",function(){this.hidePreview(),this.showContent(),this.statusBar.setDisplayed("block"),this.contentMD.parent().parent().removeClass("preview"),this.editor.focus(),r.hide()},this),i.addListener("click",function(){i.child("i").hasClass("icon-pause")?i.turnOn():i.turnOff()},this),t.addListener("click",function(){0==this.fullScreen?t.turnOn():t.turnOff(),this.statusBar.setDisplayed("block"),this.editor.resize(!0)},this),markdownEditor.content[this.mdElementName]&&this.editor.setValue(markdownEditor.content[this.mdElementName]),this.editor.selection.clearSelection(),this.preview.update(this.parse(this.editor.getValue())),this.preview.fixHeight(),this.editor.getSession().on("change",function(e){if("insertText"==e.data.action&&this.editor.getSession().getDocument().isNewLine(e.data.text)){var t=this.editor.getSession(),i=t.getDocument();null!=/^\s*(?:[*+-]|\d+\.)\s*$/.exec(i.getLine(e.data.range.start.row))&&i.removeLines(e.data.range.start.row,e.data.range.start.row)}this.parse(this.editor.getValue())}.bind(this))}},showContent:function(){this.contentMD.setDisplayed("block")},hideContent:function(){this.contentMD.setDisplayed("none")},showPreview:function(){this.preview.parent().setDisplayed("block")},hidePreview:function(){this.preview.parent().setDisplayed("none")},buildUI:function(){this.textarea.setDisplayed("none"),this.textarea.setWidth(0),this.textarea.setHeight(0),this.taMarkdown=Ext.get(Ext.DomHelper.insertBefore(this.textarea,{tag:"textarea",name:this.mdElementName+"_markdown","class":this.mdElementName+"_markdown"})),this.taMarkdown.setDisplayed("none"),this.taMarkdown.setWidth(0),this.taMarkdown.setHeight(0),this.mdContainer=Ext.get(Ext.DomHelper.insertBefore(this.textarea,{tag:"div","class":"markdown-container ace-"+(MODx.config["markdowneditor.general.theme"]||"monokai").toLowerCase().replace(/_/g,"-")}));var e=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"fullscreen-header ace_gutter",html:'<input type="text" />'})),t=Ext.getCmp("modx-resource-pagetitle");if(t){var i=e.child("input");i.dom.value=t.getValue(),i.on("change",function(){t.setValue(this.dom.value)}),t.on("change",function(e,t){i.dom.value=t})}var o=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"markdown-wrapper"}));this.contentMD=Ext.get(Ext.DomHelper.append(o,{tag:"div","class":this.textarea.dom.className+" content-md "+this.mdElementName+"_markdown"})),this.preview=Ext.get(Ext.DomHelper.append(o,{tag:"div","class":"markdown-body preview-md"})),this.preview=Ext.get(Ext.DomHelper.append(this.preview.dom,{tag:"div"}));var r=this;this.preview.fixHeight=function(){r.editor.resize();var e=r.editor.getSession().getScreenLength()*r.editor.renderer.lineHeight+r.editor.renderer.scrollBar.getWidth()+25;this.parent().setHeight(e)},1==MODx.config["markdowneditor.upload.enable_image_upload"]||1==MODx.config["markdowneditor.upload.enable_file_upload"]?(this.statusBar=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"status-bar ace_gutter"})),this.isMobileDevice()?(this.statusBar.dom.innerHTML='<div class="upload-bar"> <input class="hidden" name="md_file_'+this.statusBar.id+'" id="'+this.statusBar.id+'-file" type="file" multiple /><input class="hidden" name="md_file_'+this.statusBar.id+'-mobile" id="'+this.statusBar.id+'-file-mobile" type="file" accept="image/*" capture="camera" />'+_("markdowneditor.status_bar_message_mobile",{id:this.statusBar.id+"-file",id_mobile:this.statusBar.id+"-file-mobile"})+"</div>",this.statusBar.child("#"+this.statusBar.id+"-file-mobile").on("change",function(e,t){this.handleFiles(t.files,1),t.value=""},this)):(this.statusBar.dom.innerHTML='<div class="upload-bar"> <input class="hidden" name="md_file_'+this.statusBar.id+'" id="'+this.statusBar.id+'-file" type="file" multiple>'+_("markdowneditor.status_bar_message",{id:this.statusBar.id+"-file"})+"</div>",this.statusBar.child("#"+this.statusBar.id+"-file").on("change",function(e,t){this.handleFiles(t.files),t.value=""},this))):this.statusBar=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"status-bar",html:_("markdowneditor.status_bar_disabled")})),Ext.DomHelper.append(this.mdContainer.dom,{tag:"span",style:"clear: both"})},buildToolbox:function(){this.toolBox=Ext.get(Ext.DomHelper.append(this.statusBar,{tag:"div","class":"toolbox",cn:[{tag:"div","class":"preview-button",html:'<i class="icon icon-eye icon-large"></i>'},{tag:"div","class":"splitscreen-button",html:'<i class="icon icon-pause icon-large"></i>'},{tag:"div","class":"fullscreen-button",html:'<i class="icon icon-expand icon-large"></i>'}]}));var e=this;this.toolBox.child(".splitscreen-button").turnOn=function(){this.child("i").removeClass("icon-pause"),this.child("i").addClass("icon-stop"),e.contentMD.parent().parent().addClass("split"),e.editor.resize(),e.preview.fixHeight()},this.toolBox.child(".splitscreen-button").turnOff=function(){this.child("i").addClass("icon-pause"),this.child("i").removeClass("icon-stop"),e.contentMD.parent().parent().removeClass("split"),e.editor.resize()},this.toolBox.child(".fullscreen-button").turnOn=function(){this.child("i").removeClass("icon-expand"),this.child("i").addClass("icon-compress");var t=Ext.get("modx-action-buttons");t&&t.addClass("markdowneditor-fullscreen"),e.fullScreen=!0,1==parseInt(MODx.config["markdowneditor.general.split_fullscreen"]||1)?e.toolBox.child(".splitscreen-button").turnOn():e.toolBox.child(".splitscreen-button").turnOff(),e.showPreview(),e.showContent(),e.editor.focus(),e.contentMD.parent().parent().addClass("fullscreen"),e.editor.setOption("maxLines",null),e.editor.resize()},this.toolBox.child(".fullscreen-button").turnOff=function(){this.child("i").addClass("icon-expand"),this.child("i").removeClass("icon-compress");var t=Ext.get("modx-action-buttons");t&&t.removeClass("markdowneditor-fullscreen"),e.fullScreen=!1,1==parseInt(MODx.config["markdowneditor.general.split"]||0)?e.toolBox.child(".splitscreen-button").turnOn():e.toolBox.child(".splitscreen-button").turnOff(),e.hidePreview(),e.showContent(),e.editor.focus(),e.contentMD.parent().parent().removeClass("fullscreen"),e.editor.setOption("maxLines",1/0),e.preview.fixHeight()}},registerAce:function(){this.editor=ace.edit(Ext.DomQuery.selectNode("div."+this.mdElementName+"_markdown")),ace.require("ace/layer/gutter_toolbar"),this.editor.setOptions({maxLines:1/0,minLines:25,enableBasicAutocompletion:!0,printMargin:!1,showGutter:!0,useSoftTabs:!0,showFoldWidgets:!1,showLineNumbers:!1,fontSize:parseInt(MODx.config["markdowneditor.general.font_size"])||12,fontFamily:MODx.config["markdowneditor.general.font_family"]||""}),this.editor.$blockScrolling=1/0,this.editor.session.setUseWrapMode(!0),this.editor.session.setWrapLimitRange(),this.editor.renderer.setScrollMargin(10,10),this.editor.session.setValue(this.textarea.getValue()),this.editor.session.setMode("ace/mode/markdowneditor"),this.editor.setTheme("ace/theme/"+(MODx.config["markdowneditor.general.theme"]||"monokai")),this.contentMD.hasClass("ace_dark")?this.mdContainer.addClass("theme-dark"):this.mdContainer.addClass("theme-light"),this.editor.selection.on("changeCursor",function(e,t){this.gutterToolbar&&this.gutterToolbar.update("");var i=t.getRange();i.start.row==i.end.row&&this.editor.session.addGutterDecoration(i.start.row,"")}.bind(this)),this.editor.session.gutterRenderer={getWidth:function(e,t,i){return i.characterWidth},getText:function(e,t,i){return i.element&&this.editor.getCursorPosition().row==t&&""==e.doc.$lines[t]?this.addGutterToolbar(i.element):i.element.innerHTML="",""}.bind(this)},this.editor.commands.addCommand({name:"Indent list",bindKey:{win:"Tab",mac:"Tab"},exec:function(e){var t=e.session.getLine(e.getCursorPosition().row),i=/^(\s*)(?:([-+*])|(\d+)\.)(\s+)/.exec(t);i?e.session.indentRows(e.getCursorPosition().row,e.getCursorPosition().row,"	"):e.indent()}}),this.editor.commands.addCommand({name:"Exit fullscreen",bindKey:{win:"Esc",mac:"Esc"},exec:function(){this.fullScreen&&this.toolBox.child(".fullscreen-button").turnOff()}.bind(this)});var e=ace.require("ace/ext/language_tools"),t={getCompletions:function(e,t,i,o,r){return 0===o.length?(r(null,[]),void 0):(MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/resource/getlist",prefix:o},listeners:{success:{fn:function(e){r(null,e.results)},scope:this}}}),void 0)}};e.addCompleter(t),this.editor.container.addEventListener("dragenter",this.catchAndDoNothing,!1),this.editor.container.addEventListener("dragover",this.catchAndDoNothing,!1),this.editor.container.addEventListener("drop",this.drop.bind(this),!1)},addGutterToolbar:function(e){this.gutterToolbar=Ext.get(e),this.isMobileDevice()?this.gutterToolbar.update('<i class="icon icon-plus icon-fixed-width"></i><div class="inline-toolbar"><i class="icon icon-archive icon-fixed-width"></i><label for="'+this.statusBar.id+'-file"><i class="icon icon-upload icon-fixed-width"></i></label><label for="'+this.statusBar.id+'-file-mobile"><i class="icon icon-camera icon-fixed-width"></i></label><i class="icon icon-code icon-fixed-width"></i></div>'):this.gutterToolbar.update('<i class="icon icon-plus icon-fixed-width"></i><div class="inline-toolbar"><i class="icon icon-archive icon-fixed-width"></i><label for="'+this.statusBar.id+'-file"><i class="icon icon-upload icon-fixed-width"></i></label><i class="icon icon-code icon-fixed-width"></i></div>');var t=this.gutterToolbar.child("i.icon-plus"),i=this.gutterToolbar.child(".inline-toolbar");t.turnOn=function(){t.addClass("md-icon-rotate-45"),i.show()},t.turnOff=function(){t.removeClass("md-icon-rotate-45"),i.hide()},t.on("click",function(){t.hasClass("md-icon-rotate-45")?t.turnOff():t.turnOn()}.bind(this)),this.gutterToolbar.child("i.icon-code").on("click",function(){MODx.load({xtype:"markdowneditor-window-oembed",success:function(e){this.editor.insert("[embed "+e.url+"]"),this.editor.focus()},scope:this}).show()}.bind(this)),this.gutterToolbar.child("i.icon-archive").on("click",function(){MODx.load({xtype:"modx-browser-window",source:parseInt(MODx.config["markdowneditor.general.source"]),hideSourceCombo:1!=parseInt(MODx.config["markdowneditor.general.source_select"]||0),onSelect:function(e){var t="";e.preview&&(t="!"),t=t+"["+e.name+"]("+e.fullRelativeUrl+' "'+e.name+'")',this.editor.insert(t),this.editor.focus()},scope:this}).show()}.bind(this))},registerRemarkable:function(){this.remarkable=new Remarkable({html:!0,highlight:function(e,t){var i="";if(t&&hljs.getLanguage(t))try{return i=hljs.highlight(t,e).value,i=i.replace(/\[\[/g,"&#91;&#91;"),i=i.replace(/]]/g,"&#93;&#93;")}catch(o){}try{return i=hljs.highlightAuto(e).value,i=i.replace(/\[\[/g,"&#91;&#91;"),i=i.replace(/]]/g,"&#93;&#93;")}catch(o){}return""}}),this.remarkable.inline.ruler.disable(["backticks"]);var e=function(e,t){if(this.localCache.oEmbed[e[t].url])return this.localCache.oEmbed[e[t].url];var i=Ext.id();return MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/editor/oembed",url:e[t].url},listeners:{success:{fn:function(o){var r=Ext.get(i);if(r){r.update(o.data),r.dom.removeAttribute("id"),this.localCache.oEmbed[e[t].url]=r.dom.outerHTML;var n=Ext.get(Ext.DomHelper.createDom({tag:"div",html:this.textarea.dom.value}));n.child("#"+i).update(o.data).dom.removeAttribute("id"),this.textarea.dom.value=n.dom.innerHTML}},scope:this}}}),'<div id="'+i+'" class="markdowneditor-oembed-content">[embed '+e[t].url+"]</div>"}.bind(this),t=this.remarkable;t.renderer.rules.code=function(){var e=t.renderer.rules.code;return function(){var t=e.apply(this,arguments);return t=t.replace(/\[\[/g,"&#91;&#91;"),t=t.replace(/]]/g,"&#93;&#93;")}}();var i=function(t){t.inline.ruler.push("oEmbed",this.oEmbedParser),t.renderer.rules.oEmbed=e}.bind(this),o=function(e){e.inline.ruler.push("modxCode",this.modxCodeParser)}.bind(this);this.remarkable.use(i),this.remarkable.use(o)},parse:function(e){var t=this.remarkable.render(e);if(t=t.replace(/%5B/g,"["),t=t.replace(/%5D/g,"]"),1==MODx.config["markdowneditor.lp.parse_modx_tags"]){this.parseRequest&&clearTimeout(this.parseRequest);var i=parseInt(MODx.config["markdowneditor.lp.parse_modx_tags_timeout"]||300);this.parseRequest=setTimeout(function(){MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/editor/processcontent",content:t,resource:MODx.request.id},isUpload:!0,listeners:{success:{fn:function(e){var t=document.createElement("div");t.innerHTML=e.data,this.diffDOM.apply(this.preview.dom,this.diffDOM.diff(this.preview.dom,t)),this.preview.fixHeight(),this.editor.getCursorPosition().row+2>=this.editor.getSession().getDocument().getLength()&&(this.preview.parent().dom.scrollTop=this.preview.parent().dom.scrollHeight)},scope:this}}})}.bind(this),i)}else{var o=document.createElement("div");o.innerHTML=t,this.diffDOM.apply(this.preview.dom,this.diffDOM.diff(this.preview.dom,o)),this.preview.fixHeight(),this.editor.getCursorPosition().row+2>=this.editor.getSession().getDocument().getLength()&&(this.preview.parent().dom.scrollTop=this.preview.parent().dom.scrollHeight)}return this.taMarkdown.dom.value=this.editor.getValue(),this.textarea.dom.value=t,t},oEmbedParser:function(e){var t=e.pos,i=e.src.charCodeAt(e.pos);if(91!==i)return!1;if(t++,i=e.src.charCodeAt(t),101!==i)return!1;if(t++,i=e.src.charCodeAt(t),109!==i)return!1;if(t++,i=e.src.charCodeAt(t),98!==i)return!1;if(t++,i=e.src.charCodeAt(t),101!==i)return!1;if(t++,i=e.src.charCodeAt(t),100!==i)return!1;if(t++,i=e.src.charCodeAt(t),32!==i)return!1;t++;for(var o=t,r=e.posMax,n=!1;r>t;){if(93===e.src.charCodeAt(t)){n=!0;break}if(32===e.src.charCodeAt(t))return!1;t++}if(!n)return!1;e.pos=t+1,e.pos>e.posMax&&(e.pos=e.posMax);var a=e.src.slice(o,t),s={type:"oEmbed",level:e.level,content:i,url:a};return e.push(s),!0},modxCodeParser:function(e,t){var i,o,r,n,a=e.pos;if(96!==e.src.charCodeAt(a))return!1;if(a++,96!==e.src.charCodeAt(a))return!1;if(a++,96!==e.src.charCodeAt(a))return!1;for(a++,i=e.posMax,o="```",r=n=a;-1!==(r=e.src.indexOf("`",n));){for(n=r+1;i>n&&96===e.src.charCodeAt(n);)n++;if(n-r===o.length)return t||e.push({type:"code",content:e.src.slice(a,r).replace(/[ \n]+/g," ").trim(),block:!1,level:e.level}),e.pos=n,!0}return t||(e.pending+=o),e.pos+=o.length,!0},catchAndDoNothing:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault(),(1==MODx.config["markdowneditor.upload.enable_image_upload"]||1==MODx.config["markdowneditor.upload.enable_file_upload"])&&this.handleFiles(e.dataTransfer.files)},handleFiles:function(e,t){t=t||0,Ext.each(e,function(e){var i=/^image\//.test(e.type);if(i){if(0==MODx.config["markdowneditor.upload.enable_image_upload"])return!0;if(!this.checkType(MODx.config["markdowneditor.upload.image_types"],e))return this.failMessage(e,"image",_("markdowneditor.err.upload.unsupported_image")),!0;if(!this.checkSize(e.size))return this.failMessage(e,"image",_("markdowneditor.err.upload.too_big")),!0;1==MODx.config["markdowneditor.cropper.enable_cropper"]?MODx.load({xtype:"markdowneditor-window-cropper",file:e,md:this,mobile:t}).show():(this.uploadFile(e,"image",t),this.editor.focus())}else{if(0==MODx.config["markdowneditor.upload.enable_file_upload"])return!0;if(!this.checkType(MODx.config["markdowneditor.upload.file_types"],e))return this.failMessage(e,"file",_("markdowneditor.err.upload.unsupported_file")),!0;if(!this.checkSize(e.size))return this.failMessage(e,"file",_("markdowneditor.err.upload.too_big")),!0;this.uploadFile(e,"file"),this.editor.focus()}},this)},checkSize:function(e){var t=MODx.config["markdowneditor.upload.max_size"];return t&&""!=t||(t=MODx.config.upload_maxsize||"2097152"),t=parseInt(t),0==t?!0:t>=e},checkType:function(e,t){e=e.split(",");var i=t.name.split(".").pop();return-1!=e.indexOf(i.toLowerCase())},uploadFile:function(e,t,i){t=t||"file",i=i||0;var o=this.createUploader(t,e.name),r=new FormData;r.append("file",e),r.append("action","mgr/editor/"+t+"upload"),r.append("name",e.name),r.append("resource",this.config.resource),r.append("mobile",i);var n=new XMLHttpRequest;n.open("POST",markdownEditor.config.connectorUrl),n.setRequestHeader("Powered-By","MODx"),n.setRequestHeader("modAuth",Ext.Ajax.defaultHeaders.modAuth),n.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;o.child(".progress").setWidth(t+"%")}}.bind(this),n.onload=function(){if(200===n.status){var e=JSON.parse(n.responseText);if(1==e.success){o.remove();var i="image"==t?"!":"",r="image"==t?"\n\n":"\n";this.editor.insert(i+"["+e.object.name+"]("+e.object.path+' "'+e.object.name+'")'+r)}else this.failUploader(o,e.message)}}.bind(this),n.send(r)},createUploader:function(e,t){var i=Ext.DomHelper.insertFirst(this.statusBar,{tag:"div",html:'<div class="progress"><i class="icon icon-spinner icon-spin"></i> <span>'+_("markdowneditor.uploading_"+e)+t+"</span></div>"});return Ext.get(i)},failUploader:function(e,t){e.child(".progress").addClass("error"),e.child(".progress").setWidth("100%"),e.child("i").addClass("remove-message"),e.child("i").replaceClass("icon-spinner","icon-remove"),e.child("i").removeClass("icon-spin"),e.child("span").dom.innerHTML+=" failed. "+t,e.child(".remove-message").on("click",function(){e.remove()})},failMessage:function(e,t,i){var o=this.createUploader(t,e.name);this.failUploader(o,i)},isMobileDevice:function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}}),MODx.loadRTE=function(e){new markdownEditor.Editor({mdElementId:e})},MODx.afterTVLoad=function(){var e=Ext.query("textarea.modx-richtext");Ext.each(e,function(e){return(e=Ext.get(e))?markdownEditor.loadedElements[e.id]?!0:(markdownEditor.loadedElements[e.id]=new markdownEditor.Editor({mdElementId:e.id}),void 0):!0})},MODx.unloadTVRTE=function(){var e=Ext.query(".modx-richtext");Ext.each(e,function(e){return(e=Ext.get(e))?markdownEditor.loadedElements[e.id]?(markdownEditor.loadedElements[e.id].destroy(),void 0):!0:!0})},markdownEditor.combo.CropperProfile=function(e){var t=JSON.parse(MODx.config["markdowneditor.cropper.profiles"]||"[]");e=e||{},Ext.applyIf(e,{store:new Ext.data.JsonStore({data:t,fields:["name","width","height","ratio"]}),displayField:"name",mode:"local",valueField:"name",editable:!1,value:t[0]?t[0].name:""});var i=parseInt(MODx.config["markdowneditor.cropper.show_description"]||0);i&&(e.tpl=new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-weight: bold">{name}</span>','<br /><tpl if="width">W:{width} </tpl><tpl if="height">H:{height} </tpl><tpl if="ratio">R:{ratio}</tpl></div></tpl>')),markdownEditor.combo.CropperProfile.superclass.constructor.call(this,e)},Ext.extend(markdownEditor.combo.CropperProfile,MODx.combo.ComboBox),Ext.reg("markdowneditor-combo-cropper-profile",markdownEditor.combo.CropperProfile),markdownEditor.window.Cropper=function(e){e=e||{},e.cropperSelector=e.cropperSelector||".image-upload-wrapper > img";var t=Ext.id();Ext.applyIf(e,{modal:!1,layout:"auto",closeAction:"hide",shadow:!0,resizable:!0,collapsible:!0,maximizable:!1,autoHeight:!1,autoScroll:!0,allowDrop:!0,width:800,mobile:0,title:_("markdowneditor.cropper.crop_image"),cls:"modx-window markdowneditor-cropper-window",items:[{layout:"column",border:!1,defaults:{layout:"form",labelAlign:"top",labelSeparator:"",anchor:"100%",border:!1},items:[{columnWidth:.1,defaults:{msgTarget:"under",anchor:"100%"},cls:"markdowneditor-toolbar",items:[{xtype:"button",text:'<i class="icon icon-arrows icon-large"></i>',tooltip:_("markdowneditor.cropper.move"),scope:this,param:"move",action:"setDragMode",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-crop icon-large"></i>',tooltip:_("markdowneditor.cropper.crop"),scope:this,param:"crop",action:"setDragMode",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-search-plus icon-large"></i>',tooltip:_("markdowneditor.cropper.zoom_in"),scope:this,param:.1,action:"zoom",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-search-minus icon-large"></i>',tooltip:_("markdowneditor.cropper.zoom_out"),scope:this,param:-.1,action:"zoom",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-rotate-left icon-large"></i>',tooltip:_("markdowneditor.cropper.rotate_left"),scope:this,param:-90,action:"rotate",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-rotate-right icon-large"></i>',tooltip:_("markdowneditor.cropper.rotate_right"),scope:this,param:90,action:"rotate",handler:this.callCropperAction},{xtype:"button",text:'<i class="icon icon-remove icon-large"></i>',tooltip:_("markdowneditor.cropper.clear_cropper"),scope:this,param:null,action:"clear",handler:this.callCropperAction}]},{columnWidth:.9,defaults:{msgTarget:"under",anchor:"100%"},cls:"markdowneditor-cropper",items:[{html:'<div class="image-upload-wrapper"><img src="'+URL.createObjectURL(e.file)+'"></div>'}]}]}],bbar:[{xtype:"markdowneditor-combo-cropper-profile",id:t+"-cropper-profile",listeners:{select:{fn:function(e,t){this.changeCropperProfile(t.data)},scope:this}}},"->",{text:_("cancel"),scope:this,handler:this.close},{text:_("markdowneditor.cropper.upload"),cls:"primary-button",scope:this,crop:0,handler:this.upload},{text:_("markdowneditor.cropper.crop_upload"),cls:"primary-button",scope:this,crop:1,handler:this.upload}],listeners:{show:{fn:function(){var i={};this.$cropperEl=$("#"+this.id+" "+e.cropperSelector),i.crop=function(e){this.imageData=['{"x":'+e.x,'"y":'+e.y,'"height":'+e.height,'"width":'+e.width,'"rotate":'+e.rotate+"}"].join()}.bind(this),this.$cropperEl.cropper(i);var o=Ext.getCmp(t+"-cropper-profile").store.getAt(0);this.changeCropperProfile(o.data)},scope:this}}}),markdownEditor.window.Cropper.superclass.constructor.call(this,e),this.config=e},Ext.extend(markdownEditor.window.Cropper,Ext.Window,{imageData:"",cropperProfile:{name:""},changeCropperProfile:function(profile){var ratio;if(""!=profile.ratio)ratio=profile.ratio,ratio.replace(/[^-:x()\d/*+.]/g,""),ratio=eval(ratio)||0/0;else if(profile.width&&profile.height){var width=parseInt(profile.width),height=parseInt(profile.height);ratio=width>0&&height>0?width/height:0/0}else ratio=0/0;this.cropperProfile=profile,this.callCropperAction({action:"setAspectRatio",param:ratio})},upload:function(e){var t=this.config.md.createUploader("image",this.config.file.name),i=new FormData;i.append("file",this.config.file),i.append("action","mgr/editor/imageupload"),i.append("imageData",this.imageData),i.append("name",this.config.file.name),i.append("crop",e.crop),i.append("resource",this.config.md.config.resource),i.append("mobile",this.config.mobile),i.append("profile",this.cropperProfile.name);var o=new XMLHttpRequest;o.open("POST",markdownEditor.config.connectorUrl),o.setRequestHeader("Powered-By","MODx"),o.setRequestHeader("modAuth",Ext.Ajax.defaultHeaders.modAuth),o.upload.onprogress=function(e){if(e.lengthComputable){var i=e.loaded/e.total*100|0;t.child(".progress").setWidth(i+"%")}}.bind(this),o.onload=function(){if(200===o.status){var e=JSON.parse(o.responseText);1==e.success?(t.remove(),this.config.md.editor.insert("!["+e.object.name+"]("+e.object.path+' "'+e.object.name+'")\n\n')):this.config.md.failUploader(t,e.message)}}.bind(this),o.send(i),this.close()},callCropperAction:function(e){this.$cropperEl.cropper(e.action,e.param)},close:function(){this.$cropperEl.cropper("destroy"),markdownEditor.window.Cropper.superclass.close.call(this),this.config.md.editor.focus()}}),Ext.reg("markdowneditor-window-cropper",markdownEditor.window.Cropper),markdownEditor.window.OEmbed=function(e){e=e||{},Ext.applyIf(e,{title:_("markdowneditor.oembed.embed_url"),closeAction:"close",resizable:!1,collapsible:!1,maximizable:!1,height:185,modal:!0,fields:this.getFields(e)}),markdownEditor.window.OEmbed.superclass.constructor.call(this,e)},Ext.extend(markdownEditor.window.OEmbed,MODx.Window,{getFields:function(){return[{xtype:"textfield",name:"url",fieldLabel:_("markdowneditor.oembed.url"),allowBlank:!1,anchor:"100%",vtype:"url"}]},submit:function(){var e=this.fp.getForm();e.isValid()&&(this.config.success&&Ext.callback(this.config.success,this.config.scope||this,[e.getValues()]),this.close())}}),Ext.reg("markdowneditor-window-oembed",markdownEditor.window.OEmbed);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbWJvLmpzIiwibWFya2Rvd25lZGl0b3Iud2luZG93LmpzIiwib2VtYmVkLndpbmRvdy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLEdBQUEsa0JBQ0EsZUFBQSxTQUFBLEdBQ0EsRUFBQSxNQUNBLGVBQUEsV0FBQSxZQUFBLEtBQUEsS0FBQSxJQUVBLElBQUEsT0FBQSxlQUFBLElBQUEsV0FDQSxVQUFBLFNBQUEsWUFFQSxJQUFBLElBQUEsaUJBQUEsZ0JBQ0EsZUFBQSxHQUFBLGdCQUVBLGVBQUEsa0JBRUEsZUFBQSxPQUFBLFNBQUEsR0FDQSxFQUFBLE1BQ0EsRUFBQSxTQUFBLEtBQUEsUUFBQSxJQUFBLEVBQ0EsZUFBQSxPQUFBLFdBQUEsWUFBQSxLQUFBLEtBQUEsR0FDQSxLQUFBLE9BQUEsR0FFQSxJQUFBLE9BQUEsZUFBQSxPQUFBLElBQUEsV0FDQSxXQUFBLEdBQ0EsWUFBQSxFQUNBLFFBQUEsS0FDQSxZQUNBLFdBRUEsY0FBQSxXQUNBLGVBQUEsV0FBQSxjQUFBLEtBQUEsTUFFQSxLQUFBLFFBQUEsR0FBQSxTQUVBLEtBQUEsYUFDQSxJQUFBLFFBQUEsS0FBQSxPQUFBLE9BSUEsUUFBQSxXQUNBLEtBQUEsT0FBQSxVQUVBLEtBQUEsWUFBQSxTQUNBLEtBQUEsV0FBQSxTQUVBLEtBQUEsU0FBQSxJQUFBLE1BQUEsUUFBQSxLQUNBLEtBQUEsU0FBQSxJQUFBLE1BQUEsTUFBQSxLQUNBLEtBQUEsU0FBQSxJQUFBLE1BQUEsT0FBQSxLQUVBLGVBQUEsV0FBQSxRQUFBLEtBQUEsT0FHQSxPQUFBLFdBSUEsR0FIQSxLQUFBLFNBQUEsSUFBQSxJQUFBLEtBQUEsYUFDQSxLQUFBLGNBQUEsS0FBQSxTQUFBLElBQUEsS0FFQSxLQUFBLFNBQUEsQ0FFQSxLQUFBLFVBQ0EsS0FBQSxjQUNBLEtBQUEscUJBQ0EsS0FBQSxjQUVBLElBQUEsR0FBQSxLQUFBLFFBQUEsTUFBQSxtQkFDQSxFQUFBLEtBQUEsUUFBQSxNQUFBLHNCQUNBLEVBQUEsS0FBQSxRQUFBLE1BQUEsdUJBRUEsRUFBQSxLQUFBLFVBRUEsRUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsRUFBQSxVQUNBLElBQUEsTUFDQSxRQUFBLHFCQUNBLEtBQUEsaURBQ0EsUUFBQSxLQUdBLEVBQUEsS0FBQSxNQUNBLE1BQUEsZ0JBQ0EsT0FBQSxFQUNBLFNBQUEsRUFDQSxTQUFBLFNBQUEsR0FHQSxNQUZBLE1BQUEsT0FBQSxHQUNBLEtBQUEsU0FDQSxHQUNBLEtBQUEsS0FBQSxRQUNBLFFBQUEsR0FFQSxNQUFBLFNBQUEsR0FBQSxVQUFBLFdBQUEsRUFBQSxXQUVBLElBQUEsR0FBQSxTQUFBLEtBQUEsT0FBQSxpQ0FBQSxFQUNBLElBQUEsR0FDQSxFQUFBLFNBRUEsRUFBQSxZQUFBLFFBQUEsV0FDQSxLQUFBLGNBQ0EsS0FBQSxjQUNBLEtBQUEsVUFBQSxhQUFBLFFBRUEsS0FBQSxVQUFBLFNBQUEsU0FBQSxTQUFBLFdBRUEsRUFBQSxRQUNBLE1BRUEsRUFBQSxZQUFBLFFBQUEsV0FDQSxLQUFBLGNBQ0EsS0FBQSxjQUNBLEtBQUEsVUFBQSxhQUFBLFNBRUEsS0FBQSxVQUFBLFNBQUEsU0FBQSxZQUFBLFdBRUEsS0FBQSxPQUFBLFFBRUEsRUFBQSxRQUNBLE1BRUEsRUFBQSxZQUFBLFFBQUEsV0FDQSxFQUFBLE1BQUEsS0FBQSxTQUFBLGNBQ0EsRUFBQSxTQUVBLEVBQUEsV0FFQSxNQUVBLEVBQUEsWUFBQSxRQUFBLFdBQ0EsR0FBQSxLQUFBLFdBQ0EsRUFBQSxTQUVBLEVBQUEsVUFHQSxLQUFBLFVBQUEsYUFBQSxTQUNBLEtBQUEsT0FBQSxRQUFBLElBRUEsTUFFQSxlQUFBLFFBQUEsS0FBQSxnQkFDQSxLQUFBLE9BQUEsU0FBQSxlQUFBLFFBQUEsS0FBQSxnQkFFQSxLQUFBLE9BQUEsVUFBQSxpQkFFQSxLQUFBLFFBQUEsT0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLGFBRUEsS0FBQSxRQUFBLFlBRUEsS0FBQSxPQUFBLGFBQUEsR0FBQSxTQUFBLFNBQUEsR0FDQSxHQUFBLGNBQUEsRUFBQSxLQUFBLFFBQUEsS0FBQSxPQUFBLGFBQUEsY0FBQSxVQUFBLEVBQUEsS0FBQSxNQUFBLENBQ0EsR0FBQSxHQUFBLEtBQUEsT0FBQSxhQUNBLEVBQUEsRUFBQSxhQUVBLE9BQUEsMEJBQUEsS0FBQSxFQUFBLFFBQUEsRUFBQSxLQUFBLE1BQUEsTUFBQSxPQUNBLEVBQUEsWUFBQSxFQUFBLEtBQUEsTUFBQSxNQUFBLElBQUEsRUFBQSxLQUFBLE1BQUEsTUFBQSxLQUlBLEtBQUEsTUFBQSxLQUFBLE9BQUEsYUFDQSxLQUFBLFNBR0EsWUFBQSxXQUNBLEtBQUEsVUFBQSxhQUFBLFVBR0EsWUFBQSxXQUNBLEtBQUEsVUFBQSxhQUFBLFNBR0EsWUFBQSxXQUNBLEtBQUEsUUFBQSxTQUFBLGFBQUEsVUFHQSxZQUFBLFdBQ0EsS0FBQSxRQUFBLFNBQUEsYUFBQSxTQUdBLFFBQUEsV0FDQSxLQUFBLFNBQUEsYUFBQSxRQUNBLEtBQUEsU0FBQSxTQUFBLEdBQ0EsS0FBQSxTQUFBLFVBQUEsR0FFQSxLQUFBLFdBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxhQUFBLEtBQUEsVUFDQSxJQUFBLFdBQ0EsS0FBQSxLQUFBLGNBQUEsWUFDQSxRQUFBLEtBQUEsY0FBQSxlQUdBLEtBQUEsV0FBQSxhQUFBLFFBQ0EsS0FBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLFdBQUEsVUFBQSxHQUVBLEtBQUEsWUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLGFBQUEsS0FBQSxVQUNBLElBQUEsTUFDQSxRQUFBLDJCQUFBLEtBQUEsT0FBQSxpQ0FBQSxXQUFBLGNBQUEsUUFBQSxLQUFBLE9BR0EsSUFBQSxHQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxLQUFBLFlBQUEsS0FDQSxJQUFBLE1BQ0EsUUFBQSwrQkFDQSxLQUFBLDJCQUdBLEVBQUEsSUFBQSxPQUFBLDBCQUNBLElBQUEsRUFBQSxDQUNBLEdBQUEsR0FBQSxFQUFBLE1BQUEsUUFDQSxHQUFBLElBQUEsTUFBQSxFQUFBLFdBRUEsRUFBQSxHQUFBLFNBQUEsV0FDQSxFQUFBLFNBQUEsS0FBQSxJQUFBLFNBR0EsRUFBQSxHQUFBLFNBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxJQUFBLE1BQUEsSUFJQSxHQUFBLEdBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEtBQUEsWUFBQSxLQUNBLElBQUEsTUFDQSxRQUFBLHFCQUdBLE1BQUEsVUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsR0FDQSxJQUFBLE1BQ0EsUUFBQSxLQUFBLFNBQUEsSUFBQSxVQUFBLGVBQUEsS0FBQSxjQUFBLGVBR0EsS0FBQSxRQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxHQUNBLElBQUEsTUFDQSxRQUFBLDhCQUdBLEtBQUEsUUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxRQUFBLEtBQ0EsSUFBQSxRQUdBLElBQUEsR0FBQSxJQUNBLE1BQUEsUUFBQSxVQUFBLFdBQ0EsRUFBQSxPQUFBLFFBQ0EsSUFBQSxHQUFBLEVBQUEsT0FBQSxhQUFBLGtCQUFBLEVBQUEsT0FBQSxTQUFBLFdBQUEsRUFBQSxPQUFBLFNBQUEsVUFBQSxXQUFBLEVBRUEsTUFBQSxTQUFBLFVBQUEsSUFHQSxHQUFBLEtBQUEsT0FBQSw4Q0FBQSxHQUFBLEtBQUEsT0FBQSw2Q0FDQSxLQUFBLFVBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEtBQUEsWUFBQSxLQUNBLElBQUEsTUFDQSxRQUFBLDJCQUdBLEtBQUEsa0JBQ0EsS0FBQSxVQUFBLElBQUEsVUFBQSxnRUFBQSxLQUFBLFVBQUEsR0FBQSxTQUFBLEtBQUEsVUFBQSxHQUFBLHFFQUFBLEtBQUEsVUFBQSxHQUFBLGdCQUFBLEtBQUEsVUFBQSxHQUFBLGlFQUFBLEVBQUEsNENBQUEsR0FBQSxLQUFBLFVBQUEsR0FBQSxRQUFBLFVBQUEsS0FBQSxVQUFBLEdBQUEsaUJBQUEsU0FFQSxLQUFBLFVBQUEsTUFBQSxJQUFBLEtBQUEsVUFBQSxHQUFBLGdCQUFBLEdBQUEsU0FBQSxTQUFBLEVBQUEsR0FDQSxLQUFBLFlBQUEsRUFBQSxNQUFBLEdBQ0EsRUFBQSxNQUFBLElBQ0EsUUFFQSxLQUFBLFVBQUEsSUFBQSxVQUFBLGdFQUFBLEtBQUEsVUFBQSxHQUFBLFNBQUEsS0FBQSxVQUFBLEdBQUEsK0JBQUEsRUFBQSxxQ0FBQSxHQUFBLEtBQUEsVUFBQSxHQUFBLFVBQUEsU0FFQSxLQUFBLFVBQUEsTUFBQSxJQUFBLEtBQUEsVUFBQSxHQUFBLFNBQUEsR0FBQSxTQUFBLFNBQUEsRUFBQSxHQUNBLEtBQUEsWUFBQSxFQUFBLE9BQ0EsRUFBQSxNQUFBLElBQ0EsUUFJQSxLQUFBLFVBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEtBQUEsWUFBQSxLQUNBLElBQUEsTUFDQSxRQUFBLGFBQ0EsS0FBQSxFQUFBLHlDQUlBLElBQUEsVUFBQSxPQUFBLEtBQUEsWUFBQSxLQUNBLElBQUEsT0FDQSxNQUFBLGlCQUlBLGFBQUEsV0FDQSxLQUFBLFFBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEtBQUEsV0FDQSxJQUFBLE1BQ0EsUUFBQSxVQUNBLEtBQ0EsSUFBQSxNQUNBLFFBQUEsaUJBQ0EsS0FBQSw2Q0FFQSxJQUFBLE1BQ0EsUUFBQSxxQkFDQSxLQUFBLCtDQUVBLElBQUEsTUFDQSxRQUFBLG9CQUNBLEtBQUEsa0RBSUEsSUFBQSxHQUFBLElBRUEsTUFBQSxRQUFBLE1BQUEsdUJBQUEsT0FBQSxXQUNBLEtBQUEsTUFBQSxLQUFBLFlBQUEsY0FDQSxLQUFBLE1BQUEsS0FBQSxTQUFBLGFBRUEsRUFBQSxVQUFBLFNBQUEsU0FBQSxTQUFBLFNBQ0EsRUFBQSxPQUFBLFNBQ0EsRUFBQSxRQUFBLGFBR0EsS0FBQSxRQUFBLE1BQUEsdUJBQUEsUUFBQSxXQUNBLEtBQUEsTUFBQSxLQUFBLFNBQUEsY0FDQSxLQUFBLE1BQUEsS0FBQSxZQUFBLGFBRUEsRUFBQSxVQUFBLFNBQUEsU0FBQSxZQUFBLFNBQ0EsRUFBQSxPQUFBLFVBR0EsS0FBQSxRQUFBLE1BQUEsc0JBQUEsT0FBQSxXQUNBLEtBQUEsTUFBQSxLQUFBLFlBQUEsZUFDQSxLQUFBLE1BQUEsS0FBQSxTQUFBLGdCQUVBLElBQUEsR0FBQSxJQUFBLElBQUEsc0JBQ0EsSUFDQSxFQUFBLFNBQUEsNkJBR0EsRUFBQSxZQUFBLEVBRUEsR0FBQSxTQUFBLEtBQUEsT0FBQSw0Q0FBQSxHQUNBLEVBQUEsUUFBQSxNQUFBLHVCQUFBLFNBRUEsRUFBQSxRQUFBLE1BQUEsdUJBQUEsVUFHQSxFQUFBLGNBQ0EsRUFBQSxjQUVBLEVBQUEsT0FBQSxRQUVBLEVBQUEsVUFBQSxTQUFBLFNBQUEsU0FBQSxjQUVBLEVBQUEsT0FBQSxVQUFBLFdBQUEsTUFDQSxFQUFBLE9BQUEsVUFHQSxLQUFBLFFBQUEsTUFBQSxzQkFBQSxRQUFBLFdBQ0EsS0FBQSxNQUFBLEtBQUEsU0FBQSxlQUNBLEtBQUEsTUFBQSxLQUFBLFlBQUEsZ0JBRUEsSUFBQSxHQUFBLElBQUEsSUFBQSxzQkFDQSxJQUNBLEVBQUEsWUFBQSw2QkFHQSxFQUFBLFlBQUEsRUFFQSxHQUFBLFNBQUEsS0FBQSxPQUFBLGlDQUFBLEdBQ0EsRUFBQSxRQUFBLE1BQUEsdUJBQUEsU0FFQSxFQUFBLFFBQUEsTUFBQSx1QkFBQSxVQUdBLEVBQUEsY0FDQSxFQUFBLGNBRUEsRUFBQSxPQUFBLFFBRUEsRUFBQSxVQUFBLFNBQUEsU0FBQSxZQUFBLGNBRUEsRUFBQSxPQUFBLFVBQUEsV0FBQSxLQUVBLEVBQUEsUUFBQSxjQUlBLFlBQUEsV0FDQSxLQUFBLE9BQUEsSUFBQSxLQUFBLElBQUEsU0FBQSxXQUFBLE9BQUEsS0FBQSxjQUFBLGNBQ0EsSUFBQSxRQUFBLDRCQUVBLEtBQUEsT0FBQSxZQUNBLFNBQUEsSUFDQSxTQUFBLEdBQ0EsMkJBQUEsRUFDQSxhQUFBLEVBQ0EsWUFBQSxFQUNBLGFBQUEsRUFDQSxpQkFBQSxFQUNBLGlCQUFBLEVBQ0EsU0FBQSxTQUFBLEtBQUEsT0FBQSxzQ0FBQSxHQUNBLFdBQUEsS0FBQSxPQUFBLHVDQUFBLEtBRUEsS0FBQSxPQUFBLGdCQUFBLElBQ0EsS0FBQSxPQUFBLFFBQUEsZ0JBQUEsR0FDQSxLQUFBLE9BQUEsUUFBQSxvQkFDQSxLQUFBLE9BQUEsU0FBQSxnQkFBQSxHQUFBLElBQ0EsS0FBQSxPQUFBLFFBQUEsU0FBQSxLQUFBLFNBQUEsWUFDQSxLQUFBLE9BQUEsUUFBQSxRQUFBLDJCQUNBLEtBQUEsT0FBQSxTQUFBLGNBQUEsS0FBQSxPQUFBLGlDQUFBLFlBRUEsS0FBQSxVQUFBLFNBQUEsWUFDQSxLQUFBLFlBQUEsU0FBQSxjQUVBLEtBQUEsWUFBQSxTQUFBLGVBSUEsS0FBQSxPQUFBLFVBQUEsR0FBQSxlQUFBLFNBQUEsRUFBQSxHQUNBLEtBQUEsZUFDQSxLQUFBLGNBQUEsT0FBQSxHQUdBLElBQUEsR0FBQSxFQUFBLFVBQ0EsR0FBQSxNQUFBLEtBQUEsRUFBQSxJQUFBLEtBRUEsS0FBQSxPQUFBLFFBQUEsb0JBQUEsRUFBQSxNQUFBLElBQUEsS0FDQSxLQUFBLE9BRUEsS0FBQSxPQUFBLFFBQUEsZ0JBQ0EsU0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLE1BQUEsR0FBQSxnQkFFQSxRQUFBLFNBQUEsRUFBQSxFQUFBLEdBT0EsTUFOQSxHQUFBLFNBQUEsS0FBQSxPQUFBLG9CQUFBLEtBQUEsR0FBQSxJQUFBLEVBQUEsSUFBQSxPQUFBLEdBQ0EsS0FBQSxpQkFBQSxFQUFBLFNBRUEsRUFBQSxRQUFBLFVBQUEsR0FHQSxJQUNBLEtBQUEsT0FHQSxLQUFBLE9BQUEsU0FBQSxZQUNBLEtBQUEsY0FDQSxTQUFBLElBQUEsTUFBQSxJQUFBLE9BQ0EsS0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsUUFBQSxRQUFBLEVBQUEsb0JBQUEsS0FDQSxFQUFBLGlDQUFBLEtBQUEsRUFDQSxHQUNBLEVBQUEsUUFBQSxXQUFBLEVBQUEsb0JBQUEsSUFBQSxFQUFBLG9CQUFBLElBQUEsS0FFQSxFQUFBLFlBS0EsS0FBQSxPQUFBLFNBQUEsWUFDQSxLQUFBLGtCQUNBLFNBQUEsSUFBQSxNQUFBLElBQUEsT0FDQSxLQUFBLFdBQ0EsS0FBQSxZQUNBLEtBQUEsUUFBQSxNQUFBLHNCQUFBLFdBRUEsS0FBQSxPQUdBLElBQUEsR0FBQSxJQUFBLFFBQUEsMEJBQ0EsR0FDQSxlQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLE1BQUEsS0FBQSxFQUFBLFFBQUEsRUFBQSxTQUFBLFNBRUEsS0FBQSxLQUFBLFNBQ0EsSUFBQSxlQUFBLE9BQUEsYUFDQSxRQUNBLE9BQUEsdUJBQ0EsT0FBQSxHQUVBLFdBQ0EsU0FDQSxHQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsRUFBQSxVQUVBLE1BQUEsU0FYQSxTQWtCQSxHQUFBLGFBQUEsR0FFQSxLQUFBLE9BQUEsVUFBQSxpQkFBQSxZQUFBLEtBQUEsbUJBQUEsR0FDQSxLQUFBLE9BQUEsVUFBQSxpQkFBQSxXQUFBLEtBQUEsbUJBQUEsR0FDQSxLQUFBLE9BQUEsVUFBQSxpQkFBQSxPQUFBLEtBQUEsS0FBQSxLQUFBLE9BQUEsSUFHQSxpQkFBQSxTQUFBLEdBQ0EsS0FBQSxjQUFBLElBQUEsSUFBQSxHQUVBLEtBQUEsaUJBQ0EsS0FBQSxjQUFBLE9BQUEsNElBR0EsS0FBQSxVQUFBLEdBQUEsK0VBQ0EsS0FBQSxVQUFBLEdBQUEsZ0lBSUEsS0FBQSxjQUFBLE9BQUEsNElBR0EsS0FBQSxVQUFBLEdBQUEsd0hBS0EsSUFBQSxHQUFBLEtBQUEsY0FBQSxNQUFBLGVBQ0EsRUFBQSxLQUFBLGNBQUEsTUFBQSxrQkFFQSxHQUFBLE9BQUEsV0FDQSxFQUFBLFNBQUEscUJBQ0EsRUFBQSxRQUdBLEVBQUEsUUFBQSxXQUNBLEVBQUEsWUFBQSxxQkFDQSxFQUFBLFFBR0EsRUFBQSxHQUFBLFFBQUEsV0FDQSxFQUFBLFNBQUEscUJBR0EsRUFBQSxVQUZBLEVBQUEsVUFJQSxLQUFBLE9BRUEsS0FBQSxjQUFBLE1BQUEsZUFBQSxHQUFBLFFBQUEsV0FDQSxLQUFBLE1BQ0EsTUFBQSwrQkFDQSxRQUFBLFNBQUEsR0FDQSxLQUFBLE9BQUEsT0FBQSxVQUFBLEVBQUEsSUFBQSxLQUNBLEtBQUEsT0FBQSxTQUVBLE1BQUEsT0FDQSxRQUNBLEtBQUEsT0FFQSxLQUFBLGNBQUEsTUFBQSxrQkFBQSxHQUFBLFFBQUEsV0FDQSxLQUFBLE1BQ0EsTUFBQSxzQkFDQSxPQUFBLFNBQUEsS0FBQSxPQUFBLGtDQUNBLGdCQUFBLEdBQUEsU0FBQSxLQUFBLE9BQUEseUNBQUEsR0FDQSxTQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFDQSxHQUFBLFVBQUEsRUFBQSxLQUNBLEVBQUEsRUFBQSxJQUFBLEVBQUEsS0FBQSxLQUFBLEVBQUEsZ0JBQUEsS0FBQSxFQUFBLEtBQUEsS0FFQSxLQUFBLE9BQUEsT0FBQSxHQUNBLEtBQUEsT0FBQSxTQUVBLE1BQUEsT0FDQSxRQUNBLEtBQUEsUUFHQSxtQkFBQSxXQUNBLEtBQUEsV0FBQSxHQUFBLGFBQ0EsTUFBQSxFQUNBLFVBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQ0EsSUFBQSxHQUFBLEtBQUEsWUFBQSxHQUNBLElBTUEsTUFMQSxHQUFBLEtBQUEsVUFBQSxFQUFBLEdBQUEsTUFFQSxFQUFBLEVBQUEsUUFBQSxRQUFBLGNBQ0EsRUFBQSxFQUFBLFFBQUEsTUFBQSxjQUdBLE1BQUEsSUFHQSxJQU1BLE1BTEEsR0FBQSxLQUFBLGNBQUEsR0FBQSxNQUVBLEVBQUEsRUFBQSxRQUFBLFFBQUEsY0FDQSxFQUFBLEVBQUEsUUFBQSxNQUFBLGNBR0EsTUFBQSxJQUVBLE1BQUEsTUFHQSxLQUFBLFdBQUEsT0FBQSxNQUFBLFNBQUEsYUFFQSxJQUFBLEdBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxLQUFBLFdBQUEsT0FBQSxFQUFBLEdBQUEsS0FDQSxNQUFBLE1BQUEsV0FBQSxPQUFBLEVBQUEsR0FBQSxJQUVBLElBQUEsR0FBQSxJQUFBLElBNkJBLE9BM0JBLE1BQUEsS0FBQSxTQUNBLElBQUEsZUFBQSxPQUFBLGFBQ0EsUUFDQSxPQUFBLG9CQUNBLElBQUEsRUFBQSxHQUFBLEtBRUEsV0FDQSxTQUNBLEdBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxJQUFBLElBQUEsRUFDQSxJQUFBLEVBQUEsQ0FDQSxFQUFBLE9BQUEsRUFBQSxNQUNBLEVBQUEsSUFBQSxnQkFBQSxNQUVBLEtBQUEsV0FBQSxPQUFBLEVBQUEsR0FBQSxLQUFBLEVBQUEsSUFBQSxTQUVBLElBQUEsR0FBQSxJQUFBLElBQUEsSUFBQSxVQUFBLFdBQUEsSUFBQSxNQUFBLEtBQUEsS0FBQSxTQUFBLElBQUEsUUFDQSxHQUFBLE1BQUEsSUFBQSxHQUFBLE9BQUEsRUFBQSxNQUFBLElBQUEsZ0JBQUEsTUFFQSxLQUFBLFNBQUEsSUFBQSxNQUFBLEVBQUEsSUFBQSxZQUdBLE1BQUEsU0FLQSxZQUFBLEVBQUEsa0RBQUEsRUFBQSxHQUFBLElBQUEsV0FFQSxLQUFBLE1BRUEsRUFBQSxLQUFBLFVBQ0EsR0FBQSxTQUFBLE1BQUEsS0FBQSxXQUNBLEdBQUEsR0FBQSxFQUFBLFNBQUEsTUFBQSxJQUNBLE9BQUEsWUFDQSxHQUFBLEdBQUEsRUFBQSxNQUFBLEtBQUEsVUFJQSxPQUhBLEdBQUEsRUFBQSxRQUFBLFFBQUEsY0FDQSxFQUFBLEVBQUEsUUFBQSxNQUFBLGlCQU1BLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLE1BQUEsS0FBQSxTQUFBLEtBQUEsY0FDQSxFQUFBLFNBQUEsTUFBQSxPQUFBLEdBQ0EsS0FBQSxNQUVBLEVBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxNQUFBLEtBQUEsV0FBQSxLQUFBLGlCQUNBLEtBQUEsS0FFQSxNQUFBLFdBQUEsSUFBQSxHQUNBLEtBQUEsV0FBQSxJQUFBLElBR0EsTUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEtBQUEsV0FBQSxPQUFBLEVBS0EsSUFIQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBQ0EsRUFBQSxFQUFBLFFBQUEsT0FBQSxLQUVBLEdBQUEsS0FBQSxPQUFBLHFDQUFBLENBQ0EsS0FBQSxjQUNBLGFBQUEsS0FBQSxhQUdBLElBQUEsR0FBQSxTQUFBLEtBQUEsT0FBQSw4Q0FBQSxJQUVBLE1BQUEsYUFBQSxXQUFBLFdBQ0EsS0FBQSxLQUFBLFNBQ0EsSUFBQSxlQUFBLE9BQUEsYUFDQSxRQUNBLE9BQUEsNEJBQ0EsUUFBQSxFQUNBLFNBQUEsS0FBQSxRQUFBLElBRUEsVUFBQSxFQUNBLFdBQ0EsU0FDQSxHQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsU0FBQSxjQUFBLE1BQ0EsR0FBQSxVQUFBLEVBQUEsS0FFQSxLQUFBLFFBQUEsTUFBQSxLQUFBLFFBQUEsSUFBQSxLQUFBLFFBQUEsS0FBQSxLQUFBLFFBQUEsSUFBQSxJQUVBLEtBQUEsUUFBQSxZQUVBLEtBQUEsT0FBQSxvQkFBQSxJQUFBLEdBQUEsS0FBQSxPQUFBLGFBQUEsY0FBQSxjQUNBLEtBQUEsUUFBQSxTQUFBLElBQUEsVUFBQSxLQUFBLFFBQUEsU0FBQSxJQUFBLGVBSUEsTUFBQSxVQUlBLEtBQUEsTUFBQSxPQUNBLENBQ0EsR0FBQSxHQUFBLFNBQUEsY0FBQSxNQUNBLEdBQUEsVUFBQSxFQUVBLEtBQUEsUUFBQSxNQUFBLEtBQUEsUUFBQSxJQUFBLEtBQUEsUUFBQSxLQUFBLEtBQUEsUUFBQSxJQUFBLElBRUEsS0FBQSxRQUFBLFlBRUEsS0FBQSxPQUFBLG9CQUFBLElBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxjQUFBLGNBQ0EsS0FBQSxRQUFBLFNBQUEsSUFBQSxVQUFBLEtBQUEsUUFBQSxTQUFBLElBQUEsY0FPQSxNQUhBLE1BQUEsV0FBQSxJQUFBLE1BQUEsS0FBQSxPQUFBLFdBQ0EsS0FBQSxTQUFBLElBQUEsTUFBQSxFQUVBLEdBR0EsYUFBQSxTQUFBLEdBR0EsR0FBQSxHQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsSUFBQSxXQUFBLEVBQUEsSUFDQSxJQUFBLEtBQUEsRUFDQSxPQUFBLENBT0EsSUFGQSxJQUNBLEVBQUEsRUFBQSxJQUFBLFdBQUEsR0FDQSxNQUFBLEVBQ0EsT0FBQSxDQU9BLElBRkEsSUFDQSxFQUFBLEVBQUEsSUFBQSxXQUFBLEdBQ0EsTUFBQSxFQUNBLE9BQUEsQ0FPQSxJQUZBLElBQ0EsRUFBQSxFQUFBLElBQUEsV0FBQSxHQUNBLEtBQUEsRUFDQSxPQUFBLENBT0EsSUFGQSxJQUNBLEVBQUEsRUFBQSxJQUFBLFdBQUEsR0FDQSxNQUFBLEVBQ0EsT0FBQSxDQU9BLElBRkEsSUFDQSxFQUFBLEVBQUEsSUFBQSxXQUFBLEdBQ0EsTUFBQSxFQUNBLE9BQUEsQ0FPQSxJQUZBLElBQ0EsRUFBQSxFQUFBLElBQUEsV0FBQSxHQUNBLEtBQUEsRUFDQSxPQUFBLENBR0EsSUFLQSxLQUhBLEdBQUEsR0FBQSxFQUNBLEVBQUEsRUFBQSxPQUNBLEdBQUEsRUFDQSxFQUFBLEdBQUEsQ0FDQSxHQUFBLEtBQUEsRUFBQSxJQUFBLFdBQUEsR0FBQSxDQUNBLEdBQUEsQ0FDQSxPQUdBLEdBQUEsS0FBQSxFQUFBLElBQUEsV0FBQSxHQUNBLE9BQUEsQ0FHQSxLQUdBLElBQUEsRUFBQSxPQUFBLENBRUEsR0FBQSxJQUFBLEVBQUEsRUFFQSxFQUFBLElBQUEsRUFBQSxTQUNBLEVBQUEsSUFBQSxFQUFBLE9BR0EsSUFBQSxHQUFBLEVBQUEsSUFBQSxNQUFBLEVBQUEsR0FHQSxHQUNBLEtBQUEsU0FDQSxNQUFBLEVBQUEsTUFDQSxRQUFBLEVBQ0EsSUFBQSxFQUtBLE9BRkEsR0FBQSxLQUFBLElBRUEsR0FHQSxlQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsRUFDQSxFQUFBLEVBQUEsR0FFQSxJQUFBLEtBQUEsRUFBQSxJQUFBLFdBQUEsR0FBQSxPQUFBLENBRUEsSUFEQSxJQUNBLEtBQUEsRUFBQSxJQUFBLFdBQUEsR0FBQSxPQUFBLENBRUEsSUFEQSxJQUNBLEtBQUEsRUFBQSxJQUFBLFdBQUEsR0FBQSxPQUFBLENBU0EsS0FQQSxJQUNBLEVBQUEsRUFBQSxPQUVBLEVBQUEsTUFFQSxFQUFBLEVBQUEsRUFFQSxNQUFBLEVBQUEsRUFBQSxJQUFBLFFBQUEsSUFBQSxLQUFBLENBR0EsSUFGQSxFQUFBLEVBQUEsRUFFQSxFQUFBLEdBQUEsS0FBQSxFQUFBLElBQUEsV0FBQSxJQUFBLEdBRUEsSUFBQSxFQUFBLElBQUEsRUFBQSxPQVlBLE1BWEEsSUFDQSxFQUFBLE1BQ0EsS0FBQSxPQUNBLFFBQUEsRUFBQSxJQUFBLE1BQUEsRUFBQSxHQUNBLFFBQUEsVUFBQSxLQUNBLE9BQ0EsT0FBQSxFQUNBLE1BQUEsRUFBQSxRQUdBLEVBQUEsSUFBQSxHQUNBLEVBTUEsTUFGQSxLQUFBLEVBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxFQUFBLFFBQ0EsR0FHQSxrQkFBQSxTQUFBLEdBQ0EsRUFBQSxrQkFDQSxFQUFBLGtCQUdBLEtBQUEsU0FBQSxHQUNBLEVBQUEsa0JBQ0EsRUFBQSxrQkFFQSxHQUFBLEtBQUEsT0FBQSw4Q0FBQSxHQUFBLEtBQUEsT0FBQSw4Q0FDQSxLQUFBLFlBQUEsRUFBQSxhQUFBLFFBSUEsWUFBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLEdBQUEsRUFFQSxJQUFBLEtBQUEsRUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLFdBQUEsS0FBQSxFQUFBLEtBRUEsSUFBQSxFQUFBLENBQ0EsR0FBQSxHQUFBLEtBQUEsT0FBQSw2Q0FBQSxPQUFBLENBRUEsS0FBQSxLQUFBLFVBQUEsS0FBQSxPQUFBLHFDQUFBLEdBR0EsTUFGQSxNQUFBLFlBQUEsRUFBQSxRQUFBLEVBQUEsaURBRUEsQ0FJQSxLQUFBLEtBQUEsVUFBQSxFQUFBLE1BR0EsTUFGQSxNQUFBLFlBQUEsRUFBQSxRQUFBLEVBQUEsdUNBRUEsQ0FHQSxJQUFBLEtBQUEsT0FBQSx5Q0FDQSxLQUFBLE1BQ0EsTUFBQSxnQ0FDQSxLQUFBLEVBQ0EsR0FBQSxLQUNBLE9BQUEsSUFDQSxRQUVBLEtBQUEsV0FBQSxFQUFBLFFBQUEsR0FDQSxLQUFBLE9BQUEsYUFFQSxDQUNBLEdBQUEsR0FBQSxLQUFBLE9BQUEsNENBQUEsT0FBQSxDQUVBLEtBQUEsS0FBQSxVQUFBLEtBQUEsT0FBQSxvQ0FBQSxHQUdBLE1BRkEsTUFBQSxZQUFBLEVBQUEsT0FBQSxFQUFBLGdEQUVBLENBR0EsS0FBQSxLQUFBLFVBQUEsRUFBQSxNQUdBLE1BRkEsTUFBQSxZQUFBLEVBQUEsT0FBQSxFQUFBLHVDQUVBLENBR0EsTUFBQSxXQUFBLEVBQUEsUUFDQSxLQUFBLE9BQUEsVUFHQSxPQUdBLFVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxLQUFBLE9BQUEsaUNBS0EsT0FKQSxJQUFBLElBQUEsSUFBQSxFQUFBLEtBQUEsT0FBQSxnQkFBQSxXQUVBLEVBQUEsU0FBQSxHQUVBLEdBQUEsR0FBQSxFQUVBLEdBQUEsR0FHQSxVQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsRUFBQSxNQUFBLElBQ0EsSUFBQSxHQUFBLEVBQUEsS0FBQSxNQUFBLEtBQUEsS0FDQSxPQUFBLElBQUEsRUFBQSxRQUFBLEVBQUEsZ0JBR0EsV0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsR0FBQSxPQUNBLEVBQUEsR0FBQSxDQUVBLElBQUEsR0FBQSxLQUFBLGVBQUEsRUFBQSxFQUFBLE1BRUEsRUFBQSxHQUFBLFNBQ0EsR0FBQSxPQUFBLE9BQUEsR0FDQSxFQUFBLE9BQUEsU0FBQSxjQUFBLEVBQUEsVUFDQSxFQUFBLE9BQUEsT0FBQSxFQUFBLE1BQ0EsRUFBQSxPQUFBLFdBQUEsS0FBQSxPQUFBLFVBQ0EsRUFBQSxPQUFBLFNBQUEsRUFFQSxJQUFBLEdBQUEsR0FBQSxlQUNBLEdBQUEsS0FBQSxPQUFBLGVBQUEsT0FBQSxjQUNBLEVBQUEsaUJBQUEsYUFBQSxRQUNBLEVBQUEsaUJBQUEsVUFBQSxJQUFBLEtBQUEsZUFBQSxTQUVBLEVBQUEsT0FBQSxXQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsaUJBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxJQUFBLENBQ0EsR0FBQSxNQUFBLGFBQUEsU0FBQSxFQUFBLE9BRUEsS0FBQSxNQUVBLEVBQUEsT0FBQSxXQUNBLEdBQUEsTUFBQSxFQUFBLE9BQUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxNQUFBLEVBQUEsYUFDQSxJQUFBLEdBQUEsRUFBQSxRQUFBLENBQ0EsRUFBQSxRQUNBLElBQUEsR0FBQSxTQUFBLEVBQUEsSUFBQSxHQUNBLEVBQUEsU0FBQSxFQUFBLE9BQUEsSUFDQSxNQUFBLE9BQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxPQUFBLEtBQUEsS0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLEVBQUEsT0FBQSxLQUFBLEtBQUEsT0FFQSxNQUFBLGFBQUEsRUFBQSxFQUFBLFdBR0EsS0FBQSxNQUVBLEVBQUEsS0FBQSxJQUdBLGVBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLElBQUEsVUFBQSxZQUFBLEtBQUEsV0FDQSxJQUFBLE1BQ0EsS0FBQSwyRUFBQSxFQUFBLDRCQUFBLEdBQUEsRUFBQSxpQkFHQSxPQUFBLEtBQUEsSUFBQSxJQUdBLGFBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxNQUFBLGFBQUEsU0FBQSxTQUNBLEVBQUEsTUFBQSxhQUFBLFNBQUEsUUFFQSxFQUFBLE1BQUEsS0FBQSxTQUFBLGtCQUNBLEVBQUEsTUFBQSxLQUFBLGFBQUEsZUFBQSxlQUNBLEVBQUEsTUFBQSxLQUFBLFlBQUEsYUFFQSxFQUFBLE1BQUEsUUFBQSxJQUFBLFdBQUEsWUFBQSxFQUNBLEVBQUEsTUFBQSxtQkFBQSxHQUFBLFFBQUEsV0FDQSxFQUFBLFlBSUEsWUFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxLQUFBLGVBQUEsRUFBQSxFQUFBLEtBQ0EsTUFBQSxhQUFBLEVBQUEsSUFHQSxlQUFBLFdBQ0EsTUFBQSxtQkFBQSxRQUFBLGFBQUEsS0FBQSxVQUFBLFVBQUEsUUFBQSxlQUlBLEtBQUEsUUFBQSxTQUFBLEdBQ0EsR0FBQSxnQkFBQSxRQUNBLFlBQUEsS0FJQSxLQUFBLFlBQUEsV0FDQSxHQUFBLEdBQUEsSUFBQSxNQUFBLHlCQUVBLEtBQUEsS0FBQSxFQUFBLFNBQUEsR0FFQSxPQURBLEVBQUEsSUFBQSxJQUFBLElBR0EsZUFBQSxlQUFBLEVBQUEsS0FBQSxHQUVBLGVBQUEsZUFBQSxFQUFBLElBQUEsR0FBQSxnQkFBQSxRQUNBLFlBQUEsRUFBQSxLQURBLFNBSkEsS0FZQSxLQUFBLFlBQUEsV0FDQSxHQUFBLEdBQUEsSUFBQSxNQUFBLGlCQUVBLEtBQUEsS0FBQSxFQUFBLFNBQUEsR0FFQSxPQURBLEVBQUEsSUFBQSxJQUFBLElBR0EsZUFBQSxlQUFBLEVBQUEsS0FFQSxlQUFBLGVBQUEsRUFBQSxJQUFBLFVBQUEsU0FGQSxHQUZBLEtDMWdDQSxlQUFBLE1BQUEsZUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsb0NBQUEsS0FFQSxHQUFBLE1BQ0EsSUFBQSxRQUFBLEdBQ0EsTUFBQSxHQUFBLEtBQUEsS0FBQSxXQUNBLEtBQUEsRUFDQSxRQUFBLE9BQUEsUUFBQSxTQUFBLFdBRUEsYUFBQSxPQUNBLEtBQUEsUUFDQSxXQUFBLE9BQ0EsVUFBQSxFQUNBLE1BQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxLQUFBLElBR0EsSUFBQSxHQUFBLFNBQUEsS0FBQSxPQUFBLDRDQUFBLEVBQ0EsS0FDQSxFQUFBLElBQUEsR0FBQSxLQUFBLFVBQUEsNEZBQ0Esd0hBR0EsZUFBQSxNQUFBLGVBQUEsV0FBQSxZQUFBLEtBQUEsS0FBQSxJQUVBLElBQUEsT0FBQSxlQUFBLE1BQUEsZUFBQSxLQUFBLE1BQUEsVUFDQSxJQUFBLElBQUEsdUNBQUEsZUFBQSxNQUFBLGdCQ3pCQSxlQUFBLE9BQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxNQUNBLEVBQUEsZ0JBQUEsRUFBQSxpQkFBQSw2QkFFQSxJQUFBLEdBQUEsSUFBQSxJQUVBLEtBQUEsUUFBQSxHQUNBLE9BQUEsRUFDQSxPQUFBLE9BQ0EsWUFBQSxPQUNBLFFBQUEsRUFDQSxXQUFBLEVBQ0EsYUFBQSxFQUNBLGFBQUEsRUFDQSxZQUFBLEVBQ0EsWUFBQSxFQUNBLFdBQUEsRUFDQSxNQUFBLElBQ0EsT0FBQSxFQUNBLE1BQUEsRUFBQSxxQ0FDQSxJQUFBLDRDQUNBLFFBQ0EsT0FBQSxTQUNBLFFBQUEsRUFDQSxVQUNBLE9BQUEsT0FDQSxXQUFBLE1BQ0EsZUFBQSxHQUNBLE9BQUEsT0FDQSxRQUFBLEdBRUEsUUFDQSxZQUFBLEdBQ0EsVUFDQSxVQUFBLFFBQ0EsT0FBQSxRQUVBLElBQUEseUJBQ0EsUUFDQSxNQUFBLFNBQ0EsS0FBQSw4Q0FDQSxRQUFBLEVBQUEsK0JBQ0EsTUFBQSxLQUNBLE1BQUEsT0FDQSxPQUFBLGNBQ0EsUUFBQSxLQUFBLG9CQUVBLE1BQUEsU0FDQSxLQUFBLDRDQUNBLFFBQUEsRUFBQSwrQkFDQSxNQUFBLEtBQ0EsTUFBQSxPQUNBLE9BQUEsY0FDQSxRQUFBLEtBQUEsb0JBRUEsTUFBQSxTQUNBLEtBQUEsbURBQ0EsUUFBQSxFQUFBLGtDQUNBLE1BQUEsS0FDQSxNQUFBLEdBQ0EsT0FBQSxPQUNBLFFBQUEsS0FBQSxvQkFFQSxNQUFBLFNBQ0EsS0FBQSxvREFDQSxRQUFBLEVBQUEsbUNBQ0EsTUFBQSxLQUNBLE9BQUEsR0FDQSxPQUFBLE9BQ0EsUUFBQSxLQUFBLG9CQUVBLE1BQUEsU0FDQSxLQUFBLG1EQUNBLFFBQUEsRUFBQSxzQ0FDQSxNQUFBLEtBQ0EsTUFBQSxJQUNBLE9BQUEsU0FDQSxRQUFBLEtBQUEsb0JBRUEsTUFBQSxTQUNBLEtBQUEsb0RBQ0EsUUFBQSxFQUFBLHVDQUNBLE1BQUEsS0FDQSxNQUFBLEdBQ0EsT0FBQSxTQUNBLFFBQUEsS0FBQSxvQkFFQSxNQUFBLFNBQ0EsS0FBQSw4Q0FDQSxRQUFBLEVBQUEsd0NBQ0EsTUFBQSxLQUNBLE1BQUEsS0FDQSxPQUFBLFFBQ0EsUUFBQSxLQUFBLHNCQUdBLFlBQUEsR0FDQSxVQUNBLFVBQUEsUUFDQSxPQUFBLFFBRUEsSUFBQSx5QkFDQSxRQUNBLEtBQUEsK0NBQUEsSUFBQSxnQkFBQSxFQUFBLE1BQUEsaUJBSUEsT0FDQSxNQUFBLHVDQUNBLEdBQUEsRUFBQSxtQkFDQSxXQUNBLFFBQ0EsR0FBQSxTQUFBLEVBQUEsR0FDQSxLQUFBLHFCQUFBLEVBQUEsT0FFQSxNQUFBLFFBR0EsTUFDQSxLQUFBLEVBQUEsVUFDQSxNQUFBLEtBQ0EsUUFBQSxLQUFBLFFBRUEsS0FBQSxFQUFBLGlDQUNBLElBQUEsaUJBQ0EsTUFBQSxLQUNBLEtBQUEsRUFDQSxRQUFBLEtBQUEsU0FFQSxLQUFBLEVBQUEsc0NBQ0EsSUFBQSxpQkFDQSxNQUFBLEtBQ0EsS0FBQSxFQUNBLFFBQUEsS0FBQSxTQUVBLFdBQ0EsTUFDQSxHQUFBLFdBQ0EsR0FBQSxLQUNBLE1BQUEsV0FBQSxFQUFBLElBQUEsS0FBQSxHQUFBLElBQUEsRUFBQSxpQkFFQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEtBQUEsV0FDQSxRQUFBLEVBQUEsRUFDQSxPQUFBLEVBQUEsRUFDQSxZQUFBLEVBQUEsT0FDQSxXQUFBLEVBQUEsTUFDQSxZQUFBLEVBQUEsT0FBQSxLQUNBLFFBQ0EsS0FBQSxNQUVBLEtBQUEsV0FBQSxRQUFBLEVBRUEsSUFBQSxHQUFBLElBQUEsT0FBQSxFQUFBLG9CQUFBLE1BQUEsTUFBQSxFQUNBLE1BQUEscUJBQUEsRUFBQSxPQUVBLE1BQUEsU0FJQSxlQUFBLE9BQUEsUUFBQSxXQUFBLFlBQUEsS0FBQSxLQUFBLEdBQ0EsS0FBQSxPQUFBLEdBR0EsSUFBQSxPQUFBLGVBQUEsT0FBQSxRQUFBLElBQUEsUUFDQSxVQUFBLEdBQ0EsZ0JBQUEsS0FBQSxJQUVBLHFCQUFBLFNBQUEsU0FDQSxHQUFBLE1BRUEsSUFBQSxJQUFBLFFBQUEsTUFDQSxNQUFBLFFBQUEsTUFDQSxNQUFBLFFBQUEsa0JBQUEsSUFDQSxNQUFBLEtBQUEsUUFBQSxRQUVBLElBQUEsUUFBQSxPQUFBLFFBQUEsT0FBQSxDQUNBLEdBQUEsT0FBQSxTQUFBLFFBQUEsT0FDQSxPQUFBLFNBQUEsUUFBQSxPQUVBLE9BREEsTUFBQSxHQUFBLE9BQUEsRUFDQSxNQUFBLE9BRUEsUUFHQSxPQUFBLEdBSUEsTUFBQSxlQUFBLFFBRUEsS0FBQSxtQkFBQSxPQUFBLGlCQUFBLE1BQUEsU0FHQSxPQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxPQUFBLEdBQUEsZUFBQSxRQUFBLEtBQUEsT0FBQSxLQUFBLE1BRUEsRUFBQSxHQUFBLFNBQ0EsR0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLE1BQ0EsRUFBQSxPQUFBLFNBQUEsMEJBQ0EsRUFBQSxPQUFBLFlBQUEsS0FBQSxXQUNBLEVBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLE1BQ0EsRUFBQSxPQUFBLE9BQUEsRUFBQSxNQUNBLEVBQUEsT0FBQSxXQUFBLEtBQUEsT0FBQSxHQUFBLE9BQUEsVUFDQSxFQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUEsUUFDQSxFQUFBLE9BQUEsVUFBQSxLQUFBLGVBQUEsS0FFQSxJQUFBLEdBQUEsR0FBQSxlQUNBLEdBQUEsS0FBQSxPQUFBLGVBQUEsT0FBQSxjQUNBLEVBQUEsaUJBQUEsYUFBQSxRQUNBLEVBQUEsaUJBQUEsVUFBQSxJQUFBLEtBQUEsZUFBQSxTQUVBLEVBQUEsT0FBQSxXQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsaUJBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxJQUFBLENBQ0EsR0FBQSxNQUFBLGFBQUEsU0FBQSxFQUFBLE9BRUEsS0FBQSxNQUVBLEVBQUEsT0FBQSxXQUNBLEdBQUEsTUFBQSxFQUFBLE9BQUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxNQUFBLEVBQUEsYUFFQSxJQUFBLEVBQUEsU0FDQSxFQUFBLFNBQ0EsS0FBQSxPQUFBLEdBQUEsT0FBQSxPQUFBLEtBQUEsRUFBQSxPQUFBLEtBQUEsS0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLEVBQUEsT0FBQSxLQUFBLFdBRUEsS0FBQSxPQUFBLEdBQUEsYUFBQSxFQUFBLEVBQUEsV0FHQSxLQUFBLE1BRUEsRUFBQSxLQUFBLEdBRUEsS0FBQSxTQUdBLGtCQUFBLFNBQUEsR0FDQSxLQUFBLFdBQUEsUUFBQSxFQUFBLE9BQUEsRUFBQSxRQUdBLE1BQUEsV0FDQSxLQUFBLFdBQUEsUUFBQSxXQUVBLGVBQUEsT0FBQSxRQUFBLFdBQUEsTUFBQSxLQUFBLE1BQ0EsS0FBQSxPQUFBLEdBQUEsT0FBQSxXQUdBLElBQUEsSUFBQSxnQ0FBQSxlQUFBLE9BQUEsU0N4UEEsZUFBQSxPQUFBLE9BQUEsU0FBQSxHQUNBLEVBQUEsTUFDQSxJQUFBLFFBQUEsR0FDQSxNQUFBLEVBQUEsbUNBQ0EsWUFBQSxRQUNBLFdBQUEsRUFDQSxhQUFBLEVBQ0EsYUFBQSxFQUNBLE9BQUEsSUFDQSxPQUFBLEVBQ0EsT0FBQSxLQUFBLFVBQUEsS0FFQSxlQUFBLE9BQUEsT0FBQSxXQUFBLFlBQUEsS0FBQSxLQUFBLElBRUEsSUFBQSxPQUFBLGVBQUEsT0FBQSxPQUFBLEtBQUEsUUFDQSxVQUFBLFdBQ0EsUUFDQSxNQUFBLFlBQ0EsS0FBQSxNQUNBLFdBQUEsRUFBQSw2QkFDQSxZQUFBLEVBQ0EsT0FBQSxPQUNBLE1BQUEsU0FJQSxPQUFBLFdBQ0EsR0FBQSxHQUFBLEtBQUEsR0FBQSxTQUVBLEdBQUEsWUFDQSxLQUFBLE9BQUEsU0FDQSxJQUFBLFNBQUEsS0FBQSxPQUFBLFFBQUEsS0FBQSxPQUFBLE9BQUEsTUFBQSxFQUFBLGNBR0EsS0FBQSxZQUlBLElBQUEsSUFBQSwrQkFBQSxlQUFBLE9BQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiRXh0Lm5zKCdNYXJrZG93bkVkaXRvcicpO1xuTWFya2Rvd25FZGl0b3IgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgTWFya2Rvd25FZGl0b3Iuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsY29uZmlnKTtcbn07XG5FeHQuZXh0ZW5kKE1hcmtkb3duRWRpdG9yLEV4dC5Db21wb25lbnQse1xuICAgIHdpbmRvdzp7fSxjb21ibzp7fSxjb25maWc6IHt9XG59KTtcbkV4dC5yZWcoJ21hcmtkb3duZWRpdG9yJyxNYXJrZG93bkVkaXRvcik7XG5tYXJrZG93bkVkaXRvciA9IG5ldyBNYXJrZG93bkVkaXRvcigpO1xuXG5tYXJrZG93bkVkaXRvci5sb2FkZWRFbGVtZW50cyA9IHt9O1xuXG5tYXJrZG93bkVkaXRvci5FZGl0b3IgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgY29uZmlnLnJlc291cmNlID0gTU9EeC5yZXF1ZXN0LmlkIHx8IDA7XG4gICAgbWFya2Rvd25FZGl0b3IuRWRpdG9yLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLGNvbmZpZyk7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG59O1xuRXh0LmV4dGVuZChtYXJrZG93bkVkaXRvci5FZGl0b3IsRXh0LkNvbXBvbmVudCx7XG4gICAgcmVtYXJrYWJsZTogJydcbiAgICAsZnVsbFNjcmVlbjogZmFsc2VcbiAgICAsZGlmZkRPTTogbnVsbFxuICAgICxsb2NhbENhY2hlOiB7XG4gICAgICAgIG9FbWJlZDoge31cbiAgICB9XG4gICAgLGluaXRDb21wb25lbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBNYXJrZG93bkVkaXRvci5zdXBlcmNsYXNzLmluaXRDb21wb25lbnQuY2FsbCh0aGlzKTtcblxuICAgICAgICB0aGlzLmRpZmZET00gPSBuZXcgZGlmZkRPTSgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHRoaXMubWRFbGVtZW50SWQpe1xuICAgICAgICAgICAgRXh0Lm9uUmVhZHkodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuZWRpdG9yLmRlc3Ryb3koKTtcblxuICAgICAgICB0aGlzLm1kQ29udGFpbmVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnRhTWFya2Rvd24ucmVtb3ZlKCk7XG5cbiAgICAgICAgdGhpcy50ZXh0YXJlYS5kb20uc3R5bGUuZGlzcGxheSA9IG51bGw7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuZG9tLnN0eWxlLndpZHRoID0gbnVsbDtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5kb20uc3R5bGUuaGVpZ2h0ID0gbnVsbDtcblxuICAgICAgICBNYXJrZG93bkVkaXRvci5zdXBlcmNsYXNzLmRlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICAscmVuZGVyOiBmdW5jdGlvbihjb250YWluZXIsIHBvc2l0aW9uKSB7XG4gICAgICAgIHRoaXMudGV4dGFyZWEgPSBFeHQuZ2V0KHRoaXMubWRFbGVtZW50SWQpO1xuICAgICAgICB0aGlzLm1kRWxlbWVudE5hbWUgPSB0aGlzLnRleHRhcmVhLmRvbS5uYW1lO1xuXG4gICAgICAgIGlmICghdGhpcy50ZXh0YXJlYSkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuYnVpbGRVSSgpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyQWNlKCk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJSZW1hcmthYmxlKCk7XG4gICAgICAgIHRoaXMuYnVpbGRUb29sYm94KCk7XG5cbiAgICAgICAgdmFyIHByZXZpZXdCdXR0b24gPSB0aGlzLnRvb2xCb3guY2hpbGQoJy5wcmV2aWV3LWJ1dHRvbicpO1xuICAgICAgICB2YXIgZnVsbHNjcmVlbkJ1dHRvbiA9IHRoaXMudG9vbEJveC5jaGlsZCgnLmZ1bGxzY3JlZW4tYnV0dG9uJyk7XG4gICAgICAgIHZhciBzcGxpdHNjcmVlbkJ1dHRvbiA9IHRoaXMudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpO1xuXG4gICAgICAgIHZhciBjb250ZW50ID0gdGhpcy5jb250ZW50TUQ7XG5cbiAgICAgICAgdmFyIHByZXZpZXdCdXR0b25PZmYgPSBFeHQuZ2V0KEV4dC5Eb21IZWxwZXIuYXBwZW5kKGNvbnRlbnQucGFyZW50KCkse1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAncHJldmlldy1idXR0b24tb2ZmJyxcbiAgICAgICAgICAgIGh0bWw6ICc8aSBjbGFzcz1cImljb24gaWNvbi1leWUtc2xhc2ggaWNvbi1sYXJnZVwiPjwvaT4nLFxuICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgZHJvcFRhcmdldCA9IE1PRHgubG9hZCh7XG4gICAgICAgICAgICB4dHlwZTogJ21vZHgtdHJlZWRyb3AnLFxuICAgICAgICAgICAgdGFyZ2V0OiBjb250ZW50LFxuICAgICAgICAgICAgdGFyZ2V0RWw6IGNvbnRlbnQsXG4gICAgICAgICAgICBvbkluc2VydDogKGZ1bmN0aW9uKHMpe1xuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pLmJpbmQodGhpcy5lZGl0b3IpLFxuICAgICAgICAgICAgaWZyYW1lOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRleHRhcmVhLm9uKCdkZXN0cm95JywgZnVuY3Rpb24oKSB7ZHJvcFRhcmdldC5kZXN0cm95KCk7fSk7XG5cbiAgICAgICAgdmFyIGRlZmF1bHRTcGxpdCA9IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNwbGl0J10gfHwgMCk7XG4gICAgICAgIGlmIChkZWZhdWx0U3BsaXQgPT0gMSkge1xuICAgICAgICAgICAgc3BsaXRzY3JlZW5CdXR0b24udHVybk9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcHJldmlld0J1dHRvbi5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGlzLmhpZGVDb250ZW50KCk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5zZXREaXNwbGF5ZWQoJ25vbmUnKTtcblxuICAgICAgICAgICAgdGhpcy5jb250ZW50TUQucGFyZW50KCkucGFyZW50KCkuYWRkQ2xhc3MoJ3ByZXZpZXcnKTtcblxuICAgICAgICAgICAgcHJldmlld0J1dHRvbk9mZi5zaG93KClcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgcHJldmlld0J1dHRvbk9mZi5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmhpZGVQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGlzLnNob3dDb250ZW50KCk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5zZXREaXNwbGF5ZWQoJ2Jsb2NrJyk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdwcmV2aWV3Jyk7XG5cbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIHByZXZpZXdCdXR0b25PZmYuaGlkZSgpO1xuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBzcGxpdHNjcmVlbkJ1dHRvbi5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHNwbGl0c2NyZWVuQnV0dG9uLmNoaWxkKCdpJykuaGFzQ2xhc3MoJ2ljb24tcGF1c2UnKSkge1xuICAgICAgICAgICAgICAgIHNwbGl0c2NyZWVuQnV0dG9uLnR1cm5PbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzcGxpdHNjcmVlbkJ1dHRvbi50dXJuT2ZmKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGZ1bGxzY3JlZW5CdXR0b24uYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmZ1bGxTY3JlZW4gPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuQnV0dG9uLnR1cm5PbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuQnV0dG9uLnR1cm5PZmYoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuICAgICAgICAgICAgdGhpcy5lZGl0b3IucmVzaXplKHRydWUpO1xuXG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGlmIChtYXJrZG93bkVkaXRvci5jb250ZW50W3RoaXMubWRFbGVtZW50TmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNldFZhbHVlKG1hcmtkb3duRWRpdG9yLmNvbnRlbnRbdGhpcy5tZEVsZW1lbnROYW1lXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lZGl0b3Iuc2VsZWN0aW9uLmNsZWFyU2VsZWN0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5wcmV2aWV3LnVwZGF0ZSh0aGlzLnBhcnNlKHRoaXMuZWRpdG9yLmdldFZhbHVlKCkpKTtcblxuICAgICAgICB0aGlzLnByZXZpZXcuZml4SGVpZ2h0KCk7XG5cbiAgICAgICAgdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLGIsYyxkKXtcbiAgICAgICAgICAgIGlmIChlLmRhdGEuYWN0aW9uID09ICdpbnNlcnRUZXh0JyAmJiB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0RG9jdW1lbnQoKS5pc05ld0xpbmUoZS5kYXRhLnRleHQpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlc3Npb24gPSB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCk7XG4gICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gc2Vzc2lvbi5nZXREb2N1bWVudCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKC9eXFxzKig/OlsqKy1dfFxcZCtcXC4pXFxzKiQvLmV4ZWMoZG9jdW1lbnQuZ2V0TGluZShlLmRhdGEucmFuZ2Uuc3RhcnQucm93KSkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVMaW5lcyhlLmRhdGEucmFuZ2Uuc3RhcnQucm93LCBlLmRhdGEucmFuZ2Uuc3RhcnQucm93KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucGFyc2UodGhpcy5lZGl0b3IuZ2V0VmFsdWUoKSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLHNob3dDb250ZW50OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmNvbnRlbnRNRC5zZXREaXNwbGF5ZWQoJ2Jsb2NrJyk7XG4gICAgfVxuXG4gICAgLGhpZGVDb250ZW50OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmNvbnRlbnRNRC5zZXREaXNwbGF5ZWQoJ25vbmUnKTtcbiAgICB9XG5cbiAgICAsc2hvd1ByZXZpZXc6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMucHJldmlldy5wYXJlbnQoKS5zZXREaXNwbGF5ZWQoJ2Jsb2NrJyk7XG4gICAgfVxuXG4gICAgLGhpZGVQcmV2aWV3OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnByZXZpZXcucGFyZW50KCkuc2V0RGlzcGxheWVkKCdub25lJyk7XG4gICAgfVxuXG4gICAgLGJ1aWxkVUk6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldERpc3BsYXllZCgnbm9uZScpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldFdpZHRoKDApO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldEhlaWdodCgwKTtcblxuICAgICAgICB0aGlzLnRhTWFya2Rvd24gPSBFeHQuZ2V0KEV4dC5Eb21IZWxwZXIuaW5zZXJ0QmVmb3JlKHRoaXMudGV4dGFyZWEsIHtcbiAgICAgICAgICAgIHRhZzogJ3RleHRhcmVhJyxcbiAgICAgICAgICAgIG5hbWU6IHRoaXMubWRFbGVtZW50TmFtZSArICdfbWFya2Rvd24nLFxuICAgICAgICAgICAgY2xhc3M6IHRoaXMubWRFbGVtZW50TmFtZSArICdfbWFya2Rvd24nXG4gICAgICAgIH0pKTtcblxuICAgICAgICB0aGlzLnRhTWFya2Rvd24uc2V0RGlzcGxheWVkKCdub25lJyk7XG4gICAgICAgIHRoaXMudGFNYXJrZG93bi5zZXRXaWR0aCgwKTtcbiAgICAgICAgdGhpcy50YU1hcmtkb3duLnNldEhlaWdodCgwKTtcblxuICAgICAgICB0aGlzLm1kQ29udGFpbmVyID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmluc2VydEJlZm9yZSh0aGlzLnRleHRhcmVhLCB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3M6ICdtYXJrZG93bi1jb250YWluZXIgYWNlLScgKyAoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwudGhlbWUnXSB8fCAnbW9ub2thaScpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXy9nLCAnLScpXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgZnVsbFNjcmVlbkhlYWRlciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAnZnVsbHNjcmVlbi1oZWFkZXIgYWNlX2d1dHRlcicsXG4gICAgICAgICAgICBodG1sOiAnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgLz4nXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgcGFnZVRpdGxlID0gRXh0LmdldENtcCgnbW9keC1yZXNvdXJjZS1wYWdldGl0bGUnKTtcbiAgICAgICAgaWYgKHBhZ2VUaXRsZSkge1xuICAgICAgICAgICAgdmFyIGhlYWRlcklucHV0ID0gZnVsbFNjcmVlbkhlYWRlci5jaGlsZCgnaW5wdXQnKTtcbiAgICAgICAgICAgIGhlYWRlcklucHV0LmRvbS52YWx1ZSA9IHBhZ2VUaXRsZS5nZXRWYWx1ZSgpO1xuXG4gICAgICAgICAgICBoZWFkZXJJbnB1dC5vbignY2hhbmdlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBwYWdlVGl0bGUuc2V0VmFsdWUodGhpcy5kb20udmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBhZ2VUaXRsZS5vbignY2hhbmdlJywgZnVuY3Rpb24oZmllbGQsdmFsdWUpe1xuICAgICAgICAgICAgICAgIGhlYWRlcklucHV0LmRvbS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgd3JhcHBlciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAnbWFya2Rvd24td3JhcHBlcidcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHRoaXMuY29udGVudE1EID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh3cmFwcGVyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogdGhpcy50ZXh0YXJlYS5kb20uY2xhc3NOYW1lICsgJyBjb250ZW50LW1kICcgKyB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJ1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgdGhpcy5wcmV2aWV3ID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh3cmFwcGVyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogJ21hcmtkb3duLWJvZHkgcHJldmlldy1tZCdcbiAgICAgICAgfSkpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5wcmV2aWV3ID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh0aGlzLnByZXZpZXcuZG9tLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdidcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5wcmV2aWV3LmZpeEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLnJlc2l6ZSgpO1xuICAgICAgICAgICAgdmFyIGhlaWdodCA9IHRoYXQuZWRpdG9yLmdldFNlc3Npb24oKS5nZXRTY3JlZW5MZW5ndGgoKSAqIHRoYXQuZWRpdG9yLnJlbmRlcmVyLmxpbmVIZWlnaHQgKyB0aGF0LmVkaXRvci5yZW5kZXJlci5zY3JvbGxCYXIuZ2V0V2lkdGgoKSAgKyAyNTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5wYXJlbnQoKS5zZXRIZWlnaHQoaGVpZ2h0KTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5lbmFibGVfaW1hZ2VfdXBsb2FkJ10gPT0gMSB8fCBNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmVuYWJsZV9maWxlX3VwbG9hZCddID09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh0aGlzLm1kQ29udGFpbmVyLmRvbSx7XG4gICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ3N0YXR1cy1iYXIgYWNlX2d1dHRlcidcbiAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXNNb2JpbGVEZXZpY2UoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyLmRvbS5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cInVwbG9hZC1iYXJcIj4gPGlucHV0IGNsYXNzPVwiaGlkZGVuXCIgbmFtZT1cIm1kX2ZpbGVfJysgdGhpcy5zdGF0dXNCYXIuaWQgKydcIiBpZD1cIicgKyB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZVwiIHR5cGU9XCJmaWxlXCIgbXVsdGlwbGUgLz48aW5wdXQgY2xhc3M9XCJoaWRkZW5cIiBuYW1lPVwibWRfZmlsZV8nKyB0aGlzLnN0YXR1c0Jhci5pZCArJy1tb2JpbGVcIiBpZD1cIicgKyB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZS1tb2JpbGVcIiB0eXBlPVwiZmlsZVwiIGFjY2VwdD1cImltYWdlLypcIiBjYXB0dXJlPVwiY2FtZXJhXCIgLz4nICsgXygnbWFya2Rvd25lZGl0b3Iuc3RhdHVzX2Jhcl9tZXNzYWdlX21vYmlsZScsIHtpZDogdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGUnLCBpZF9tb2JpbGU6IHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlLW1vYmlsZSd9KSArICc8L2Rpdj4nO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuY2hpbGQoJyMnICsgdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGUtbW9iaWxlJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGUsIGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRmlsZXMoaW5wdXQuZmlsZXMsIDEpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyLmRvbS5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cInVwbG9hZC1iYXJcIj4gPGlucHV0IGNsYXNzPVwiaGlkZGVuXCIgbmFtZT1cIm1kX2ZpbGVfJysgdGhpcy5zdGF0dXNCYXIuaWQgKydcIiBpZD1cIicgKyB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZVwiIHR5cGU9XCJmaWxlXCIgbXVsdGlwbGU+JyArIF8oJ21hcmtkb3duZWRpdG9yLnN0YXR1c19iYXJfbWVzc2FnZScsIHtpZDogdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGUnfSkgKyAnPC9kaXY+JztcblxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyLmNoaWxkKCcjJyArIHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGUsIGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRmlsZXMoaW5wdXQuZmlsZXMpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmFwcGVuZCh0aGlzLm1kQ29udGFpbmVyLmRvbSx7XG4gICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ3N0YXR1cy1iYXInLFxuICAgICAgICAgICAgICAgIGh0bWw6IF8oJ21hcmtkb3duZWRpdG9yLnN0YXR1c19iYXJfZGlzYWJsZWQnKVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgICAgICBzdHlsZTogJ2NsZWFyOiBib3RoJ1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAsYnVpbGRUb29sYm94OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnRvb2xCb3ggPSBFeHQuZ2V0KEV4dC5Eb21IZWxwZXIuYXBwZW5kKHRoaXMuc3RhdHVzQmFyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogJ3Rvb2xib3gnLFxuICAgICAgICAgICAgY246IFt7XG4gICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ3ByZXZpZXctYnV0dG9uJyxcbiAgICAgICAgICAgICAgICBodG1sOiAnPGkgY2xhc3M9XCJpY29uIGljb24tZXllIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ3NwbGl0c2NyZWVuLWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgaHRtbDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLXBhdXNlIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ2Z1bGxzY3JlZW4tYnV0dG9uJyxcbiAgICAgICAgICAgICAgICBodG1sOiAnPGkgY2xhc3M9XCJpY29uIGljb24tZXhwYW5kIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgfV1cbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB0aGlzLnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5yZW1vdmVDbGFzcygnaWNvbi1wYXVzZScpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZCgnaScpLmFkZENsYXNzKCdpY29uLXN0b3AnKTtcblxuICAgICAgICAgICAgdGhhdC5jb250ZW50TUQucGFyZW50KCkucGFyZW50KCkuYWRkQ2xhc3MoJ3NwbGl0Jyk7XG4gICAgICAgICAgICB0aGF0LmVkaXRvci5yZXNpemUoKTtcbiAgICAgICAgICAgIHRoYXQucHJldmlldy5maXhIZWlnaHQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT2ZmID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykuYWRkQ2xhc3MoJ2ljb24tcGF1c2UnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5yZW1vdmVDbGFzcygnaWNvbi1zdG9wJyk7XG5cbiAgICAgICAgICAgIHRoYXQuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdzcGxpdCcpO1xuICAgICAgICAgICAgdGhhdC5lZGl0b3IucmVzaXplKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy50b29sQm94LmNoaWxkKCcuZnVsbHNjcmVlbi1idXR0b24nKS50dXJuT24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5yZW1vdmVDbGFzcygnaWNvbi1leHBhbmQnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5hZGRDbGFzcygnaWNvbi1jb21wcmVzcycpO1xuXG4gICAgICAgICAgICB2YXIgbW9keEJ1dHRvbnMgPSBFeHQuZ2V0KCdtb2R4LWFjdGlvbi1idXR0b25zJyk7XG4gICAgICAgICAgICBpZiAobW9keEJ1dHRvbnMpIHtcbiAgICAgICAgICAgICAgICBtb2R4QnV0dG9ucy5hZGRDbGFzcygnbWFya2Rvd25lZGl0b3ItZnVsbHNjcmVlbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LmZ1bGxTY3JlZW4gPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwuc3BsaXRfZnVsbHNjcmVlbiddIHx8IDEpID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC50b29sQm94LmNoaWxkKCcuc3BsaXRzY3JlZW4tYnV0dG9uJykudHVybk9mZigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LnNob3dQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGF0LnNob3dDb250ZW50KCk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIHRoYXQuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLmFkZENsYXNzKCdmdWxsc2NyZWVuJyk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLnNldE9wdGlvbignbWF4TGluZXMnLCBudWxsKTtcbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLnJlc2l6ZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudG9vbEJveC5jaGlsZCgnLmZ1bGxzY3JlZW4tYnV0dG9uJykudHVybk9mZiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jaGlsZCgnaScpLmFkZENsYXNzKCdpY29uLWV4cGFuZCcpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZCgnaScpLnJlbW92ZUNsYXNzKCdpY29uLWNvbXByZXNzJyk7XG5cbiAgICAgICAgICAgIHZhciBtb2R4QnV0dG9ucyA9IEV4dC5nZXQoJ21vZHgtYWN0aW9uLWJ1dHRvbnMnKTtcbiAgICAgICAgICAgIGlmIChtb2R4QnV0dG9ucykge1xuICAgICAgICAgICAgICAgIG1vZHhCdXR0b25zLnJlbW92ZUNsYXNzKCdtYXJrZG93bmVkaXRvci1mdWxsc2NyZWVuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoYXQuZnVsbFNjcmVlbiA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwuc3BsaXQnXSB8fCAwKSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhhdC50b29sQm94LmNoaWxkKCcuc3BsaXRzY3JlZW4tYnV0dG9uJykudHVybk9uKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpLnR1cm5PZmYoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhhdC5oaWRlUHJldmlldygpO1xuICAgICAgICAgICAgdGhhdC5zaG93Q29udGVudCgpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvci5mb2N1cygpO1xuXG4gICAgICAgICAgICB0aGF0LmNvbnRlbnRNRC5wYXJlbnQoKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnZnVsbHNjcmVlbicpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvci5zZXRPcHRpb24oJ21heExpbmVzJywgSW5maW5pdHkpO1xuXG4gICAgICAgICAgICB0aGF0LnByZXZpZXcuZml4SGVpZ2h0KCk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLHJlZ2lzdGVyQWNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBhY2UuZWRpdChFeHQuRG9tUXVlcnkuc2VsZWN0Tm9kZSgnZGl2LicgKyB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJykpO1xuICAgICAgICBhY2UucmVxdWlyZShcImFjZS9sYXllci9ndXR0ZXJfdG9vbGJhclwiKTtcblxuICAgICAgICB0aGlzLmVkaXRvci5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIG1heExpbmVzOiBJbmZpbml0eSxcbiAgICAgICAgICAgIG1pbkxpbmVzOiAyNSxcbiAgICAgICAgICAgIGVuYWJsZUJhc2ljQXV0b2NvbXBsZXRpb246IHRydWUsXG4gICAgICAgICAgICBwcmludE1hcmdpbjogZmFsc2UsXG4gICAgICAgICAgICBzaG93R3V0dGVyOiB0cnVlLFxuICAgICAgICAgICAgdXNlU29mdFRhYnM6IHRydWUsXG4gICAgICAgICAgICBzaG93Rm9sZFdpZGdldHM6IGZhbHNlLFxuICAgICAgICAgICAgc2hvd0xpbmVOdW1iZXJzOiBmYWxzZSxcbiAgICAgICAgICAgIGZvbnRTaXplOiBwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC5mb250X3NpemUnXSkgfHwgMTIsXG4gICAgICAgICAgICBmb250RmFtaWx5OiBNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC5mb250X2ZhbWlseSddIHx8ICcnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVkaXRvci4kYmxvY2tTY3JvbGxpbmcgPSBJbmZpbml0eTtcbiAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5zZXRVc2VXcmFwTW9kZSh0cnVlKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5zZXRXcmFwTGltaXRSYW5nZSgpO1xuICAgICAgICB0aGlzLmVkaXRvci5yZW5kZXJlci5zZXRTY3JvbGxNYXJnaW4oMTAsIDEwKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5zZXRWYWx1ZSh0aGlzLnRleHRhcmVhLmdldFZhbHVlKCkpO1xuICAgICAgICB0aGlzLmVkaXRvci5zZXNzaW9uLnNldE1vZGUoXCJhY2UvbW9kZS9tYXJrZG93bmVkaXRvclwiKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iuc2V0VGhlbWUoXCJhY2UvdGhlbWUvXCIgKyAoTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLmdlbmVyYWwudGhlbWUnXSB8fCAnbW9ub2thaScpKTtcblxuICAgICAgICBpZiAodGhpcy5jb250ZW50TUQuaGFzQ2xhc3MoJ2FjZV9kYXJrJykpIHtcbiAgICAgICAgICAgIHRoaXMubWRDb250YWluZXIuYWRkQ2xhc3MoJ3RoZW1lLWRhcmsnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWRDb250YWluZXIuYWRkQ2xhc3MoJ3RoZW1lLWxpZ2h0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICB0aGlzLmVkaXRvci5zZWxlY3Rpb24ub24oJ2NoYW5nZUN1cnNvcicsIGZ1bmN0aW9uIChlLCBzZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmd1dHRlclRvb2xiYXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmd1dHRlclRvb2xiYXIudXBkYXRlKCcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlKCk7XG4gICAgICAgICAgICBpZiAocmFuZ2Uuc3RhcnQucm93ICE9IHJhbmdlLmVuZC5yb3cpIHJldHVybjtcblxuICAgICAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5hZGRHdXR0ZXJEZWNvcmF0aW9uKHJhbmdlLnN0YXJ0LnJvdywgJycpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24uZ3V0dGVyUmVuZGVyZXIgPSAge1xuICAgICAgICAgICAgZ2V0V2lkdGg6IGZ1bmN0aW9uKHNlc3Npb24sIGxhc3RMaW5lTnVtYmVyLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmNoYXJhY3RlcldpZHRoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFRleHQ6IGZ1bmN0aW9uKHNlc3Npb24sIHJvdywgY2VsbCkge1xuICAgICAgICAgICAgICAgIGlmIChjZWxsLmVsZW1lbnQgJiYgdGhpcy5lZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKS5yb3cgPT0gcm93ICYmIHNlc3Npb24uZG9jLiRsaW5lc1tyb3ddID09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRHdXR0ZXJUb29sYmFyKGNlbGwuZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5lbGVtZW50LmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLmNvbW1hbmRzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgbmFtZTogXCJJbmRlbnQgbGlzdFwiLFxuICAgICAgICAgICAgYmluZEtleToge3dpbjogXCJUYWJcIiwgbWFjOiBcIlRhYlwifSxcbiAgICAgICAgICAgIGV4ZWM6IGZ1bmN0aW9uKGVkaXRvcikge1xuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gZWRpdG9yLnNlc3Npb24uZ2V0TGluZShlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKS5yb3cpO1xuICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IC9eKFxccyopKD86KFstKypdKXwoXFxkKylcXC4pKFxccyspLy5leGVjKGxpbmUpO1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2Vzc2lvbi5pbmRlbnRSb3dzKGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvdywgZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93LCAnXFx0Jyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmluZGVudCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lZGl0b3IuY29tbWFuZHMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBuYW1lOiBcIkV4aXQgZnVsbHNjcmVlblwiLFxuICAgICAgICAgICAgYmluZEtleToge3dpbjogXCJFc2NcIiwgbWFjOiBcIkVzY1wifSxcbiAgICAgICAgICAgIGV4ZWM6IGZ1bmN0aW9uKGVkaXRvcikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZ1bGxTY3JlZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b29sQm94LmNoaWxkKCcuZnVsbHNjcmVlbi1idXR0b24nKS50dXJuT2ZmKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBsYW5nVG9vbHMgPSBhY2UucmVxdWlyZShcImFjZS9leHQvbGFuZ3VhZ2VfdG9vbHNcIik7XG4gICAgICAgIHZhciByZXNvdXJjZXNDb21wbGV0ZXIgPSB7XG4gICAgICAgICAgICBnZXRDb21wbGV0aW9uczogZnVuY3Rpb24oZWRpdG9yLCBzZXNzaW9uLCBwb3MsIHByZWZpeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAocHJlZml4Lmxlbmd0aCA9PT0gMCkgeyBjYWxsYmFjayhudWxsLCBbXSk7IHJldHVybiB9XG5cbiAgICAgICAgICAgICAgICBNT0R4LkFqYXgucmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogbWFya2Rvd25FZGl0b3IuY29uZmlnLmNvbm5lY3RvclVybFxuICAgICAgICAgICAgICAgICAgICAscGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdtZ3IvcmVzb3VyY2UvZ2V0bGlzdCdcbiAgICAgICAgICAgICAgICAgICAgICAgICxwcmVmaXg6IHByZWZpeFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbihyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHIucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgbGFuZ1Rvb2xzLmFkZENvbXBsZXRlcihyZXNvdXJjZXNDb21wbGV0ZXIpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VudGVyXCIsIHRoaXMuY2F0Y2hBbmREb05vdGhpbmcsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5lZGl0b3IuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCB0aGlzLmNhdGNoQW5kRG9Ob3RoaW5nLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCB0aGlzLmRyb3AuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIH1cblxuICAgICxhZGRHdXR0ZXJUb29sYmFyOiBmdW5jdGlvbihjZWxsKXtcbiAgICAgICAgdGhpcy5ndXR0ZXJUb29sYmFyID0gRXh0LmdldChjZWxsKTtcblxuICAgICAgICBpZiAodGhpcy5pc01vYmlsZURldmljZSgpKSB7XG4gICAgICAgICAgICB0aGlzLmd1dHRlclRvb2xiYXIudXBkYXRlKCc8aSBjbGFzcz1cImljb24gaWNvbi1wbHVzIGljb24tZml4ZWQtd2lkdGhcIj48L2k+JyArXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImlubGluZS10b29sYmFyXCI+JyArXG4gICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiaWNvbiBpY29uLWFyY2hpdmUgaWNvbi1maXhlZC13aWR0aFwiPjwvaT4nICtcbiAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj1cIicrdGhpcy5zdGF0dXNCYXIuaWQrJy1maWxlXCI+PGkgY2xhc3M9XCJpY29uIGljb24tdXBsb2FkIGljb24tZml4ZWQtd2lkdGhcIj48L2k+PC9sYWJlbD4nICtcbiAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj1cIicrdGhpcy5zdGF0dXNCYXIuaWQrJy1maWxlLW1vYmlsZVwiPjxpIGNsYXNzPVwiaWNvbiBpY29uLWNhbWVyYSBpY29uLWZpeGVkLXdpZHRoXCI+PC9pPjwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiaWNvbiBpY29uLWNvZGUgaWNvbi1maXhlZC13aWR0aFwiPjwvaT4nICtcbiAgICAgICAgICAgICc8L2Rpdj4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ3V0dGVyVG9vbGJhci51cGRhdGUoJzxpIGNsYXNzPVwiaWNvbiBpY29uLXBsdXMgaWNvbi1maXhlZC13aWR0aFwiPjwvaT4nICtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiaW5saW5lLXRvb2xiYXJcIj4nICtcbiAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJpY29uIGljb24tYXJjaGl2ZSBpY29uLWZpeGVkLXdpZHRoXCI+PC9pPicgK1xuICAgICAgICAgICAgICAgICc8bGFiZWwgZm9yPVwiJyt0aGlzLnN0YXR1c0Jhci5pZCsnLWZpbGVcIj48aSBjbGFzcz1cImljb24gaWNvbi11cGxvYWQgaWNvbi1maXhlZC13aWR0aFwiPjwvaT48L2xhYmVsPicgK1xuICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cImljb24gaWNvbi1jb2RlIGljb24tZml4ZWQtd2lkdGhcIj48L2k+JyArXG4gICAgICAgICAgICAnPC9kaXY+Jyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc3dpdGNoZXIgPSB0aGlzLmd1dHRlclRvb2xiYXIuY2hpbGQoJ2kuaWNvbi1wbHVzJyk7XG4gICAgICAgIHZhciBpbmxpbmVUb29sYmFyID0gdGhpcy5ndXR0ZXJUb29sYmFyLmNoaWxkKCcuaW5saW5lLXRvb2xiYXInKTtcblxuICAgICAgICBzd2l0Y2hlci50dXJuT24gPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgc3dpdGNoZXIuYWRkQ2xhc3MoJ21kLWljb24tcm90YXRlLTQ1Jyk7XG4gICAgICAgICAgICBpbmxpbmVUb29sYmFyLnNob3coKTtcbiAgICAgICAgfTtcblxuICAgICAgICBzd2l0Y2hlci50dXJuT2ZmID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHN3aXRjaGVyLnJlbW92ZUNsYXNzKCdtZC1pY29uLXJvdGF0ZS00NScpO1xuICAgICAgICAgICAgaW5saW5lVG9vbGJhci5oaWRlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc3dpdGNoZXIub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmKCFzd2l0Y2hlci5oYXNDbGFzcygnbWQtaWNvbi1yb3RhdGUtNDUnKSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaGVyLnR1cm5PbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2hlci50dXJuT2ZmKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5ndXR0ZXJUb29sYmFyLmNoaWxkKCdpLmljb24tY29kZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIE1PRHgubG9hZCh7XG4gICAgICAgICAgICAgICAgeHR5cGU6ICdtYXJrZG93bmVkaXRvci13aW5kb3ctb2VtYmVkJ1xuICAgICAgICAgICAgICAgICxzdWNjZXNzOiBmdW5jdGlvbih2YWx1ZXMpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5pbnNlcnQoJ1tlbWJlZCAnICsgdmFsdWVzLnVybCArICddJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgfSkuc2hvdygpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5ndXR0ZXJUb29sYmFyLmNoaWxkKCdpLmljb24tYXJjaGl2ZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIE1PRHgubG9hZCh7XG4gICAgICAgICAgICAgICAgeHR5cGU6ICdtb2R4LWJyb3dzZXItd2luZG93J1xuICAgICAgICAgICAgICAgICxzb3VyY2U6IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNvdXJjZSddKVxuICAgICAgICAgICAgICAgICxoaWRlU291cmNlQ29tYm86IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNvdXJjZV9zZWxlY3QnXSB8fCAwKSAhPSAxXG4gICAgICAgICAgICAgICAgLG9uU2VsZWN0OiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmt1cCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5wcmV2aWV3KSBtYXJrdXAgPSAnISc7XG4gICAgICAgICAgICAgICAgICAgIG1hcmt1cCA9IG1hcmt1cCArICdbJyArIGRhdGEubmFtZSArICddKCcgKyBkYXRhLmZ1bGxSZWxhdGl2ZVVybCArICcgXCInICsgZGF0YS5uYW1lICsgJ1wiKSc7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuaW5zZXJ0KG1hcmt1cCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgfSkuc2hvdygpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgICxyZWdpc3RlclJlbWFya2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnJlbWFya2FibGUgPSBuZXcgUmVtYXJrYWJsZSh7XG4gICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgaGlnaGxpZ2h0OiBmdW5jdGlvbiAoc3RyLCBsYW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKGxhbmcgJiYgaGxqcy5nZXRMYW5ndWFnZShsYW5nKSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBobGpzLmhpZ2hsaWdodChsYW5nLCBzdHIpLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcW1xcWy9nLCAnJiM5MTsmIzkxOycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9dXS9nLCAnJiM5MzsmIzkzOycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge31cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGhsanMuaGlnaGxpZ2h0QXV0byhzdHIpLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxbXFxbL2csICcmIzkxOyYjOTE7Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXV0vZywgJyYjOTM7JiM5MzsnKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZW1hcmthYmxlLmlubGluZS5ydWxlci5kaXNhYmxlKFsgJ2JhY2t0aWNrcycgXSk7XG5cbiAgICAgICAgdmFyIG9FbWJlZFJlbmRlcmVyID0gZnVuY3Rpb24odG9rZW5zLCBpZHgsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxvY2FsQ2FjaGUub0VtYmVkW3Rva2Vuc1tpZHhdLnVybF0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbENhY2hlLm9FbWJlZFt0b2tlbnNbaWR4XS51cmxdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZW1iZWRJRCA9IEV4dC5pZCgpO1xuXG4gICAgICAgICAgICAgICAgTU9EeC5BamF4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IG1hcmtkb3duRWRpdG9yLmNvbmZpZy5jb25uZWN0b3JVcmxcbiAgICAgICAgICAgICAgICAgICAgLHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnbWdyL2VkaXRvci9vZW1iZWQnXG4gICAgICAgICAgICAgICAgICAgICAgICAsdXJsOiB0b2tlbnNbaWR4XS51cmxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24ocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW1iZWREaXYgPSBFeHQuZ2V0KGVtYmVkSUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW1iZWREaXYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYmVkRGl2LnVwZGF0ZShyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1iZWREaXYuZG9tLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYWxDYWNoZS5vRW1iZWRbdG9rZW5zW2lkeF0udXJsXSA9IGVtYmVkRGl2LmRvbS5vdXRlckhUTUw7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dGFyZWFDb250ZW50ID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmNyZWF0ZURvbSh7dGFnOiAnZGl2JywgaHRtbDogdGhpcy50ZXh0YXJlYS5kb20udmFsdWV9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0YXJlYUNvbnRlbnQuY2hpbGQoJyMnICsgZW1iZWRJRCkudXBkYXRlKHIuZGF0YSkuZG9tLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuZG9tLnZhbHVlID0gdGV4dGFyZWFDb250ZW50LmRvbS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBpZD1cIicgKyBlbWJlZElEICsgJ1wiIGNsYXNzPVwibWFya2Rvd25lZGl0b3Itb2VtYmVkLWNvbnRlbnRcIj5bZW1iZWQgJyArIHRva2Vuc1tpZHhdLnVybCArICddPC9kaXY+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHZhciByZW1hcmthYmxlID0gdGhpcy5yZW1hcmthYmxlO1xuICAgICAgICByZW1hcmthYmxlLnJlbmRlcmVyLnJ1bGVzLmNvZGUgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb3JpZ2luYWwgPSByZW1hcmthYmxlLnJlbmRlcmVyLnJ1bGVzLmNvZGU7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoL1xcW1xcWy9nLCAnJiM5MTsmIzkxOycpO1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoL11dL2csICcmIzkzOyYjOTM7Jyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSgpO1xuICAgICAgICBcbiAgICAgICAgdmFyIG9FbWJlZCA9IGZ1bmN0aW9uKG1kKSB7XG4gICAgICAgICAgICBtZC5pbmxpbmUucnVsZXIucHVzaCgnb0VtYmVkJywgdGhpcy5vRW1iZWRQYXJzZXIpO1xuICAgICAgICAgICAgbWQucmVuZGVyZXIucnVsZXMub0VtYmVkID0gb0VtYmVkUmVuZGVyZXI7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgICAgXG4gICAgICAgIHZhciBtb2R4VGFncyA9IGZ1bmN0aW9uKG1kKSB7XG4gICAgICAgICAgICBtZC5pbmxpbmUucnVsZXIucHVzaCgnbW9keENvZGUnLCB0aGlzLm1vZHhDb2RlUGFyc2VyKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHRoaXMucmVtYXJrYWJsZS51c2Uob0VtYmVkKTtcbiAgICAgICAgdGhpcy5yZW1hcmthYmxlLnVzZShtb2R4VGFncyk7XG4gICAgfVxuXG4gICAgLHBhcnNlOiBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICB2YXIgb3V0cHV0ID0gdGhpcy5yZW1hcmthYmxlLnJlbmRlcihpbnB1dCk7XG5cbiAgICAgICAgb3V0cHV0ID0gb3V0cHV0LnJlcGxhY2UoLyU1Qi9nLCAnWycpO1xuICAgICAgICBvdXRwdXQgPSBvdXRwdXQucmVwbGFjZSgvJTVEL2csICddJyk7XG5cbiAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5scC5wYXJzZV9tb2R4X3RhZ3MnXSA9PSAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJzZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5wYXJzZVJlcXVlc3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGltZW91dCA9IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5scC5wYXJzZV9tb2R4X3RhZ3NfdGltZW91dCddIHx8IDMwMCk7XG5cbiAgICAgICAgICAgIHRoaXMucGFyc2VSZXF1ZXN0ID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIE1PRHguQWpheC5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBtYXJrZG93bkVkaXRvci5jb25maWcuY29ubmVjdG9yVXJsXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ21nci9lZGl0b3IvcHJvY2Vzc2NvbnRlbnQnXG4gICAgICAgICAgICAgICAgICAgICAgICAsY29udGVudDogb3V0cHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAscmVzb3VyY2U6IE1PRHgucmVxdWVzdC5pZFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBpc1VwbG9hZCA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1ByZXZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UHJldmlldy5pbm5lckhUTUwgPSByLmRhdGE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWZmRE9NLmFwcGx5KHRoaXMucHJldmlldy5kb20sIHRoaXMuZGlmZkRPTS5kaWZmKHRoaXMucHJldmlldy5kb20sIG5ld1ByZXZpZXcpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcuZml4SGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93ICsgMikgPj0gdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLmdldERvY3VtZW50KCkuZ2V0TGVuZ3RoKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlldy5wYXJlbnQoKS5kb20uc2Nyb2xsVG9wID0gdGhpcy5wcmV2aWV3LnBhcmVudCgpLmRvbS5zY3JvbGxIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgdGltZW91dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbmV3UHJldmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgbmV3UHJldmlldy5pbm5lckhUTUwgPSBvdXRwdXQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuZGlmZkRPTS5hcHBseSh0aGlzLnByZXZpZXcuZG9tLCB0aGlzLmRpZmZET00uZGlmZih0aGlzLnByZXZpZXcuZG9tLCBuZXdQcmV2aWV3KSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMucHJldmlldy5maXhIZWlnaHQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKCh0aGlzLmVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvdyArIDIpID49IHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5nZXREb2N1bWVudCgpLmdldExlbmd0aCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3LnBhcmVudCgpLmRvbS5zY3JvbGxUb3AgPSB0aGlzLnByZXZpZXcucGFyZW50KCkuZG9tLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFNYXJrZG93bi5kb20udmFsdWUgPSB0aGlzLmVkaXRvci5nZXRWYWx1ZSgpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLmRvbS52YWx1ZSA9IG91dHB1dDtcblxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cblxuICAgICxvRW1iZWRQYXJzZXI6IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICAgIC8vIEdpdmVuIHN0YXRlLnNyYyBbZW1iZWQgdXJsXVxuICAgICAgICAvLyBXZSBhcmUgaGVyZTogICAgXlxuICAgICAgICB2YXIgcG9zID0gc3RhdGUucG9zO1xuICAgICAgICB2YXIgbWFya2VyID0gc3RhdGUuc3JjLmNoYXJDb2RlQXQoc3RhdGUucG9zKTtcbiAgICAgICAgaWYgKG1hcmtlciAhPT0gMHg1Qi8qIFsgKi8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdpdmVuIHN0YXRlLnNyYyBbZW1iZWQgdXJsXVxuICAgICAgICAvLyBXZSBhcmUgaGVyZTogICAgIF5cbiAgICAgICAgcG9zKys7XG4gICAgICAgIG1hcmtlciA9IHN0YXRlLnNyYy5jaGFyQ29kZUF0KHBvcyk7XG4gICAgICAgIGlmIChtYXJrZXIgIT09IDB4NjUvKiBlICovKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHaXZlbiBzdGF0ZS5zcmMgW2VtYmVkIHVybF1cbiAgICAgICAgLy8gV2UgYXJlIGhlcmU6ICAgICAgXlxuICAgICAgICBwb3MrKztcbiAgICAgICAgbWFya2VyID0gc3RhdGUuc3JjLmNoYXJDb2RlQXQocG9zKTtcbiAgICAgICAgaWYgKG1hcmtlciAhPT0gMHg2RC8qIG0gKi8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdpdmVuIHN0YXRlLnNyYyBbZW1iZWQgdXJsXVxuICAgICAgICAvLyBXZSBhcmUgaGVyZTogICAgICAgXlxuICAgICAgICBwb3MrKztcbiAgICAgICAgbWFya2VyID0gc3RhdGUuc3JjLmNoYXJDb2RlQXQocG9zKTtcbiAgICAgICAgaWYgKG1hcmtlciAhPT0gMHg2Mi8qIGIgKi8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdpdmVuIHN0YXRlLnNyYyBbZW1iZWQgdXJsXVxuICAgICAgICAvLyBXZSBhcmUgaGVyZTogICAgICAgIF5cbiAgICAgICAgcG9zKys7XG4gICAgICAgIG1hcmtlciA9IHN0YXRlLnNyYy5jaGFyQ29kZUF0KHBvcyk7XG4gICAgICAgIGlmIChtYXJrZXIgIT09IDB4NjUvKiBlICovKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHaXZlbiBzdGF0ZS5zcmMgW2VtYmVkIHVybF1cbiAgICAgICAgLy8gV2UgYXJlIGhlcmU6ICAgICAgICAgXlxuICAgICAgICBwb3MrKztcbiAgICAgICAgbWFya2VyID0gc3RhdGUuc3JjLmNoYXJDb2RlQXQocG9zKTtcbiAgICAgICAgaWYgKG1hcmtlciAhPT0gMHg2NC8qIGQgKi8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdpdmVuIHN0YXRlLnNyYyBbZW1iZWQgdXJsXVxuICAgICAgICAvLyBXZSBhcmUgaGVyZTogICAgICAgICAgXlxuICAgICAgICBwb3MrKztcbiAgICAgICAgbWFya2VyID0gc3RhdGUuc3JjLmNoYXJDb2RlQXQocG9zKTtcbiAgICAgICAgaWYgKG1hcmtlciAhPT0gMHgyMC8qICAgKi8pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBvcysrO1xuXG4gICAgICAgIHZhciBzdGFydCA9IHBvcztcbiAgICAgICAgdmFyIG1heCA9IHN0YXRlLnBvc01heDtcbiAgICAgICAgdmFyIGVuZEZvdW5kID0gZmFsc2U7XG4gICAgICAgIHdoaWxlIChwb3MgPCBtYXgpIHtcbiAgICAgICAgICAgIGlmIChzdGF0ZS5zcmMuY2hhckNvZGVBdChwb3MpID09PSAweDVELyogXSAqLykge1xuICAgICAgICAgICAgICAgIGVuZEZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHN0YXRlLnNyYy5jaGFyQ29kZUF0KHBvcykgPT09IDB4MjAvKiAgKi8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBvcysrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFlbmRGb3VuZCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIHN0YXRlLnBvcyA9IHBvcysxO1xuXG4gICAgICAgIGlmIChzdGF0ZS5wb3MgPiBzdGF0ZS5wb3NNYXgpIHtcbiAgICAgICAgICAgIHN0YXRlLnBvcyA9IHN0YXRlLnBvc01heDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB1cmwgPSBzdGF0ZS5zcmMuc2xpY2Uoc3RhcnQsIHBvcyk7XG5cbiAgICAgICAgLy8gSGF2aW5nIG1hdGNoZWQgYWxsIHRocmVlIGNoYXJhY3RlcnMgd2UgYWRkIGEgdG9rZW4gdG8gdGhlIHN0YXRlIGxpc3RcbiAgICAgICAgdmFyIHRva2VuID0ge1xuICAgICAgICAgICAgdHlwZTogXCJvRW1iZWRcIixcbiAgICAgICAgICAgIGxldmVsOiBzdGF0ZS5sZXZlbCxcbiAgICAgICAgICAgIGNvbnRlbnQ6IG1hcmtlcixcbiAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgIH07XG5cbiAgICAgICAgc3RhdGUucHVzaCh0b2tlbik7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgICxtb2R4Q29kZVBhcnNlcjogZnVuY3Rpb24oc3RhdGUsIHNpbGVudCkge1xuICAgICAgICB2YXIgbWF4LCBtYXJrZXIsIG1hdGNoU3RhcnQsIG1hdGNoRW5kLFxuICAgICAgICAgICAgcG9zID0gc3RhdGUucG9zO1xuXG4gICAgICAgIGlmIChzdGF0ZS5zcmMuY2hhckNvZGVBdChwb3MpICE9PSAweDYwLyogYCAqLykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgcG9zKys7XG4gICAgICAgIGlmIChzdGF0ZS5zcmMuY2hhckNvZGVBdChwb3MpICE9PSAweDYwLyogYCAqLykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgcG9zKys7XG4gICAgICAgIGlmIChzdGF0ZS5zcmMuY2hhckNvZGVBdChwb3MpICE9PSAweDYwLyogYCAqLykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgXG4gICAgICAgIHBvcysrO1xuICAgICAgICBtYXggPSBzdGF0ZS5wb3NNYXg7XG5cbiAgICAgICAgbWFya2VyID0gJ2BgYCc7XG5cbiAgICAgICAgbWF0Y2hTdGFydCA9IG1hdGNoRW5kID0gcG9zO1xuXG4gICAgICAgIHdoaWxlICgobWF0Y2hTdGFydCA9IHN0YXRlLnNyYy5pbmRleE9mKCdgJywgbWF0Y2hFbmQpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIG1hdGNoRW5kID0gbWF0Y2hTdGFydCArIDE7XG5cbiAgICAgICAgICAgIHdoaWxlIChtYXRjaEVuZCA8IG1heCAmJiBzdGF0ZS5zcmMuY2hhckNvZGVBdChtYXRjaEVuZCkgPT09IDB4NjAvKiBgICovKSB7IG1hdGNoRW5kKys7IH1cblxuICAgICAgICAgICAgaWYgKG1hdGNoRW5kIC0gbWF0Y2hTdGFydCA9PT0gbWFya2VyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghc2lsZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NvZGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogc3RhdGUuc3JjLnNsaWNlKHBvcywgbWF0Y2hTdGFydClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvWyBcXG5dKy9nLCAnICcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyaW0oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsOiBzdGF0ZS5sZXZlbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RhdGUucG9zID0gbWF0Y2hFbmQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXNpbGVudCkgeyBzdGF0ZS5wZW5kaW5nICs9IG1hcmtlcjsgfVxuICAgICAgICBzdGF0ZS5wb3MgKz0gbWFya2VyLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLGNhdGNoQW5kRG9Ob3RoaW5nOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICAsZHJvcDogZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ltYWdlX3VwbG9hZCddID09IDEgfHwgTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5lbmFibGVfZmlsZV91cGxvYWQnXSA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZpbGVzKGUuZGF0YVRyYW5zZmVyLmZpbGVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICxoYW5kbGVGaWxlczogZnVuY3Rpb24oZmlsZXMsIG1vYmlsZSkge1xuICAgICAgICBtb2JpbGUgPSBtb2JpbGUgfHwgMDtcblxuICAgICAgICBFeHQuZWFjaChmaWxlcywgZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgdmFyIGlzSW1hZ2UgPSAvXmltYWdlXFwvLy50ZXN0KGZpbGUudHlwZSk7XG5cbiAgICAgICAgICAgIGlmIChpc0ltYWdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ltYWdlX3VwbG9hZCddID09IDApIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrVHlwZShNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmltYWdlX3R5cGVzJ10sIGZpbGUpKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsTWVzc2FnZShmaWxlLCAnaW1hZ2UnLCBfKCdtYXJrZG93bmVkaXRvci5lcnIudXBsb2FkLnVuc3VwcG9ydGVkX2ltYWdlJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrU2l6ZShmaWxlLnNpemUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbE1lc3NhZ2UoZmlsZSwgJ2ltYWdlJywgXygnbWFya2Rvd25lZGl0b3IuZXJyLnVwbG9hZC50b29fYmlnJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuY3JvcHBlci5lbmFibGVfY3JvcHBlciddID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgTU9EeC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnbWFya2Rvd25lZGl0b3Itd2luZG93LWNyb3BwZXInXG4gICAgICAgICAgICAgICAgICAgICAgICAsZmlsZTogZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgLG1kOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICAsbW9iaWxlOiBtb2JpbGVcbiAgICAgICAgICAgICAgICAgICAgfSkuc2hvdygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZShmaWxlLCAnaW1hZ2UnLCBtb2JpbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ZpbGVfdXBsb2FkJ10gPT0gMCkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tUeXBlKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZmlsZV90eXBlcyddLCBmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxNZXNzYWdlKGZpbGUsICdmaWxlJywgXygnbWFya2Rvd25lZGl0b3IuZXJyLnVwbG9hZC51bnN1cHBvcnRlZF9maWxlJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jaGVja1NpemUoZmlsZS5zaXplKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxNZXNzYWdlKGZpbGUsICdmaWxlJywgXygnbWFya2Rvd25lZGl0b3IuZXJyLnVwbG9hZC50b29fYmlnJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZShmaWxlLCAnZmlsZScpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxuXG4gICAgLGNoZWNrU2l6ZTogZnVuY3Rpb24oc2l6ZSl7XG4gICAgICAgIHZhciBtYXhTaXplID0gTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5tYXhfc2l6ZSddO1xuICAgICAgICBpZiAoIW1heFNpemUgfHwgbWF4U2l6ZSA9PSAnJykgbWF4U2l6ZSA9IChNT0R4LmNvbmZpZ1sndXBsb2FkX21heHNpemUnXSB8fCAnMjA5NzE1MicpO1xuXG4gICAgICAgIG1heFNpemUgPSBwYXJzZUludChtYXhTaXplKTtcblxuICAgICAgICBpZiAobWF4U2l6ZSA9PSAwKSByZXR1cm4gdHJ1ZTtcblxuICAgICAgICByZXR1cm4gc2l6ZSA8PSBtYXhTaXplO1xuICAgIH1cblxuICAgICxjaGVja1R5cGU6IGZ1bmN0aW9uKGFsbG93ZWRUeXBlcywgZmlsZSkge1xuICAgICAgICBhbGxvd2VkVHlwZXMgPSBhbGxvd2VkVHlwZXMuc3BsaXQoJywnKTtcbiAgICAgICAgdmFyIGV4dCA9IGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpO1xuICAgICAgICByZXR1cm4gYWxsb3dlZFR5cGVzLmluZGV4T2YoZXh0LnRvTG93ZXJDYXNlKCkpICE9IC0xO1xuICAgIH1cblxuICAgICx1cGxvYWRGaWxlOiBmdW5jdGlvbihmaWxlLCB0eXBlLCBtb2JpbGUpIHtcbiAgICAgICAgdHlwZSA9IHR5cGUgfHwgJ2ZpbGUnO1xuICAgICAgICBtb2JpbGUgPSBtb2JpbGUgfHwgMDtcblxuICAgICAgICB2YXIgdXBsb2FkZXIgPSB0aGlzLmNyZWF0ZVVwbG9hZGVyKHR5cGUsIGZpbGUubmFtZSk7XG5cbiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2FjdGlvbicsICdtZ3IvZWRpdG9yLycgKyB0eXBlICsgJ3VwbG9hZCcpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ25hbWUnLCBmaWxlLm5hbWUpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Jlc291cmNlJywgdGhpcy5jb25maWcucmVzb3VyY2UpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ21vYmlsZScsIG1vYmlsZSk7XG5cbiAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICB4aHIub3BlbignUE9TVCcsIG1hcmtkb3duRWRpdG9yLmNvbmZpZy5jb25uZWN0b3JVcmwpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignUG93ZXJlZC1CeScsICdNT0R4Jyk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdtb2RBdXRoJywgRXh0LkFqYXguZGVmYXVsdEhlYWRlcnMubW9kQXV0aCk7XG5cbiAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQubGVuZ3RoQ29tcHV0YWJsZSkge1xuICAgICAgICAgICAgICAgIHZhciBjb21wbGV0ZSA9IChldmVudC5sb2FkZWQgLyBldmVudC50b3RhbCAqIDEwMCB8IDApO1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyLmNoaWxkKCcucHJvZ3Jlc3MnKS5zZXRXaWR0aChjb21wbGV0ZSArICclJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VQcmVmaXggPSAodHlwZSA9PSAnaW1hZ2UnKSA/ICchJyA6ICcnO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kTGluZSA9ICh0eXBlID09ICdpbWFnZScpID8gJ1xcblxcbicgOiAnXFxuJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuaW5zZXJ0KGltYWdlUHJlZml4ICsgJ1snICsgcmVzLm9iamVjdC5uYW1lICsgJ10oJyArIHJlcy5vYmplY3QucGF0aCArICcgXCInICsgcmVzLm9iamVjdC5uYW1lICsgJ1wiKScgKyBlbmRMaW5lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxVcGxvYWRlcih1cGxvYWRlciwgcmVzLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcbiAgICB9XG5cbiAgICAsY3JlYXRlVXBsb2FkZXI6IGZ1bmN0aW9uKHR5cGUsIGZpbGVOYW1lKSB7XG4gICAgICAgIHZhciB1cGxvYWRlciA9IEV4dC5Eb21IZWxwZXIuaW5zZXJ0Rmlyc3QodGhpcy5zdGF0dXNCYXIse1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGh0bWw6ICc8ZGl2IGNsYXNzPVwicHJvZ3Jlc3NcIj48aSBjbGFzcz1cImljb24gaWNvbi1zcGlubmVyIGljb24tc3BpblwiPjwvaT4gPHNwYW4+JyArIF8oJ21hcmtkb3duZWRpdG9yLnVwbG9hZGluZ18nICsgdHlwZSkgKyBmaWxlTmFtZSArICc8L3NwYW4+PC9kaXY+J1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gRXh0LmdldCh1cGxvYWRlcik7XG4gICAgfVxuXG4gICAgLGZhaWxVcGxvYWRlcjogZnVuY3Rpb24odXBsb2FkZXIsIG1lc3NhZ2UpIHtcbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJy5wcm9ncmVzcycpLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICB1cGxvYWRlci5jaGlsZCgnLnByb2dyZXNzJykuc2V0V2lkdGgoJzEwMCUnKTtcblxuICAgICAgICB1cGxvYWRlci5jaGlsZCgnaScpLmFkZENsYXNzKCdyZW1vdmUtbWVzc2FnZScpO1xuICAgICAgICB1cGxvYWRlci5jaGlsZCgnaScpLnJlcGxhY2VDbGFzcygnaWNvbi1zcGlubmVyJywgJ2ljb24tcmVtb3ZlJyk7XG4gICAgICAgIHVwbG9hZGVyLmNoaWxkKCdpJykucmVtb3ZlQ2xhc3MoJ2ljb24tc3BpbicpO1xuXG4gICAgICAgIHVwbG9hZGVyLmNoaWxkKCdzcGFuJykuZG9tLmlubmVySFRNTCArPSAnIGZhaWxlZC4gJyArIG1lc3NhZ2U7XG4gICAgICAgIHVwbG9hZGVyLmNoaWxkKCcucmVtb3ZlLW1lc3NhZ2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHVwbG9hZGVyLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAsZmFpbE1lc3NhZ2U6IGZ1bmN0aW9uKGZpbGUsIHR5cGUsIG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcy5jcmVhdGVVcGxvYWRlcih0eXBlLCBmaWxlLm5hbWUpO1xuICAgICAgICB0aGlzLmZhaWxVcGxvYWRlcih1cGxvYWRlciwgbWVzc2FnZSk7XG4gICAgfVxuXG4gICAgLGlzTW9iaWxlRGV2aWNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93Lm9yaWVudGF0aW9uICE9PSBcInVuZGVmaW5lZFwiKSB8fCAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdJRU1vYmlsZScpICE9PSAtMSk7XG4gICAgfVxufSk7XG5cbk1PRHgubG9hZFJURSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgbmV3IG1hcmtkb3duRWRpdG9yLkVkaXRvcih7XG4gICAgICAgIG1kRWxlbWVudElkOiBpZFxuICAgIH0pO1xufTtcblxuTU9EeC5hZnRlclRWTG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbHMgPSBFeHQucXVlcnkoJ3RleHRhcmVhLm1vZHgtcmljaHRleHQnKTtcblxuICAgIEV4dC5lYWNoKGVscywgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSBFeHQuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmIChtYXJrZG93bkVkaXRvci5sb2FkZWRFbGVtZW50c1tlbGVtZW50LmlkXSkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgbWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHNbZWxlbWVudC5pZF0gPSBuZXcgbWFya2Rvd25FZGl0b3IuRWRpdG9yKHtcbiAgICAgICAgICAgIG1kRWxlbWVudElkOiBlbGVtZW50LmlkXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG5cbn07XG5cbk1PRHgudW5sb2FkVFZSVEUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWxzID0gRXh0LnF1ZXJ5KCcubW9keC1yaWNodGV4dCcpO1xuXG4gICAgRXh0LmVhY2goZWxzLCBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9IEV4dC5nZXQoZWxlbWVudCk7XG4gICAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgaWYgKCFtYXJrZG93bkVkaXRvci5sb2FkZWRFbGVtZW50c1tlbGVtZW50LmlkXSkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgbWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHNbZWxlbWVudC5pZF0uZGVzdHJveSgpO1xuXG4gICAgfSk7XG59OyIsIm1hcmtkb3duRWRpdG9yLmNvbWJvLkNyb3BwZXJQcm9maWxlID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5jcm9wcGVyLnByb2ZpbGVzJ10gfHwgJ1tdJyk7XG5cbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgRXh0LmFwcGx5SWYoY29uZmlnLHtcbiAgICAgICAgc3RvcmU6IG5ldyBFeHQuZGF0YS5Kc29uU3RvcmUoe1xuICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgLGZpZWxkczogWyduYW1lJywgJ3dpZHRoJywgJ2hlaWdodCcsICdyYXRpbyddXG4gICAgICAgIH0pXG4gICAgICAgICxkaXNwbGF5RmllbGQ6ICduYW1lJ1xuICAgICAgICAsbW9kZTogJ2xvY2FsJ1xuICAgICAgICAsdmFsdWVGaWVsZDogJ25hbWUnXG4gICAgICAgICxlZGl0YWJsZTogZmFsc2VcbiAgICAgICAgLHZhbHVlOiBkYXRhWzBdID8gZGF0YVswXS5uYW1lIDogJydcbiAgICB9KTtcblxuICAgIHZhciBzaG93RGVzY3JpcHRpb24gPSBwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuY3JvcHBlci5zaG93X2Rlc2NyaXB0aW9uJ10gfHwgMCk7XG4gICAgaWYgKHNob3dEZXNjcmlwdGlvbikge1xuICAgICAgICBjb25maWcudHBsID0gbmV3IEV4dC5YVGVtcGxhdGUoJzx0cGwgZm9yPVwiLlwiPjxkaXYgY2xhc3M9XCJ4LWNvbWJvLWxpc3QtaXRlbVwiPjxzcGFuIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGRcIj57bmFtZX08L3NwYW4+J1xuICAgICAgICAgICAgLCc8YnIgLz48dHBsIGlmPVwid2lkdGhcIj5XOnt3aWR0aH0gPC90cGw+PHRwbCBpZj1cImhlaWdodFwiPkg6e2hlaWdodH0gPC90cGw+PHRwbCBpZj1cInJhdGlvXCI+Ujp7cmF0aW99PC90cGw+PC9kaXY+PC90cGw+Jyk7XG4gICAgfVxuXG4gICAgbWFya2Rvd25FZGl0b3IuY29tYm8uQ3JvcHBlclByb2ZpbGUuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsY29uZmlnKTtcbn07XG5FeHQuZXh0ZW5kKG1hcmtkb3duRWRpdG9yLmNvbWJvLkNyb3BwZXJQcm9maWxlLE1PRHguY29tYm8uQ29tYm9Cb3gpO1xuRXh0LnJlZygnbWFya2Rvd25lZGl0b3ItY29tYm8tY3JvcHBlci1wcm9maWxlJyxtYXJrZG93bkVkaXRvci5jb21iby5Dcm9wcGVyUHJvZmlsZSk7IiwibWFya2Rvd25FZGl0b3Iud2luZG93LkNyb3BwZXIgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgY29uZmlnLmNyb3BwZXJTZWxlY3RvciA9IGNvbmZpZy5jcm9wcGVyU2VsZWN0b3IgfHwgJy5pbWFnZS11cGxvYWQtd3JhcHBlciA+IGltZyc7XG5cbiAgICB2YXIgaWQgPSBFeHQuaWQoKTtcblxuICAgIEV4dC5hcHBseUlmKGNvbmZpZyx7XG4gICAgICAgIG1vZGFsOiBmYWxzZVxuICAgICAgICAsbGF5b3V0OiAnYXV0bydcbiAgICAgICAgLGNsb3NlQWN0aW9uOiAnaGlkZSdcbiAgICAgICAgLHNoYWRvdzogdHJ1ZVxuICAgICAgICAscmVzaXphYmxlOiB0cnVlXG4gICAgICAgICxjb2xsYXBzaWJsZTogdHJ1ZVxuICAgICAgICAsbWF4aW1pemFibGU6IGZhbHNlXG4gICAgICAgICxhdXRvSGVpZ2h0OiBmYWxzZVxuICAgICAgICAsYXV0b1Njcm9sbDogdHJ1ZVxuICAgICAgICAsYWxsb3dEcm9wOiB0cnVlXG4gICAgICAgICx3aWR0aDogODAwXG4gICAgICAgICxtb2JpbGU6IDBcbiAgICAgICAgLHRpdGxlOiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLmNyb3BfaW1hZ2UnKVxuICAgICAgICAsY2xzOiAnbW9keC13aW5kb3cgbWFya2Rvd25lZGl0b3ItY3JvcHBlci13aW5kb3cnXG4gICAgICAgICxpdGVtczpbe1xuICAgICAgICAgICAgbGF5b3V0OiAnY29sdW1uJ1xuICAgICAgICAgICAgLGJvcmRlcjogZmFsc2VcbiAgICAgICAgICAgICxkZWZhdWx0czoge1xuICAgICAgICAgICAgICAgIGxheW91dDogJ2Zvcm0nXG4gICAgICAgICAgICAgICAgLGxhYmVsQWxpZ246ICd0b3AnXG4gICAgICAgICAgICAgICAgLGxhYmVsU2VwYXJhdG9yOiAnJ1xuICAgICAgICAgICAgICAgICxhbmNob3I6ICcxMDAlJ1xuICAgICAgICAgICAgICAgICxib3JkZXI6IGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsaXRlbXM6IFt7XG4gICAgICAgICAgICAgICAgY29sdW1uV2lkdGg6IDAuMVxuICAgICAgICAgICAgICAgICxkZWZhdWx0czoge1xuICAgICAgICAgICAgICAgICAgICBtc2dUYXJnZXQ6ICd1bmRlcidcbiAgICAgICAgICAgICAgICAgICAgLGFuY2hvcjogJzEwMCUnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICxjbHM6ICdtYXJrZG93bmVkaXRvci10b29sYmFyJ1xuICAgICAgICAgICAgICAgICxpdGVtczogW3tcbiAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdidXR0b24nXG4gICAgICAgICAgICAgICAgICAgICx0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tYXJyb3dzIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAsdG9vbHRpcDogXygnbWFya2Rvd25lZGl0b3IuY3JvcHBlci5tb3ZlJylcbiAgICAgICAgICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbTogJ21vdmUnXG4gICAgICAgICAgICAgICAgICAgICxhY3Rpb246ICdzZXREcmFnTW9kZSdcbiAgICAgICAgICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2FsbENyb3BwZXJBY3Rpb25cbiAgICAgICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdidXR0b24nXG4gICAgICAgICAgICAgICAgICAgICx0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tY3JvcCBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgICAgICAgICAgLHRvb2x0aXA6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuY3JvcCcpXG4gICAgICAgICAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAscGFyYW06ICdjcm9wJ1xuICAgICAgICAgICAgICAgICAgICAsYWN0aW9uOiAnc2V0RHJhZ01vZGUnXG4gICAgICAgICAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICAsdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLXNlYXJjaC1wbHVzIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAsdG9vbHRpcDogXygnbWFya2Rvd25lZGl0b3IuY3JvcHBlci56b29tX2luJylcbiAgICAgICAgICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbTogMC4xXG4gICAgICAgICAgICAgICAgICAgICxhY3Rpb246ICd6b29tJ1xuICAgICAgICAgICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgICAgICB4dHlwZTogJ2J1dHRvbidcbiAgICAgICAgICAgICAgICAgICAgLHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1zZWFyY2gtbWludXMgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICAgICAgICAgICx0b29sdGlwOiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnpvb21fb3V0JylcbiAgICAgICAgICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbTogLTAuMVxuICAgICAgICAgICAgICAgICAgICAsYWN0aW9uOiAnem9vbSdcbiAgICAgICAgICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2FsbENyb3BwZXJBY3Rpb25cbiAgICAgICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdidXR0b24nXG4gICAgICAgICAgICAgICAgICAgICx0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tcm90YXRlLWxlZnQgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICAgICAgICAgICx0b29sdGlwOiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnJvdGF0ZV9sZWZ0JylcbiAgICAgICAgICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbTogLTkwXG4gICAgICAgICAgICAgICAgICAgICxhY3Rpb246ICdyb3RhdGUnXG4gICAgICAgICAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICAsdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLXJvdGF0ZS1yaWdodCBpY29uLWxhcmdlXCI+PC9pPidcbiAgICAgICAgICAgICAgICAgICAgLHRvb2x0aXA6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIucm90YXRlX3JpZ2h0JylcbiAgICAgICAgICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbTogOTBcbiAgICAgICAgICAgICAgICAgICAgLGFjdGlvbjogJ3JvdGF0ZSdcbiAgICAgICAgICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2FsbENyb3BwZXJBY3Rpb25cbiAgICAgICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICAgICAgeHR5cGU6ICdidXR0b24nXG4gICAgICAgICAgICAgICAgICAgICx0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tcmVtb3ZlIGljb24tbGFyZ2VcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAsdG9vbHRpcDogXygnbWFya2Rvd25lZGl0b3IuY3JvcHBlci5jbGVhcl9jcm9wcGVyJylcbiAgICAgICAgICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbTogbnVsbFxuICAgICAgICAgICAgICAgICAgICAsYWN0aW9uOiAnY2xlYXInXG4gICAgICAgICAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGNvbHVtbldpZHRoOiAwLjlcbiAgICAgICAgICAgICAgICAsZGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgbXNnVGFyZ2V0OiAndW5kZXInXG4gICAgICAgICAgICAgICAgICAgICxhbmNob3I6ICcxMDAlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAsY2xzOiAnbWFya2Rvd25lZGl0b3ItY3JvcHBlcidcbiAgICAgICAgICAgICAgICAsaXRlbXM6IFt7XG4gICAgICAgICAgICAgICAgICAgIGh0bWw6ICc8ZGl2IGNsYXNzPVwiaW1hZ2UtdXBsb2FkLXdyYXBwZXJcIj48aW1nIHNyYz1cIicgKyBVUkwuY3JlYXRlT2JqZWN0VVJMKGNvbmZpZy5maWxlKSArICdcIj48L2Rpdj4nXG4gICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH1dXG4gICAgICAgICxiYmFyOiBbe1xuICAgICAgICAgICAgeHR5cGU6ICdtYXJrZG93bmVkaXRvci1jb21iby1jcm9wcGVyLXByb2ZpbGUnXG4gICAgICAgICAgICAsaWQ6IGlkICsgJy1jcm9wcGVyLXByb2ZpbGUnXG4gICAgICAgICAgICAsbGlzdGVuZXJzOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbihjb21ibywgdmFsdWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VDcm9wcGVyUHJvZmlsZSh2YWx1ZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sJy0+Jyx7XG4gICAgICAgICAgICB0ZXh0OiBfKCdjYW5jZWwnKVxuICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jbG9zZVxuICAgICAgICB9LHtcbiAgICAgICAgICAgIHRleHQ6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIudXBsb2FkJylcbiAgICAgICAgICAgICxjbHM6ICdwcmltYXJ5LWJ1dHRvbidcbiAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgLGNyb3A6IDBcbiAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLnVwbG9hZFxuICAgICAgICB9LHtcbiAgICAgICAgICAgIHRleHQ6IF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuY3JvcF91cGxvYWQnKVxuICAgICAgICAgICAgLGNsczogJ3ByaW1hcnktYnV0dG9uJ1xuICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAsY3JvcDogMVxuICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMudXBsb2FkXG4gICAgICAgIH1dXG4gICAgICAgICxsaXN0ZW5lcnM6IHtcbiAgICAgICAgICAgICdzaG93Jzoge1xuICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNyb3BwZXJPcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNyb3BwZXJFbCA9ICQoJyMnICsgdGhpcy5pZCArICcgJyArIGNvbmZpZy5jcm9wcGVyU2VsZWN0b3IpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNyb3BwZXJPcHRpb25zLmNyb3AgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZURhdGEgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3tcInhcIjonICsgZGF0YS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcInlcIjonICsgZGF0YS55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcImhlaWdodFwiOicgKyBkYXRhLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXCJ3aWR0aFwiOicgKyBkYXRhLndpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcInJvdGF0ZVwiOicgKyBkYXRhLnJvdGF0ZSArICd9J1xuICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjcm9wcGVyRWwuY3JvcHBlcihjcm9wcGVyT3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb2ZpbGUgPSBFeHQuZ2V0Q21wKGlkICsgJy1jcm9wcGVyLXByb2ZpbGUnKS5zdG9yZS5nZXRBdCgwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VDcm9wcGVyUHJvZmlsZShwcm9maWxlLmRhdGEpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2NvcGU6IHRoaXNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIG1hcmtkb3duRWRpdG9yLndpbmRvdy5Dcm9wcGVyLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLGNvbmZpZyk7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG5cbn07XG5FeHQuZXh0ZW5kKG1hcmtkb3duRWRpdG9yLndpbmRvdy5Dcm9wcGVyLCBFeHQuV2luZG93LHtcbiAgICBpbWFnZURhdGE6ICcnXG4gICAgLGNyb3BwZXJQcm9maWxlOiB7bmFtZTogJyd9XG5cbiAgICAsY2hhbmdlQ3JvcHBlclByb2ZpbGU6IGZ1bmN0aW9uKHByb2ZpbGUpe1xuICAgICAgICB2YXIgcmF0aW87XG5cbiAgICAgICAgaWYgKHByb2ZpbGUucmF0aW8gIT0gXCJcIikge1xuICAgICAgICAgICAgcmF0aW8gPSBwcm9maWxlLnJhdGlvO1xuICAgICAgICAgICAgcmF0aW8ucmVwbGFjZSgvW14tOngoKVxcZC8qKy5dL2csICcnKTtcbiAgICAgICAgICAgIHJhdGlvID0gZXZhbChyYXRpbykgfHwgTmFOO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHByb2ZpbGUud2lkdGggJiYgcHJvZmlsZS5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBwYXJzZUludChwcm9maWxlLndpZHRoKTtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gcGFyc2VJbnQocHJvZmlsZS5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIGlmICh3aWR0aCA+IDAgJiYgaGVpZ2h0ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByYXRpbyA9IHdpZHRoIC8gaGVpZ2h0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJhdGlvID0gTmFOO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmF0aW8gPSBOYU47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNyb3BwZXJQcm9maWxlID0gcHJvZmlsZTtcblxuICAgICAgICB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uKHthY3Rpb246ICdzZXRBc3BlY3RSYXRpbycsIHBhcmFtOiByYXRpb30pO1xuICAgIH1cblxuICAgICx1cGxvYWQ6IGZ1bmN0aW9uKGJ1dHRvbikge1xuICAgICAgICB2YXIgdXBsb2FkZXIgPSB0aGlzLmNvbmZpZy5tZC5jcmVhdGVVcGxvYWRlcignaW1hZ2UnLCB0aGlzLmNvbmZpZy5maWxlLm5hbWUpO1xuXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB0aGlzLmNvbmZpZy5maWxlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdhY3Rpb24nLCAnbWdyL2VkaXRvci9pbWFnZXVwbG9hZCcpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ltYWdlRGF0YScsIHRoaXMuaW1hZ2VEYXRhKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1lJywgdGhpcy5jb25maWcuZmlsZS5uYW1lKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdjcm9wJywgYnV0dG9uLmNyb3ApO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Jlc291cmNlJywgdGhpcy5jb25maWcubWQuY29uZmlnLnJlc291cmNlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtb2JpbGUnLCB0aGlzLmNvbmZpZy5tb2JpbGUpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Byb2ZpbGUnLCB0aGlzLmNyb3BwZXJQcm9maWxlLm5hbWUpO1xuXG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9wZW4oJ1BPU1QnLCBtYXJrZG93bkVkaXRvci5jb25maWcuY29ubmVjdG9yVXJsKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1Bvd2VyZWQtQnknLCAnTU9EeCcpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignbW9kQXV0aCcsIEV4dC5BamF4LmRlZmF1bHRIZWFkZXJzLm1vZEF1dGgpO1xuXG4gICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50Lmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGUgPSAoZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDAgfCAwKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlci5jaGlsZCgnLnByb2dyZXNzJykuc2V0V2lkdGgoY29tcGxldGUgKyAnJScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcblxuICAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5tZC5lZGl0b3IuaW5zZXJ0KCchWycgKyByZXMub2JqZWN0Lm5hbWUgKyAnXSgnICsgcmVzLm9iamVjdC5wYXRoICsgJyBcIicgKyByZXMub2JqZWN0Lm5hbWUgKyAnXCIpXFxuXFxuJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWQuZmFpbFVwbG9hZGVyKHVwbG9hZGVyLCByZXMubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgeGhyLnNlbmQoZm9ybURhdGEpO1xuXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG5cbiAgICAsY2FsbENyb3BwZXJBY3Rpb246IGZ1bmN0aW9uKGJ0bikge1xuICAgICAgICB0aGlzLiRjcm9wcGVyRWwuY3JvcHBlcihidG4uYWN0aW9uLCBidG4ucGFyYW0pO1xuICAgIH1cblxuICAgICxjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuJGNyb3BwZXJFbC5jcm9wcGVyKFwiZGVzdHJveVwiKTtcblxuICAgICAgICBtYXJrZG93bkVkaXRvci53aW5kb3cuQ3JvcHBlci5zdXBlcmNsYXNzLmNsb3NlLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuY29uZmlnLm1kLmVkaXRvci5mb2N1cygpO1xuICAgIH1cbn0pO1xuRXh0LnJlZygnbWFya2Rvd25lZGl0b3Itd2luZG93LWNyb3BwZXInLG1hcmtkb3duRWRpdG9yLndpbmRvdy5Dcm9wcGVyKTtcbiIsIm1hcmtkb3duRWRpdG9yLndpbmRvdy5PRW1iZWQgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgRXh0LmFwcGx5SWYoY29uZmlnLHtcbiAgICAgICAgdGl0bGU6IF8oJ21hcmtkb3duZWRpdG9yLm9lbWJlZC5lbWJlZF91cmwnKVxuICAgICAgICAsY2xvc2VBY3Rpb246ICdjbG9zZSdcbiAgICAgICAgLHJlc2l6YWJsZTogZmFsc2VcbiAgICAgICAgLGNvbGxhcHNpYmxlOiBmYWxzZVxuICAgICAgICAsbWF4aW1pemFibGU6IGZhbHNlXG4gICAgICAgICxoZWlnaHQ6IDE4NVxuICAgICAgICAsbW9kYWw6IHRydWVcbiAgICAgICAgLGZpZWxkczogdGhpcy5nZXRGaWVsZHMoY29uZmlnKVxuICAgIH0pO1xuICAgIG1hcmtkb3duRWRpdG9yLndpbmRvdy5PRW1iZWQuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsY29uZmlnKTtcbn07XG5FeHQuZXh0ZW5kKG1hcmtkb3duRWRpdG9yLndpbmRvdy5PRW1iZWQsTU9EeC5XaW5kb3csIHtcbiAgICBnZXRGaWVsZHM6IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgIHh0eXBlOiAndGV4dGZpZWxkJ1xuICAgICAgICAgICAgLG5hbWU6ICd1cmwnXG4gICAgICAgICAgICAsZmllbGRMYWJlbDogXygnbWFya2Rvd25lZGl0b3Iub2VtYmVkLnVybCcpXG4gICAgICAgICAgICAsYWxsb3dCbGFuazogZmFsc2VcbiAgICAgICAgICAgICxhbmNob3I6ICcxMDAlJ1xuICAgICAgICAgICAgLHZ0eXBlOiAndXJsJ1xuICAgICAgICB9XTtcbiAgICB9XG5cbiAgICAsc3VibWl0OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgZiA9IHRoaXMuZnAuZ2V0Rm9ybSgpO1xuXG4gICAgICAgIGlmIChmLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBFeHQuY2FsbGJhY2sodGhpcy5jb25maWcuc3VjY2Vzcyx0aGlzLmNvbmZpZy5zY29wZSB8fCB0aGlzLFtmLmdldFZhbHVlcygpXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuRXh0LnJlZygnbWFya2Rvd25lZGl0b3Itd2luZG93LW9lbWJlZCcsbWFya2Rvd25FZGl0b3Iud2luZG93Lk9FbWJlZCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9