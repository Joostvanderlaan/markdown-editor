Ext.ns("MarkdownEditor"),MarkdownEditor=function(e){e=e||{},MarkdownEditor.superclass.constructor.call(this,e)},Ext.extend(MarkdownEditor,Ext.Component,{window:{},config:{}}),Ext.reg("markdowneditor",MarkdownEditor),markdownEditor=new MarkdownEditor,markdownEditor.loadedElements={},markdownEditor.Editor=function(e){e=e||{},e.resource=MODx.request.id||0,markdownEditor.Editor.superclass.constructor.call(this,e),this.config=e},Ext.extend(markdownEditor.Editor,Ext.Component,{remarkable:"",fullScreen:!1,initComponent:function(){MarkdownEditor.superclass.initComponent.call(this),this.mdElementId&&Ext.onReady(this.render,this)},destroy:function(){this.editor.destroy(),this.mdContainer.remove(),this.taMarkdown.remove(),this.textarea.dom.style.display=null,this.textarea.dom.style.width=null,this.textarea.dom.style.height=null,MarkdownEditor.superclass.destroy.call(this)},render:function(){if(this.textarea=Ext.get(this.mdElementId),this.mdElementName=this.textarea.dom.name,this.textarea){this.buildUI(),this.registerAce(),this.registerMarked(),this.buildToolbox();var e=this.toolBox.child(".preview-button"),t=this.toolBox.child(".fullscreen-button"),i=this.toolBox.child(".splitscreen-button"),o=this.contentMD,r=Ext.get(Ext.DomHelper.append(o.parent(),{tag:"div","class":"preview-button-off",html:'<i class="icon icon-eye-slash icon-large"></i>',hidden:!0})),n=MODx.load({xtype:"modx-treedrop",target:o,targetEl:o,onInsert:function(e){return this.insert(e),this.focus(),!0}.bind(this.editor),iframe:!0});this.textarea.on("destroy",function(){n.destroy()});var s=parseInt(MODx.config["markdowneditor.general.split"]||0);1==s&&i.turnOn(),e.addListener("click",function(){this.showPreview(),this.hideContent(),this.statusBar.setDisplayed("none"),this.contentMD.parent().parent().addClass("preview"),r.show()},this),r.addListener("click",function(){this.hidePreview(),this.showContent(),this.statusBar.setDisplayed("block"),this.contentMD.parent().parent().removeClass("preview"),this.editor.focus(),r.hide()},this),i.addListener("click",function(){i.child("i").hasClass("icon-pause")?i.turnOn():i.turnOff()},this),t.addListener("click",function(){0==this.fullScreen?t.turnOn():t.turnOff(),this.statusBar.setDisplayed("block"),this.editor.resize(!0)},this),markdownEditor.content[this.mdElementName]&&this.editor.setValue(markdownEditor.content[this.mdElementName]),this.editor.selection.clearSelection(),this.preview.update(this.parse(this.editor.getValue())),this.preview.fixHeight(),window.editor=this.editor,this.editor.getSession().on("change",function(e){if("insertText"==e.data.action&&this.editor.getSession().getDocument().isNewLine(e.data.text)){var t=this.editor.getSession(),i=t.getDocument();null!=/^\s*(?:[*+-]|\d+\.)\s*$/.exec(i.getLine(e.data.range.start.row))&&(i.removeLines(e.data.range.start.row,e.data.range.start.row),this.editor.insert(i.getNewLineCharacter()))}this.parse(this.editor.getValue())}.bind(this))}},showContent:function(){this.contentMD.setDisplayed("block")},hideContent:function(){this.contentMD.setDisplayed("none")},showPreview:function(){this.preview.setDisplayed("block")},hidePreview:function(){this.preview.setDisplayed("none")},buildUI:function(){this.textarea.setDisplayed("none"),this.textarea.setWidth(0),this.textarea.setHeight(0),this.taMarkdown=Ext.get(Ext.DomHelper.insertBefore(this.textarea,{tag:"textarea",name:this.mdElementName+"_markdown","class":this.mdElementName+"_markdown"})),this.taMarkdown.setDisplayed("none"),this.taMarkdown.setWidth(0),this.taMarkdown.setHeight(0),this.mdContainer=Ext.get(Ext.DomHelper.insertBefore(this.textarea,{tag:"div","class":"markdown-container"}));var e=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"markdown-wrapper"}));this.contentMD=Ext.get(Ext.DomHelper.append(e,{tag:"div","class":this.textarea.dom.className+" content-md "+this.mdElementName+"_markdown"})),this.preview=Ext.get(Ext.DomHelper.append(e,{tag:"div","class":"markdown-body preview-md"}));var t=this;this.preview.fixHeight=function(){var e=t.editor.getSession().getDocument().getLength()*t.editor.renderer.lineHeight+t.editor.renderer.scrollBar.getWidth()+32;this.setHeight(e)},1==MODx.config["markdowneditor.upload.enable_image_upload"]||1==MODx.config["markdowneditor.upload.enable_file_upload"]?(this.statusBar=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"status-bar"})),this.isMobileDevice()?(this.statusBar.dom.innerHTML='<div class="upload-bar"> <input class="hidden" name="md_file_'+this.statusBar.id+'" id="'+this.statusBar.id+'-file" type="file" multiple /><input class="hidden" name="md_file_'+this.statusBar.id+'-mobile" id="'+this.statusBar.id+'-file-mobile" type="file" accept="image/*" capture="camera" />'+_("markdowneditor.status_bar_message_mobile",{id:this.statusBar.id+"-file",id_mobile:this.statusBar.id+"-file-mobile"})+"</div>",this.statusBar.child("#"+this.statusBar.id+"-file-mobile").on("change",function(e,t){this.handleFiles(t.files,1),t.value=""},this)):(this.statusBar.dom.innerHTML='<div class="upload-bar"> <input class="hidden" name="md_file_'+this.statusBar.id+'" id="'+this.statusBar.id+'-file" type="file" multiple>'+_("markdowneditor.status_bar_message",{id:this.statusBar.id+"-file"})+"</div>",this.statusBar.child("#"+this.statusBar.id+"-file").on("change",function(e,t){this.handleFiles(t.files),t.value=""},this))):this.statusBar=Ext.get(Ext.DomHelper.append(this.mdContainer.dom,{tag:"div","class":"status-bar",html:_("markdowneditor.status_bar_disabled")})),Ext.DomHelper.append(this.mdContainer.dom,{tag:"span",style:"clear: both"})},buildToolbox:function(){this.toolBox=Ext.get(Ext.DomHelper.append(this.contentMD,{tag:"div","class":"toolbox",cn:[{tag:"div","class":"preview-button",html:'<i class="icon icon-eye icon-large"></i>'},{tag:"div","class":"splitscreen-button",html:'<i class="icon icon-pause icon-large"></i>'},{tag:"div","class":"fullscreen-button",html:'<i class="icon icon-expand icon-large"></i>'}]}));var e=this;this.toolBox.child(".splitscreen-button").turnOn=function(){this.child("i").removeClass("icon-pause"),this.child("i").addClass("icon-stop"),e.contentMD.parent().parent().addClass("split")},this.toolBox.child(".splitscreen-button").turnOff=function(){this.child("i").addClass("icon-pause"),this.child("i").removeClass("icon-stop"),e.contentMD.parent().parent().removeClass("split")},this.toolBox.child(".fullscreen-button").turnOn=function(){this.child("i").removeClass("icon-expand"),this.child("i").addClass("icon-compress"),e.fullScreen=!0,1==parseInt(MODx.config["markdowneditor.general.split_fullscreen"]||1)?e.toolBox.child(".splitscreen-button").turnOn():e.toolBox.child(".splitscreen-button").turnOff(),e.showPreview(),e.showContent(),e.editor.focus(),e.contentMD.parent().parent().addClass("fullscreen"),e.editor.setOption("maxLines",null)},this.toolBox.child(".fullscreen-button").turnOff=function(){this.child("i").addClass("icon-expand"),this.child("i").removeClass("icon-compress"),e.fullScreen=!1,1==parseInt(MODx.config["markdowneditor.general.split"]||0)?e.toolBox.child(".splitscreen-button").turnOn():e.toolBox.child(".splitscreen-button").turnOff(),e.hidePreview(),e.showContent(),e.editor.focus(),e.contentMD.parent().parent().removeClass("fullscreen"),e.editor.setOption("maxLines",1/0),e.preview.fixHeight()}},registerAce:function(){this.editor=ace.edit(Ext.DomQuery.selectNode("div."+this.mdElementName+"_markdown")),this.editor.setOptions({maxLines:1/0,minLines:25,enableBasicAutocompletion:!0,printMargin:!1,showGutter:1==parseInt(MODx.config["markdowneditor.general.show_gutter"]||1),fontSize:parseInt(MODx.config["markdowneditor.general.font_size"])||12,fontFamily:MODx.config["markdowneditor.general.font_family"]||""}),this.editor.getSession().setUseWrapMode(!0),this.editor.getSession().setWrapLimitRange(),this.editor.renderer.setScrollMargin(10,10),this.editor.getSession().setValue(this.textarea.getValue()),this.editor.getSession().setMode("ace/mode/markdowneditor"),this.editor.setTheme("ace/theme/"+(MODx.config["markdowneditor.general.theme"]||"monokai")),this.editor.commands.addCommand({name:"test",bindKey:{win:"Tab",mac:"Tab"},exec:function(e){var t=e.session.getLine(e.getCursorPosition().row),i=/^(\s*)(?:([-+*])|(\d+)\.)(\s+)/.exec(t);i?e.session.indentRows(e.getCursorPosition().row,e.getCursorPosition().row,"	"):e.indent()}});var e=ace.require("ace/ext/language_tools"),t={getCompletions:function(e,t,i,o,r){return 0===o.length?(r(null,[]),void 0):(MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/resource/getlist",prefix:o},listeners:{success:{fn:function(e){r(null,e.results)},scope:this}}}),void 0)}};e.addCompleter(t),this.editor.container.addEventListener("dragenter",this.catchAndDoNothing,!1),this.editor.container.addEventListener("dragover",this.catchAndDoNothing,!1),this.editor.container.addEventListener("drop",this.drop.bind(this),!1)},registerMarked:function(){this.remarkable=new Remarkable({html:!0,highlight:function(e,t){var i="";if(t&&hljs.getLanguage(t))try{return i=hljs.highlight(t,e).value,i=i.replace(/\[\[/g,"&#91;&#91;"),i=i.replace(/]]/g,"&#93;&#93;")}catch(o){}try{return i=hljs.highlightAuto(e).value,i=i.replace(/\[\[/g,"&#91;&#91;"),i=i.replace(/]]/g,"&#93;&#93;")}catch(o){}return""}}),this.remarkable.inline.ruler.disable(["backticks"])},parse:function(e){var t=this.remarkable.render(e);if(t=t.replace(/%5B/g,"["),t=t.replace(/%5D/g,"]"),1==MODx.config["markdowneditor.lp.parse_modx_tags"]){this.parseRequest&&clearTimeout(this.parseRequest);var i=parseInt(MODx.config["markdowneditor.lp.parse_modx_tags_timeout"]||300);this.parseRequest=setTimeout(function(){MODx.Ajax.request({url:markdownEditor.config.connectorUrl,params:{action:"mgr/editor/processcontent",content:t,resource:MODx.request.id},isUpload:!0,listeners:{success:{fn:function(e){this.preview.update(e.data),this.editor.getCursorPosition().row+2>=this.editor.getSession().getScreenLength()&&(this.preview.dom.scrollTop=this.preview.dom.scrollHeight),this.preview.fixHeight()},scope:this}}})}.bind(this),i)}else this.preview.update(t),this.editor.getCursorPosition().row+2>=this.editor.getSession().getScreenLength()&&(this.preview.dom.scrollTop=this.preview.dom.scrollHeight),this.preview.fixHeight();return this.taMarkdown.dom.value=this.editor.getValue(),this.textarea.dom.value=t,t},catchAndDoNothing:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault(),(1==MODx.config["markdowneditor.upload.enable_image_upload"]||1==MODx.config["markdowneditor.upload.enable_file_upload"])&&this.handleFiles(e.dataTransfer.files)},handleFiles:function(e,t){t=t||0,Ext.each(e,function(e){var i=/^image\//.test(e.type);if(i){if(0==MODx.config["markdowneditor.upload.enable_image_upload"])return!0;if(!this.checkType(MODx.config["markdowneditor.upload.image_types"],e))return this.failMessage(e,"image",_("markdowneditor.err.upload.unsupported_image")),!0;if(e.size>parseInt(MODx.config["markdowneditor.upload.max_size"]))return this.failMessage(e,"image",_("markdowneditor.err.upload.too_big")),!0;1==MODx.config["markdowneditor.cropper.enable_cropper"]?MODx.load({xtype:"markdowneditor-window-cropper",file:e,md:this,mobile:t}).show():(this.uploadFile(e,"image",t),this.editor.focus())}else{if(0==MODx.config["markdowneditor.upload.enable_file_upload"])return!0;if(!this.checkType(MODx.config["markdowneditor.upload.file_types"],e))return this.failMessage(e,"file",_("markdowneditor.err.upload.unsupported_file")),!0;if(e.size>parseInt(MODx.config["markdowneditor.upload.max_size"]))return this.failMessage(e,"file",_("markdowneditor.err.upload.too_big")),!0;this.uploadFile(e,"file"),this.editor.focus()}},this)},checkType:function(e,t){return e=e.split(","),-1!=e.indexOf(t.name.split(".").pop())},uploadFile:function(e,t,i){t=t||"file",i=i||0;var o=this.createUploader(),r=new FormData;r.append("file",e),r.append("action","mgr/editor/"+t+"upload"),r.append("name",e.name),r.append("resource",this.config.resource),r.append("mobile",i);var n=new XMLHttpRequest;n.open("POST",markdownEditor.config.connectorUrl),n.setRequestHeader("Powered-By","MODx"),n.setRequestHeader("modAuth",Ext.Ajax.defaultHeaders.modAuth),n.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;o.child(".progress").setWidth(t+"%")}}.bind(this),n.onload=function(){if(200===n.status){var e=JSON.parse(n.responseText);if(1==e.success){o.remove();var i="image"==t?"!":"",r="image"==t?"\n\n":"\n";this.editor.insert(i+"["+e.object.name+"]("+e.object.path+' "'+e.object.name+'")'+r)}else this.failUploader(o,e.message)}}.bind(this),n.send(r)},createUploader:function(e,t){var i=Ext.DomHelper.insertFirst(this.statusBar,{tag:"div",html:'<div class="progress"><i class="icon icon-spinner icon-spin"></i> <span>'+_("markdowneditor.uploading_"+e)+t+"</span></div>"});return Ext.get(i)},failUploader:function(e,t){e.child(".progress").addClass("error"),e.child(".progress").setWidth("100%"),e.child("i").addClass("remove-message"),e.child("i").replaceClass("icon-spinner","icon-remove"),e.child("i").removeClass("icon-spin"),e.child("span").dom.innerHTML+=" failed. "+t,e.child(".remove-message").on("click",function(){e.remove()})},failMessage:function(e,t,i){var o=this.createUploader(t,e.name);this.failUploader(o,i)},isMobileDevice:function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}}),MODx.loadRTE=function(e){new markdownEditor.Editor({mdElementId:e})},MODx.afterTVLoad=function(){var e=Ext.query("textarea.modx-richtext");Ext.each(e,function(e){return(e=Ext.get(e))?markdownEditor.loadedElements[e.id]?!0:(markdownEditor.loadedElements[e.id]=new markdownEditor.Editor({mdElementId:e.id}),void 0):!0})},MODx.unloadTVRTE=function(){var e=Ext.query(".modx-richtext");Ext.each(e,function(e){return(e=Ext.get(e))?markdownEditor.loadedElements[e.id]?(markdownEditor.loadedElements[e.id].destroy(),void 0):!0:!0})},markdownEditor.window.Cropper=function(config){config=config||{},config.cropperSelector=config.cropperSelector||".image-upload-wrapper > img",Ext.applyIf(config,{modal:!1,layout:"auto",closeAction:"hide",shadow:!0,resizable:!0,collapsible:!0,maximizable:!1,autoHeight:!1,autoScroll:!0,allowDrop:!0,width:800,mobile:0,title:_("markdowneditor.cropper.crop_image"),cls:"modx-window",html:'<div class="image-upload-wrapper"><img src="'+URL.createObjectURL(config.file)+'"></div>',tbar:[{text:'<i class="icon icon-arrows"></i> '+_("markdowneditor.cropper.move"),scope:this,param:"move",action:"setDragMode",handler:this.callCropperAction},{text:'<i class="icon icon-crop"></i> '+_("markdowneditor.cropper.crop"),scope:this,param:"crop",action:"setDragMode",handler:this.callCropperAction},{text:'<i class="icon icon-search-plus"></i> '+_("markdowneditor.cropper.zoom_in"),scope:this,param:.1,action:"zoom",handler:this.callCropperAction},{text:'<i class="icon icon-search-minus"></i> '+_("markdowneditor.cropper.zoom_out"),scope:this,param:-.1,action:"zoom",handler:this.callCropperAction},{text:'<i class="icon icon-rotate-left"></i> '+_("markdowneditor.cropper.rotate_left"),scope:this,param:-90,action:"rotate",handler:this.callCropperAction},{text:'<i class="icon icon-rotate-right"></i> '+_("markdowneditor.cropper.rotate_right"),scope:this,param:90,action:"rotate",handler:this.callCropperAction},{text:'<i class="icon icon-remove"></i> '+_("markdowneditor.cropper.clear_cropper"),scope:this,param:null,action:"clear",handler:this.callCropperAction}],buttons:[{text:_("cancel"),scope:this,handler:this.close},{text:_("markdowneditor.cropper.upload"),cls:"primary-button",scope:this,crop:0,handler:this.upload},{text:_("markdowneditor.cropper.crop_upload"),cls:"primary-button",scope:this,crop:1,handler:this.upload}],listeners:{show:{fn:function(){var cropperOptions={};this.$cropperEl=$("#"+this.id+" "+config.cropperSelector);var ratio=MODx.config["markdowneditor.cropper.aspect_ratio"];ratio&&(ratio.replace(/[^-:x()\d/*+.]/g,""),ratio=eval(ratio),cropperOptions.aspectRatio=ratio),cropperOptions.crop=function(e){this.imageData=['{"x":'+e.x,'"y":'+e.y,'"height":'+e.height,'"width":'+e.width,'"rotate":'+e.rotate+"}"].join()}.bind(this),this.$cropperEl.cropper(cropperOptions)},scope:this}}}),markdownEditor.window.Cropper.superclass.constructor.call(this,config),this.config=config},Ext.extend(markdownEditor.window.Cropper,Ext.Window,{imageData:"",upload:function(e){var t=this.config.md.createUploader("image",this.config.file.name),i=new FormData;i.append("file",this.config.file),i.append("action","mgr/editor/imageupload"),i.append("imageData",this.imageData),i.append("name",this.config.file.name),i.append("crop",e.crop),i.append("resource",this.config.md.config.resource),i.append("mobile",this.config.mobile);var o=new XMLHttpRequest;o.open("POST",markdownEditor.config.connectorUrl),o.setRequestHeader("Powered-By","MODx"),o.setRequestHeader("modAuth",Ext.Ajax.defaultHeaders.modAuth),o.upload.onprogress=function(e){if(e.lengthComputable){var i=e.loaded/e.total*100|0;t.child(".progress").setWidth(i+"%")}}.bind(this),o.onload=function(){if(200===o.status){var e=JSON.parse(o.responseText);1==e.success?(t.remove(),this.config.md.editor.insert("!["+e.object.name+"]("+e.object.path+' "'+e.object.name+'")\n\n')):this.config.md.failUploader(t,e.message)}}.bind(this),o.send(i),this.close()},callCropperAction:function(e){this.$cropperEl.cropper(e.action,e.param)},close:function(){this.$cropperEl.cropper("destroy"),markdownEditor.window.Cropper.superclass.close.call(this),this.config.md.editor.focus()}}),Ext.reg("markdowneditor-window-cropper",markdownEditor.window.Cropper);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1hcmtkb3duZWRpdG9yLndpbmRvdy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLEdBQUEsa0JBQ0EsZUFBQSxTQUFBLEdBQ0EsRUFBQSxNQUNBLGVBQUEsV0FBQSxZQUFBLEtBQUEsS0FBQSxJQUVBLElBQUEsT0FBQSxlQUFBLElBQUEsV0FDQSxVQUFBLFlBRUEsSUFBQSxJQUFBLGlCQUFBLGdCQUNBLGVBQUEsR0FBQSxnQkFFQSxlQUFBLGtCQUVBLGVBQUEsT0FBQSxTQUFBLEdBQ0EsRUFBQSxNQUNBLEVBQUEsU0FBQSxLQUFBLFFBQUEsSUFBQSxFQUNBLGVBQUEsT0FBQSxXQUFBLFlBQUEsS0FBQSxLQUFBLEdBQ0EsS0FBQSxPQUFBLEdBRUEsSUFBQSxPQUFBLGVBQUEsT0FBQSxJQUFBLFdBQ0EsV0FBQSxHQUNBLFlBQUEsRUFDQSxjQUFBLFdBQ0EsZUFBQSxXQUFBLGNBQUEsS0FBQSxNQUVBLEtBQUEsYUFDQSxJQUFBLFFBQUEsS0FBQSxPQUFBLE9BSUEsUUFBQSxXQUNBLEtBQUEsT0FBQSxVQUVBLEtBQUEsWUFBQSxTQUNBLEtBQUEsV0FBQSxTQUVBLEtBQUEsU0FBQSxJQUFBLE1BQUEsUUFBQSxLQUNBLEtBQUEsU0FBQSxJQUFBLE1BQUEsTUFBQSxLQUNBLEtBQUEsU0FBQSxJQUFBLE1BQUEsT0FBQSxLQUVBLGVBQUEsV0FBQSxRQUFBLEtBQUEsT0FHQSxPQUFBLFdBSUEsR0FIQSxLQUFBLFNBQUEsSUFBQSxJQUFBLEtBQUEsYUFDQSxLQUFBLGNBQUEsS0FBQSxTQUFBLElBQUEsS0FFQSxLQUFBLFNBQUEsQ0FFQSxLQUFBLFVBQ0EsS0FBQSxjQUNBLEtBQUEsaUJBQ0EsS0FBQSxjQUVBLElBQUEsR0FBQSxLQUFBLFFBQUEsTUFBQSxtQkFDQSxFQUFBLEtBQUEsUUFBQSxNQUFBLHNCQUNBLEVBQUEsS0FBQSxRQUFBLE1BQUEsdUJBRUEsRUFBQSxLQUFBLFVBRUEsRUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsRUFBQSxVQUNBLElBQUEsTUFDQSxRQUFBLHFCQUNBLEtBQUEsaURBQ0EsUUFBQSxLQUdBLEVBQUEsS0FBQSxNQUNBLE1BQUEsZ0JBQ0EsT0FBQSxFQUNBLFNBQUEsRUFDQSxTQUFBLFNBQUEsR0FHQSxNQUZBLE1BQUEsT0FBQSxHQUNBLEtBQUEsU0FDQSxHQUNBLEtBQUEsS0FBQSxRQUNBLFFBQUEsR0FFQSxNQUFBLFNBQUEsR0FBQSxVQUFBLFdBQUEsRUFBQSxXQUVBLElBQUEsR0FBQSxTQUFBLEtBQUEsT0FBQSxpQ0FBQSxFQUNBLElBQUEsR0FDQSxFQUFBLFNBRUEsRUFBQSxZQUFBLFFBQUEsV0FDQSxLQUFBLGNBQ0EsS0FBQSxjQUNBLEtBQUEsVUFBQSxhQUFBLFFBRUEsS0FBQSxVQUFBLFNBQUEsU0FBQSxTQUFBLFdBRUEsRUFBQSxRQUNBLE1BRUEsRUFBQSxZQUFBLFFBQUEsV0FDQSxLQUFBLGNBQ0EsS0FBQSxjQUNBLEtBQUEsVUFBQSxhQUFBLFNBRUEsS0FBQSxVQUFBLFNBQUEsU0FBQSxZQUFBLFdBRUEsS0FBQSxPQUFBLFFBRUEsRUFBQSxRQUNBLE1BRUEsRUFBQSxZQUFBLFFBQUEsV0FDQSxFQUFBLE1BQUEsS0FBQSxTQUFBLGNBQ0EsRUFBQSxTQUVBLEVBQUEsV0FFQSxNQUVBLEVBQUEsWUFBQSxRQUFBLFdBQ0EsR0FBQSxLQUFBLFdBQ0EsRUFBQSxTQUVBLEVBQUEsVUFHQSxLQUFBLFVBQUEsYUFBQSxTQUNBLEtBQUEsT0FBQSxRQUFBLElBRUEsTUFFQSxlQUFBLFFBQUEsS0FBQSxnQkFDQSxLQUFBLE9BQUEsU0FBQSxlQUFBLFFBQUEsS0FBQSxnQkFFQSxLQUFBLE9BQUEsVUFBQSxpQkFFQSxLQUFBLFFBQUEsT0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLGFBRUEsS0FBQSxRQUFBLFlBQ0EsT0FBQSxPQUFBLEtBQUEsT0FDQSxLQUFBLE9BQUEsYUFBQSxHQUFBLFNBQUEsU0FBQSxHQUNBLEdBQUEsY0FBQSxFQUFBLEtBQUEsUUFBQSxLQUFBLE9BQUEsYUFBQSxjQUFBLFVBQUEsRUFBQSxLQUFBLE1BQUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxPQUFBLGFBQ0EsRUFBQSxFQUFBLGFBRUEsT0FBQSwwQkFBQSxLQUFBLEVBQUEsUUFBQSxFQUFBLEtBQUEsTUFBQSxNQUFBLFFBQ0EsRUFBQSxZQUFBLEVBQUEsS0FBQSxNQUFBLE1BQUEsSUFBQSxFQUFBLEtBQUEsTUFBQSxNQUFBLEtBQ0EsS0FBQSxPQUFBLE9BQUEsRUFBQSx3QkFJQSxLQUFBLE1BQUEsS0FBQSxPQUFBLGFBQ0EsS0FBQSxTQUdBLFlBQUEsV0FDQSxLQUFBLFVBQUEsYUFBQSxVQUdBLFlBQUEsV0FDQSxLQUFBLFVBQUEsYUFBQSxTQUdBLFlBQUEsV0FDQSxLQUFBLFFBQUEsYUFBQSxVQUdBLFlBQUEsV0FDQSxLQUFBLFFBQUEsYUFBQSxTQUdBLFFBQUEsV0FDQSxLQUFBLFNBQUEsYUFBQSxRQUNBLEtBQUEsU0FBQSxTQUFBLEdBQ0EsS0FBQSxTQUFBLFVBQUEsR0FFQSxLQUFBLFdBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxhQUFBLEtBQUEsVUFDQSxJQUFBLFdBQ0EsS0FBQSxLQUFBLGNBQUEsWUFDQSxRQUFBLEtBQUEsY0FBQSxlQUdBLEtBQUEsV0FBQSxhQUFBLFFBQ0EsS0FBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLFdBQUEsVUFBQSxHQUVBLEtBQUEsWUFBQSxJQUFBLElBQUEsSUFBQSxVQUFBLGFBQUEsS0FBQSxVQUNBLElBQUEsTUFDQSxRQUFBLHVCQUdBLElBQUEsR0FBQSxJQUFBLElBQUEsSUFBQSxVQUFBLE9BQUEsS0FBQSxZQUFBLEtBQ0EsSUFBQSxNQUNBLFFBQUEscUJBR0EsTUFBQSxVQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxHQUNBLElBQUEsTUFDQSxRQUFBLEtBQUEsU0FBQSxJQUFBLFVBQUEsZUFBQSxLQUFBLGNBQUEsZUFHQSxLQUFBLFFBQUEsSUFBQSxJQUFBLElBQUEsVUFBQSxPQUFBLEdBQ0EsSUFBQSxNQUNBLFFBQUEsNkJBR0EsSUFBQSxHQUFBLElBQ0EsTUFBQSxRQUFBLFVBQUEsV0FDQSxHQUFBLEdBQUEsRUFBQSxPQUFBLGFBQUEsY0FBQSxZQUFBLEVBQUEsT0FBQSxTQUFBLFdBQUEsRUFBQSxPQUFBLFNBQUEsVUFBQSxXQUFBLEVBRUEsTUFBQSxVQUFBLElBR0EsR0FBQSxLQUFBLE9BQUEsOENBQUEsR0FBQSxLQUFBLE9BQUEsNkNBQ0EsS0FBQSxVQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxLQUFBLFlBQUEsS0FDQSxJQUFBLE1BQ0EsUUFBQSxnQkFHQSxLQUFBLGtCQUNBLEtBQUEsVUFBQSxJQUFBLFVBQUEsZ0VBQUEsS0FBQSxVQUFBLEdBQUEsU0FBQSxLQUFBLFVBQUEsR0FBQSxxRUFBQSxLQUFBLFVBQUEsR0FBQSxnQkFBQSxLQUFBLFVBQUEsR0FBQSxpRUFBQSxFQUFBLDRDQUFBLEdBQUEsS0FBQSxVQUFBLEdBQUEsUUFBQSxVQUFBLEtBQUEsVUFBQSxHQUFBLGlCQUFBLFNBRUEsS0FBQSxVQUFBLE1BQUEsSUFBQSxLQUFBLFVBQUEsR0FBQSxnQkFBQSxHQUFBLFNBQUEsU0FBQSxFQUFBLEdBQ0EsS0FBQSxZQUFBLEVBQUEsTUFBQSxHQUNBLEVBQUEsTUFBQSxJQUNBLFFBRUEsS0FBQSxVQUFBLElBQUEsVUFBQSxnRUFBQSxLQUFBLFVBQUEsR0FBQSxTQUFBLEtBQUEsVUFBQSxHQUFBLCtCQUFBLEVBQUEscUNBQUEsR0FBQSxLQUFBLFVBQUEsR0FBQSxVQUFBLFNBRUEsS0FBQSxVQUFBLE1BQUEsSUFBQSxLQUFBLFVBQUEsR0FBQSxTQUFBLEdBQUEsU0FBQSxTQUFBLEVBQUEsR0FDQSxLQUFBLFlBQUEsRUFBQSxPQUNBLEVBQUEsTUFBQSxJQUNBLFFBSUEsS0FBQSxVQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxLQUFBLFlBQUEsS0FDQSxJQUFBLE1BQ0EsUUFBQSxhQUNBLEtBQUEsRUFBQSx5Q0FJQSxJQUFBLFVBQUEsT0FBQSxLQUFBLFlBQUEsS0FDQSxJQUFBLE9BQ0EsTUFBQSxpQkFJQSxhQUFBLFdBQ0EsS0FBQSxRQUFBLElBQUEsSUFBQSxJQUFBLFVBQUEsT0FBQSxLQUFBLFdBQ0EsSUFBQSxNQUNBLFFBQUEsVUFDQSxLQUNBLElBQUEsTUFDQSxRQUFBLGlCQUNBLEtBQUEsNkNBRUEsSUFBQSxNQUNBLFFBQUEscUJBQ0EsS0FBQSwrQ0FFQSxJQUFBLE1BQ0EsUUFBQSxvQkFDQSxLQUFBLGtEQUlBLElBQUEsR0FBQSxJQUVBLE1BQUEsUUFBQSxNQUFBLHVCQUFBLE9BQUEsV0FDQSxLQUFBLE1BQUEsS0FBQSxZQUFBLGNBQ0EsS0FBQSxNQUFBLEtBQUEsU0FBQSxhQUVBLEVBQUEsVUFBQSxTQUFBLFNBQUEsU0FBQSxVQUdBLEtBQUEsUUFBQSxNQUFBLHVCQUFBLFFBQUEsV0FDQSxLQUFBLE1BQUEsS0FBQSxTQUFBLGNBQ0EsS0FBQSxNQUFBLEtBQUEsWUFBQSxhQUVBLEVBQUEsVUFBQSxTQUFBLFNBQUEsWUFBQSxVQUdBLEtBQUEsUUFBQSxNQUFBLHNCQUFBLE9BQUEsV0FDQSxLQUFBLE1BQUEsS0FBQSxZQUFBLGVBQ0EsS0FBQSxNQUFBLEtBQUEsU0FBQSxpQkFFQSxFQUFBLFlBQUEsRUFFQSxHQUFBLFNBQUEsS0FBQSxPQUFBLDRDQUFBLEdBQ0EsRUFBQSxRQUFBLE1BQUEsdUJBQUEsU0FFQSxFQUFBLFFBQUEsTUFBQSx1QkFBQSxVQUdBLEVBQUEsY0FDQSxFQUFBLGNBRUEsRUFBQSxPQUFBLFFBRUEsRUFBQSxVQUFBLFNBQUEsU0FBQSxTQUFBLGNBRUEsRUFBQSxPQUFBLFVBQUEsV0FBQSxPQUdBLEtBQUEsUUFBQSxNQUFBLHNCQUFBLFFBQUEsV0FDQSxLQUFBLE1BQUEsS0FBQSxTQUFBLGVBQ0EsS0FBQSxNQUFBLEtBQUEsWUFBQSxpQkFFQSxFQUFBLFlBQUEsRUFFQSxHQUFBLFNBQUEsS0FBQSxPQUFBLGlDQUFBLEdBQ0EsRUFBQSxRQUFBLE1BQUEsdUJBQUEsU0FFQSxFQUFBLFFBQUEsTUFBQSx1QkFBQSxVQUdBLEVBQUEsY0FDQSxFQUFBLGNBRUEsRUFBQSxPQUFBLFFBRUEsRUFBQSxVQUFBLFNBQUEsU0FBQSxZQUFBLGNBRUEsRUFBQSxPQUFBLFVBQUEsV0FBQSxLQUVBLEVBQUEsUUFBQSxjQUlBLFlBQUEsV0FDQSxLQUFBLE9BQUEsSUFBQSxLQUFBLElBQUEsU0FBQSxXQUFBLE9BQUEsS0FBQSxjQUFBLGNBQ0EsS0FBQSxPQUFBLFlBQ0EsU0FBQSxJQUNBLFNBQUEsR0FDQSwyQkFBQSxFQUNBLGFBQUEsRUFDQSxXQUFBLEdBQUEsU0FBQSxLQUFBLE9BQUEsdUNBQUEsR0FDQSxTQUFBLFNBQUEsS0FBQSxPQUFBLHNDQUFBLEdBQ0EsV0FBQSxLQUFBLE9BQUEsdUNBQUEsS0FFQSxLQUFBLE9BQUEsYUFBQSxnQkFBQSxHQUNBLEtBQUEsT0FBQSxhQUFBLG9CQUNBLEtBQUEsT0FBQSxTQUFBLGdCQUFBLEdBQUEsSUFDQSxLQUFBLE9BQUEsYUFBQSxTQUFBLEtBQUEsU0FBQSxZQUNBLEtBQUEsT0FBQSxhQUFBLFFBQUEsMkJBQ0EsS0FBQSxPQUFBLFNBQUEsY0FBQSxLQUFBLE9BQUEsaUNBQUEsWUFFQSxLQUFBLE9BQUEsU0FBQSxZQUNBLEtBQUEsT0FDQSxTQUFBLElBQUEsTUFBQSxJQUFBLE9BQ0EsS0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsUUFBQSxRQUFBLEVBQUEsb0JBQUEsS0FDQSxFQUFBLGlDQUFBLEtBQUEsRUFDQSxHQUNBLEVBQUEsUUFBQSxXQUFBLEVBQUEsb0JBQUEsSUFBQSxFQUFBLG9CQUFBLElBQUEsS0FFQSxFQUFBLFdBT0EsSUFBQSxHQUFBLElBQUEsUUFBQSwwQkFDQSxHQUNBLGVBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsTUFBQSxLQUFBLEVBQUEsUUFBQSxFQUFBLFNBQUEsU0FFQSxLQUFBLEtBQUEsU0FDQSxJQUFBLGVBQUEsT0FBQSxhQUNBLFFBQ0EsT0FBQSx1QkFDQSxPQUFBLEdBRUEsV0FDQSxTQUNBLEdBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxFQUFBLFVBRUEsTUFBQSxTQVhBLFNBa0JBLEdBQUEsYUFBQSxHQUVBLEtBQUEsT0FBQSxVQUFBLGlCQUFBLFlBQUEsS0FBQSxtQkFBQSxHQUNBLEtBQUEsT0FBQSxVQUFBLGlCQUFBLFdBQUEsS0FBQSxtQkFBQSxHQUNBLEtBQUEsT0FBQSxVQUFBLGlCQUFBLE9BQUEsS0FBQSxLQUFBLEtBQUEsT0FBQSxJQUdBLGVBQUEsV0FDQSxLQUFBLFdBQUEsR0FBQSxhQUNBLE1BQUEsRUFDQSxVQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUNBLElBQUEsR0FBQSxLQUFBLFlBQUEsR0FDQSxJQU1BLE1BTEEsR0FBQSxLQUFBLFVBQUEsRUFBQSxHQUFBLE1BRUEsRUFBQSxFQUFBLFFBQUEsUUFBQSxjQUNBLEVBQUEsRUFBQSxRQUFBLE1BQUEsY0FHQSxNQUFBLElBR0EsSUFNQSxNQUxBLEdBQUEsS0FBQSxjQUFBLEdBQUEsTUFFQSxFQUFBLEVBQUEsUUFBQSxRQUFBLGNBQ0EsRUFBQSxFQUFBLFFBQUEsTUFBQSxjQUdBLE1BQUEsSUFFQSxNQUFBLE1BR0EsS0FBQSxXQUFBLE9BQUEsTUFBQSxTQUFBLGVBR0EsTUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEtBQUEsV0FBQSxPQUFBLEVBS0EsSUFIQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBQ0EsRUFBQSxFQUFBLFFBQUEsT0FBQSxLQUVBLEdBQUEsS0FBQSxPQUFBLHFDQUFBLENBQ0EsS0FBQSxjQUNBLGFBQUEsS0FBQSxhQUdBLElBQUEsR0FBQSxTQUFBLEtBQUEsT0FBQSw4Q0FBQSxJQUVBLE1BQUEsYUFBQSxXQUFBLFdBQ0EsS0FBQSxLQUFBLFNBQ0EsSUFBQSxlQUFBLE9BQUEsYUFDQSxRQUNBLE9BQUEsNEJBQ0EsUUFBQSxFQUNBLFNBQUEsS0FBQSxRQUFBLElBRUEsVUFBQSxFQUNBLFdBQ0EsU0FDQSxHQUFBLFNBQUEsR0FDQSxLQUFBLFFBQUEsT0FBQSxFQUFBLE1BR0EsS0FBQSxPQUFBLG9CQUFBLElBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxvQkFDQSxLQUFBLFFBQUEsSUFBQSxVQUFBLEtBQUEsUUFBQSxJQUFBLGNBSUEsS0FBQSxRQUFBLGFBRUEsTUFBQSxVQUlBLEtBQUEsTUFBQSxPQUVBLE1BQUEsUUFBQSxPQUFBLEdBR0EsS0FBQSxPQUFBLG9CQUFBLElBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxvQkFDQSxLQUFBLFFBQUEsSUFBQSxVQUFBLEtBQUEsUUFBQSxJQUFBLGNBR0EsS0FBQSxRQUFBLFdBTUEsT0FIQSxNQUFBLFdBQUEsSUFBQSxNQUFBLEtBQUEsT0FBQSxXQUNBLEtBQUEsU0FBQSxJQUFBLE1BQUEsRUFFQSxHQUdBLGtCQUFBLFNBQUEsR0FDQSxFQUFBLGtCQUNBLEVBQUEsa0JBR0EsS0FBQSxTQUFBLEdBQ0EsRUFBQSxrQkFDQSxFQUFBLGtCQUVBLEdBQUEsS0FBQSxPQUFBLDhDQUFBLEdBQUEsS0FBQSxPQUFBLDhDQUNBLEtBQUEsWUFBQSxFQUFBLGFBQUEsUUFJQSxZQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsR0FBQSxFQUVBLElBQUEsS0FBQSxFQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsV0FBQSxLQUFBLEVBQUEsS0FFQSxJQUFBLEVBQUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxPQUFBLDZDQUFBLE9BQUEsQ0FFQSxLQUFBLEtBQUEsVUFBQSxLQUFBLE9BQUEscUNBQUEsR0FHQSxNQUZBLE1BQUEsWUFBQSxFQUFBLFFBQUEsRUFBQSxpREFFQSxDQUdBLElBQUEsRUFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBLG1DQUdBLE1BRkEsTUFBQSxZQUFBLEVBQUEsUUFBQSxFQUFBLHVDQUVBLENBR0EsSUFBQSxLQUFBLE9BQUEseUNBQ0EsS0FBQSxNQUNBLE1BQUEsZ0NBQ0EsS0FBQSxFQUNBLEdBQUEsS0FDQSxPQUFBLElBQ0EsUUFFQSxLQUFBLFdBQUEsRUFBQSxRQUFBLEdBQ0EsS0FBQSxPQUFBLGFBRUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxPQUFBLDRDQUFBLE9BQUEsQ0FFQSxLQUFBLEtBQUEsVUFBQSxLQUFBLE9BQUEsb0NBQUEsR0FHQSxNQUZBLE1BQUEsWUFBQSxFQUFBLE9BQUEsRUFBQSxnREFFQSxDQUdBLElBQUEsRUFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBLG1DQUdBLE1BRkEsTUFBQSxZQUFBLEVBQUEsT0FBQSxFQUFBLHVDQUVBLENBR0EsTUFBQSxXQUFBLEVBQUEsUUFDQSxLQUFBLE9BQUEsVUFHQSxPQUdBLFVBQUEsU0FBQSxFQUFBLEdBR0EsTUFGQSxHQUFBLEVBQUEsTUFBQSxLQUVBLElBQUEsRUFBQSxRQUFBLEVBQUEsS0FBQSxNQUFBLEtBQUEsUUFHQSxXQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxHQUFBLE9BQ0EsRUFBQSxHQUFBLENBRUEsSUFBQSxHQUFBLEtBQUEsaUJBRUEsRUFBQSxHQUFBLFNBQ0EsR0FBQSxPQUFBLE9BQUEsR0FDQSxFQUFBLE9BQUEsU0FBQSxjQUFBLEVBQUEsVUFDQSxFQUFBLE9BQUEsT0FBQSxFQUFBLE1BQ0EsRUFBQSxPQUFBLFdBQUEsS0FBQSxPQUFBLFVBQ0EsRUFBQSxPQUFBLFNBQUEsRUFFQSxJQUFBLEdBQUEsR0FBQSxlQUNBLEdBQUEsS0FBQSxPQUFBLGVBQUEsT0FBQSxjQUNBLEVBQUEsaUJBQUEsYUFBQSxRQUNBLEVBQUEsaUJBQUEsVUFBQSxJQUFBLEtBQUEsZUFBQSxTQUVBLEVBQUEsT0FBQSxXQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsaUJBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxJQUFBLENBQ0EsR0FBQSxNQUFBLGFBQUEsU0FBQSxFQUFBLE9BRUEsS0FBQSxNQUVBLEVBQUEsT0FBQSxXQUNBLEdBQUEsTUFBQSxFQUFBLE9BQUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxNQUFBLEVBQUEsYUFDQSxJQUFBLEdBQUEsRUFBQSxRQUFBLENBQ0EsRUFBQSxRQUNBLElBQUEsR0FBQSxTQUFBLEVBQUEsSUFBQSxHQUNBLEVBQUEsU0FBQSxFQUFBLE9BQUEsSUFDQSxNQUFBLE9BQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxPQUFBLEtBQUEsS0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLEVBQUEsT0FBQSxLQUFBLEtBQUEsT0FFQSxNQUFBLGFBQUEsRUFBQSxFQUFBLFdBR0EsS0FBQSxNQUVBLEVBQUEsS0FBQSxJQUdBLGVBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLElBQUEsVUFBQSxZQUFBLEtBQUEsV0FDQSxJQUFBLE1BQ0EsS0FBQSwyRUFBQSxFQUFBLDRCQUFBLEdBQUEsRUFBQSxpQkFHQSxPQUFBLEtBQUEsSUFBQSxJQUdBLGFBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxNQUFBLGFBQUEsU0FBQSxTQUNBLEVBQUEsTUFBQSxhQUFBLFNBQUEsUUFFQSxFQUFBLE1BQUEsS0FBQSxTQUFBLGtCQUNBLEVBQUEsTUFBQSxLQUFBLGFBQUEsZUFBQSxlQUNBLEVBQUEsTUFBQSxLQUFBLFlBQUEsYUFFQSxFQUFBLE1BQUEsUUFBQSxJQUFBLFdBQUEsWUFBQSxFQUNBLEVBQUEsTUFBQSxtQkFBQSxHQUFBLFFBQUEsV0FDQSxFQUFBLFlBSUEsWUFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxLQUFBLGVBQUEsRUFBQSxFQUFBLEtBQ0EsTUFBQSxhQUFBLEVBQUEsSUFHQSxlQUFBLFdBQ0EsTUFBQSxtQkFBQSxRQUFBLGFBQUEsS0FBQSxVQUFBLFVBQUEsUUFBQSxlQUlBLEtBQUEsUUFBQSxTQUFBLEdBQ0EsR0FBQSxnQkFBQSxRQUNBLFlBQUEsS0FJQSxLQUFBLFlBQUEsV0FDQSxHQUFBLEdBQUEsSUFBQSxNQUFBLHlCQUVBLEtBQUEsS0FBQSxFQUFBLFNBQUEsR0FFQSxPQURBLEVBQUEsSUFBQSxJQUFBLElBR0EsZUFBQSxlQUFBLEVBQUEsS0FBQSxHQUVBLGVBQUEsZUFBQSxFQUFBLElBQUEsR0FBQSxnQkFBQSxRQUNBLFlBQUEsRUFBQSxLQURBLFNBSkEsS0FZQSxLQUFBLFlBQUEsV0FDQSxHQUFBLEdBQUEsSUFBQSxNQUFBLGlCQUVBLEtBQUEsS0FBQSxFQUFBLFNBQUEsR0FFQSxPQURBLEVBQUEsSUFBQSxJQUFBLElBR0EsZUFBQSxlQUFBLEVBQUEsS0FFQSxlQUFBLGVBQUEsRUFBQSxJQUFBLFVBQUEsU0FGQSxHQUZBLEtDL29CQSxlQUFBLE9BQUEsUUFBQSxTQUFBLFFBQ0EsT0FBQSxXQUNBLE9BQUEsZ0JBQUEsT0FBQSxpQkFBQSw4QkFFQSxJQUFBLFFBQUEsUUFDQSxPQUFBLEVBQ0EsT0FBQSxPQUNBLFlBQUEsT0FDQSxRQUFBLEVBQ0EsV0FBQSxFQUNBLGFBQUEsRUFDQSxhQUFBLEVBQ0EsWUFBQSxFQUNBLFlBQUEsRUFDQSxXQUFBLEVBQ0EsTUFBQSxJQUNBLE9BQUEsRUFDQSxNQUFBLEVBQUEscUNBQ0EsSUFBQSxjQUNBLEtBQUEsK0NBQUEsSUFBQSxnQkFBQSxPQUFBLE1BQUEsV0FDQSxPQUNBLEtBQUEsb0NBQUEsRUFBQSwrQkFDQSxNQUFBLEtBQ0EsTUFBQSxPQUNBLE9BQUEsY0FDQSxRQUFBLEtBQUEsb0JBRUEsS0FBQSxrQ0FBQSxFQUFBLCtCQUNBLE1BQUEsS0FDQSxNQUFBLE9BQ0EsT0FBQSxjQUNBLFFBQUEsS0FBQSxvQkFFQSxLQUFBLHlDQUFBLEVBQUEsa0NBQ0EsTUFBQSxLQUNBLE1BQUEsR0FDQSxPQUFBLE9BQ0EsUUFBQSxLQUFBLG9CQUVBLEtBQUEsMENBQUEsRUFBQSxtQ0FDQSxNQUFBLEtBQ0EsT0FBQSxHQUNBLE9BQUEsT0FDQSxRQUFBLEtBQUEsb0JBRUEsS0FBQSx5Q0FBQSxFQUFBLHNDQUNBLE1BQUEsS0FDQSxNQUFBLElBQ0EsT0FBQSxTQUNBLFFBQUEsS0FBQSxvQkFFQSxLQUFBLDBDQUFBLEVBQUEsdUNBQ0EsTUFBQSxLQUNBLE1BQUEsR0FDQSxPQUFBLFNBQ0EsUUFBQSxLQUFBLG9CQUVBLEtBQUEsb0NBQUEsRUFBQSx3Q0FDQSxNQUFBLEtBQ0EsTUFBQSxLQUNBLE9BQUEsUUFDQSxRQUFBLEtBQUEsb0JBRUEsVUFDQSxLQUFBLEVBQUEsVUFDQSxNQUFBLEtBQ0EsUUFBQSxLQUFBLFFBRUEsS0FBQSxFQUFBLGlDQUNBLElBQUEsaUJBQ0EsTUFBQSxLQUNBLEtBQUEsRUFDQSxRQUFBLEtBQUEsU0FFQSxLQUFBLEVBQUEsc0NBQ0EsSUFBQSxpQkFDQSxNQUFBLEtBQ0EsS0FBQSxFQUNBLFFBQUEsS0FBQSxTQUVBLFdBQ0EsTUFDQSxHQUFBLFdBQ0EsR0FBQSxrQkFDQSxNQUFBLFdBQUEsRUFBQSxJQUFBLEtBQUEsR0FBQSxJQUFBLE9BQUEsZ0JBRUEsSUFBQSxPQUFBLEtBQUEsT0FBQSxzQ0FDQSxTQUNBLE1BQUEsUUFBQSxrQkFBQSxJQUNBLE1BQUEsS0FBQSxPQUVBLGVBQUEsWUFBQSxPQUdBLGVBQUEsS0FBQSxTQUFBLEdBQ0EsS0FBQSxXQUNBLFFBQUEsRUFBQSxFQUNBLE9BQUEsRUFBQSxFQUNBLFlBQUEsRUFBQSxPQUNBLFdBQUEsRUFBQSxNQUNBLFlBQUEsRUFBQSxPQUFBLEtBQ0EsUUFDQSxLQUFBLE1BRUEsS0FBQSxXQUFBLFFBQUEsaUJBRUEsTUFBQSxTQUlBLGVBQUEsT0FBQSxRQUFBLFdBQUEsWUFBQSxLQUFBLEtBQUEsUUFDQSxLQUFBLE9BQUEsUUFHQSxJQUFBLE9BQUEsZUFBQSxPQUFBLFFBQUEsSUFBQSxRQUNBLFVBQUEsR0FDQSxPQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxPQUFBLEdBQUEsZUFBQSxRQUFBLEtBQUEsT0FBQSxLQUFBLE1BRUEsRUFBQSxHQUFBLFNBQ0EsR0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLE1BQ0EsRUFBQSxPQUFBLFNBQUEsMEJBQ0EsRUFBQSxPQUFBLFlBQUEsS0FBQSxXQUNBLEVBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLE1BQ0EsRUFBQSxPQUFBLE9BQUEsRUFBQSxNQUNBLEVBQUEsT0FBQSxXQUFBLEtBQUEsT0FBQSxHQUFBLE9BQUEsVUFDQSxFQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUEsT0FFQSxJQUFBLEdBQUEsR0FBQSxlQUNBLEdBQUEsS0FBQSxPQUFBLGVBQUEsT0FBQSxjQUNBLEVBQUEsaUJBQUEsYUFBQSxRQUNBLEVBQUEsaUJBQUEsVUFBQSxJQUFBLEtBQUEsZUFBQSxTQUVBLEVBQUEsT0FBQSxXQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsaUJBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxJQUFBLENBQ0EsR0FBQSxNQUFBLGFBQUEsU0FBQSxFQUFBLE9BRUEsS0FBQSxNQUVBLEVBQUEsT0FBQSxXQUNBLEdBQUEsTUFBQSxFQUFBLE9BQUEsQ0FDQSxHQUFBLEdBQUEsS0FBQSxNQUFBLEVBQUEsYUFFQSxJQUFBLEVBQUEsU0FDQSxFQUFBLFNBQ0EsS0FBQSxPQUFBLEdBQUEsT0FBQSxPQUFBLEtBQUEsRUFBQSxPQUFBLEtBQUEsS0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLEVBQUEsT0FBQSxLQUFBLFdBRUEsS0FBQSxPQUFBLEdBQUEsYUFBQSxFQUFBLEVBQUEsV0FHQSxLQUFBLE1BRUEsRUFBQSxLQUFBLEdBRUEsS0FBQSxTQUdBLGtCQUFBLFNBQUEsR0FDQSxLQUFBLFdBQUEsUUFBQSxFQUFBLE9BQUEsRUFBQSxRQUdBLE1BQUEsV0FDQSxLQUFBLFdBQUEsUUFBQSxXQUVBLGVBQUEsT0FBQSxRQUFBLFdBQUEsTUFBQSxLQUFBLE1BQ0EsS0FBQSxPQUFBLEdBQUEsT0FBQSxXQUdBLElBQUEsSUFBQSxnQ0FBQSxlQUFBLE9BQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiRXh0Lm5zKCdNYXJrZG93bkVkaXRvcicpO1xuTWFya2Rvd25FZGl0b3IgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgTWFya2Rvd25FZGl0b3Iuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsY29uZmlnKTtcbn07XG5FeHQuZXh0ZW5kKE1hcmtkb3duRWRpdG9yLEV4dC5Db21wb25lbnQse1xuICAgIHdpbmRvdzp7fSxjb25maWc6IHt9XG59KTtcbkV4dC5yZWcoJ21hcmtkb3duZWRpdG9yJyxNYXJrZG93bkVkaXRvcik7XG5tYXJrZG93bkVkaXRvciA9IG5ldyBNYXJrZG93bkVkaXRvcigpO1xuXG5tYXJrZG93bkVkaXRvci5sb2FkZWRFbGVtZW50cyA9IHt9O1xuXG5tYXJrZG93bkVkaXRvci5FZGl0b3IgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICBjb25maWcgPSBjb25maWcgfHwge307XG4gICAgY29uZmlnLnJlc291cmNlID0gTU9EeC5yZXF1ZXN0LmlkIHx8IDA7XG4gICAgbWFya2Rvd25FZGl0b3IuRWRpdG9yLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLGNvbmZpZyk7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG59O1xuRXh0LmV4dGVuZChtYXJrZG93bkVkaXRvci5FZGl0b3IsRXh0LkNvbXBvbmVudCx7XG4gICAgcmVtYXJrYWJsZTogJydcbiAgICAsZnVsbFNjcmVlbjogZmFsc2VcbiAgICAsaW5pdENvbXBvbmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIE1hcmtkb3duRWRpdG9yLnN1cGVyY2xhc3MuaW5pdENvbXBvbmVudC5jYWxsKHRoaXMpO1xuXG4gICAgICAgIGlmICh0aGlzLm1kRWxlbWVudElkKXtcbiAgICAgICAgICAgIEV4dC5vblJlYWR5KHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICxkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmVkaXRvci5kZXN0cm95KCk7XG5cbiAgICAgICAgdGhpcy5tZENvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy50YU1hcmtkb3duLnJlbW92ZSgpO1xuXG4gICAgICAgIHRoaXMudGV4dGFyZWEuZG9tLnN0eWxlLmRpc3BsYXkgPSBudWxsO1xuICAgICAgICB0aGlzLnRleHRhcmVhLmRvbS5zdHlsZS53aWR0aCA9IG51bGw7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuZG9tLnN0eWxlLmhlaWdodCA9IG51bGw7XG5cbiAgICAgICAgTWFya2Rvd25FZGl0b3Iuc3VwZXJjbGFzcy5kZXN0cm95LmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLHJlbmRlcjogZnVuY3Rpb24oY29udGFpbmVyLCBwb3NpdGlvbikge1xuICAgICAgICB0aGlzLnRleHRhcmVhID0gRXh0LmdldCh0aGlzLm1kRWxlbWVudElkKTtcbiAgICAgICAgdGhpcy5tZEVsZW1lbnROYW1lID0gdGhpcy50ZXh0YXJlYS5kb20ubmFtZTtcblxuICAgICAgICBpZiAoIXRoaXMudGV4dGFyZWEpIHJldHVybjtcblxuICAgICAgICB0aGlzLmJ1aWxkVUkoKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckFjZSgpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyTWFya2VkKCk7XG4gICAgICAgIHRoaXMuYnVpbGRUb29sYm94KCk7XG5cbiAgICAgICAgdmFyIHByZXZpZXdCdXR0b24gPSB0aGlzLnRvb2xCb3guY2hpbGQoJy5wcmV2aWV3LWJ1dHRvbicpO1xuICAgICAgICB2YXIgZnVsbHNjcmVlbkJ1dHRvbiA9IHRoaXMudG9vbEJveC5jaGlsZCgnLmZ1bGxzY3JlZW4tYnV0dG9uJyk7XG4gICAgICAgIHZhciBzcGxpdHNjcmVlbkJ1dHRvbiA9IHRoaXMudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpO1xuXG4gICAgICAgIHZhciBjb250ZW50ID0gdGhpcy5jb250ZW50TUQ7XG5cbiAgICAgICAgdmFyIHByZXZpZXdCdXR0b25PZmYgPSBFeHQuZ2V0KEV4dC5Eb21IZWxwZXIuYXBwZW5kKGNvbnRlbnQucGFyZW50KCkse1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAncHJldmlldy1idXR0b24tb2ZmJyxcbiAgICAgICAgICAgIGh0bWw6ICc8aSBjbGFzcz1cImljb24gaWNvbi1leWUtc2xhc2ggaWNvbi1sYXJnZVwiPjwvaT4nLFxuICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgZHJvcFRhcmdldCA9IE1PRHgubG9hZCh7XG4gICAgICAgICAgICB4dHlwZTogJ21vZHgtdHJlZWRyb3AnLFxuICAgICAgICAgICAgdGFyZ2V0OiBjb250ZW50LFxuICAgICAgICAgICAgdGFyZ2V0RWw6IGNvbnRlbnQsXG4gICAgICAgICAgICBvbkluc2VydDogKGZ1bmN0aW9uKHMpe1xuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pLmJpbmQodGhpcy5lZGl0b3IpLFxuICAgICAgICAgICAgaWZyYW1lOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRleHRhcmVhLm9uKCdkZXN0cm95JywgZnVuY3Rpb24oKSB7ZHJvcFRhcmdldC5kZXN0cm95KCk7fSk7XG5cbiAgICAgICAgdmFyIGRlZmF1bHRTcGxpdCA9IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNwbGl0J10gfHwgMCk7XG4gICAgICAgIGlmIChkZWZhdWx0U3BsaXQgPT0gMSkge1xuICAgICAgICAgICAgc3BsaXRzY3JlZW5CdXR0b24udHVybk9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcHJldmlld0J1dHRvbi5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGlzLmhpZGVDb250ZW50KCk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5zZXREaXNwbGF5ZWQoJ25vbmUnKTtcblxuICAgICAgICAgICAgdGhpcy5jb250ZW50TUQucGFyZW50KCkucGFyZW50KCkuYWRkQ2xhc3MoJ3ByZXZpZXcnKTtcblxuICAgICAgICAgICAgcHJldmlld0J1dHRvbk9mZi5zaG93KClcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgcHJldmlld0J1dHRvbk9mZi5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmhpZGVQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGlzLnNob3dDb250ZW50KCk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5zZXREaXNwbGF5ZWQoJ2Jsb2NrJyk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdwcmV2aWV3Jyk7XG5cbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIHByZXZpZXdCdXR0b25PZmYuaGlkZSgpO1xuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBzcGxpdHNjcmVlbkJ1dHRvbi5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHNwbGl0c2NyZWVuQnV0dG9uLmNoaWxkKCdpJykuaGFzQ2xhc3MoJ2ljb24tcGF1c2UnKSkge1xuICAgICAgICAgICAgICAgIHNwbGl0c2NyZWVuQnV0dG9uLnR1cm5PbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzcGxpdHNjcmVlbkJ1dHRvbi50dXJuT2ZmKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGZ1bGxzY3JlZW5CdXR0b24uYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmZ1bGxTY3JlZW4gPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuQnV0dG9uLnR1cm5PbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuQnV0dG9uLnR1cm5PZmYoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuICAgICAgICAgICAgdGhpcy5lZGl0b3IucmVzaXplKHRydWUpO1xuXG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGlmIChtYXJrZG93bkVkaXRvci5jb250ZW50W3RoaXMubWRFbGVtZW50TmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNldFZhbHVlKG1hcmtkb3duRWRpdG9yLmNvbnRlbnRbdGhpcy5tZEVsZW1lbnROYW1lXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lZGl0b3Iuc2VsZWN0aW9uLmNsZWFyU2VsZWN0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5wcmV2aWV3LnVwZGF0ZSh0aGlzLnBhcnNlKHRoaXMuZWRpdG9yLmdldFZhbHVlKCkpKTtcblxuICAgICAgICB0aGlzLnByZXZpZXcuZml4SGVpZ2h0KCk7XG4gICAgICAgIHdpbmRvdy5lZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIGlmIChlLmRhdGEuYWN0aW9uID09ICdpbnNlcnRUZXh0JyAmJiB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0RG9jdW1lbnQoKS5pc05ld0xpbmUoZS5kYXRhLnRleHQpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlc3Npb24gPSB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCk7XG4gICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gc2Vzc2lvbi5nZXREb2N1bWVudCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKC9eXFxzKig/OlsqKy1dfFxcZCtcXC4pXFxzKiQvLmV4ZWMoZG9jdW1lbnQuZ2V0TGluZShlLmRhdGEucmFuZ2Uuc3RhcnQucm93KSkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVMaW5lcyhlLmRhdGEucmFuZ2Uuc3RhcnQucm93LCBlLmRhdGEucmFuZ2Uuc3RhcnQucm93KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuaW5zZXJ0KGRvY3VtZW50LmdldE5ld0xpbmVDaGFyYWN0ZXIoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBhcnNlKHRoaXMuZWRpdG9yLmdldFZhbHVlKCkpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgICxzaG93Q29udGVudDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jb250ZW50TUQuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuICAgIH1cblxuICAgICxoaWRlQ29udGVudDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jb250ZW50TUQuc2V0RGlzcGxheWVkKCdub25lJyk7XG4gICAgfVxuXG4gICAgLHNob3dQcmV2aWV3OiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnByZXZpZXcuc2V0RGlzcGxheWVkKCdibG9jaycpO1xuICAgIH1cblxuICAgICxoaWRlUHJldmlldzogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5wcmV2aWV3LnNldERpc3BsYXllZCgnbm9uZScpO1xuICAgIH1cblxuICAgICxidWlsZFVJOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXREaXNwbGF5ZWQoJ25vbmUnKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRXaWR0aCgwKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRIZWlnaHQoMCk7XG5cbiAgICAgICAgdGhpcy50YU1hcmtkb3duID0gRXh0LmdldChFeHQuRG9tSGVscGVyLmluc2VydEJlZm9yZSh0aGlzLnRleHRhcmVhLCB7XG4gICAgICAgICAgICB0YWc6ICd0ZXh0YXJlYScsXG4gICAgICAgICAgICBuYW1lOiB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJyxcbiAgICAgICAgICAgIGNsYXNzOiB0aGlzLm1kRWxlbWVudE5hbWUgKyAnX21hcmtkb3duJ1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgdGhpcy50YU1hcmtkb3duLnNldERpc3BsYXllZCgnbm9uZScpO1xuICAgICAgICB0aGlzLnRhTWFya2Rvd24uc2V0V2lkdGgoMCk7XG4gICAgICAgIHRoaXMudGFNYXJrZG93bi5zZXRIZWlnaHQoMCk7XG5cbiAgICAgICAgdGhpcy5tZENvbnRhaW5lciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5pbnNlcnRCZWZvcmUodGhpcy50ZXh0YXJlYSwge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAnbWFya2Rvd24tY29udGFpbmVyJ1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgdmFyIHdyYXBwZXIgPSBFeHQuZ2V0KEV4dC5Eb21IZWxwZXIuYXBwZW5kKHRoaXMubWRDb250YWluZXIuZG9tLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzczogJ21hcmtkb3duLXdyYXBwZXInXG4gICAgICAgIH0pKTtcblxuICAgICAgICB0aGlzLmNvbnRlbnRNRCA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQod3JhcHBlcix7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3M6IHRoaXMudGV4dGFyZWEuZG9tLmNsYXNzTmFtZSArICcgY29udGVudC1tZCAnICsgdGhpcy5tZEVsZW1lbnROYW1lICsgJ19tYXJrZG93bidcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHRoaXMucHJldmlldyA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQod3JhcHBlcix7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3M6ICdtYXJrZG93bi1ib2R5IHByZXZpZXctbWQnXG4gICAgICAgIH0pKTtcblxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMucHJldmlldy5maXhIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGhhdC5lZGl0b3IuZ2V0U2Vzc2lvbigpLmdldERvY3VtZW50KCkuZ2V0TGVuZ3RoKCkgKiB0aGF0LmVkaXRvci5yZW5kZXJlci5saW5lSGVpZ2h0ICsgdGhhdC5lZGl0b3IucmVuZGVyZXIuc2Nyb2xsQmFyLmdldFdpZHRoKCkgICsgMzI7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0SGVpZ2h0KGhlaWdodCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ltYWdlX3VwbG9hZCddID09IDEgfHwgTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5lbmFibGVfZmlsZV91cGxvYWQnXSA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0JhciA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5tZENvbnRhaW5lci5kb20se1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdzdGF0dXMtYmFyJ1xuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc01vYmlsZURldmljZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuZG9tLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPVwidXBsb2FkLWJhclwiPiA8aW5wdXQgY2xhc3M9XCJoaWRkZW5cIiBuYW1lPVwibWRfZmlsZV8nKyB0aGlzLnN0YXR1c0Jhci5pZCArJ1wiIGlkPVwiJyArIHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlXCIgdHlwZT1cImZpbGVcIiBtdWx0aXBsZSAvPjxpbnB1dCBjbGFzcz1cImhpZGRlblwiIG5hbWU9XCJtZF9maWxlXycrIHRoaXMuc3RhdHVzQmFyLmlkICsnLW1vYmlsZVwiIGlkPVwiJyArIHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlLW1vYmlsZVwiIHR5cGU9XCJmaWxlXCIgYWNjZXB0PVwiaW1hZ2UvKlwiIGNhcHR1cmU9XCJjYW1lcmFcIiAvPicgKyBfKCdtYXJrZG93bmVkaXRvci5zdGF0dXNfYmFyX21lc3NhZ2VfbW9iaWxlJywge2lkOiB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZScsIGlkX21vYmlsZTogdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGUtbW9iaWxlJ30pICsgJzwvZGl2Pic7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5jaGlsZCgnIycgKyB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZS1tb2JpbGUnKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZSwgaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVGaWxlcyhpbnB1dC5maWxlcywgMSk7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuZG9tLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPVwidXBsb2FkLWJhclwiPiA8aW5wdXQgY2xhc3M9XCJoaWRkZW5cIiBuYW1lPVwibWRfZmlsZV8nKyB0aGlzLnN0YXR1c0Jhci5pZCArJ1wiIGlkPVwiJyArIHRoaXMuc3RhdHVzQmFyLmlkICsgJy1maWxlXCIgdHlwZT1cImZpbGVcIiBtdWx0aXBsZT4nICsgXygnbWFya2Rvd25lZGl0b3Iuc3RhdHVzX2Jhcl9tZXNzYWdlJywge2lkOiB0aGlzLnN0YXR1c0Jhci5pZCArICctZmlsZSd9KSArICc8L2Rpdj4nO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIuY2hpbGQoJyMnICsgdGhpcy5zdGF0dXNCYXIuaWQgKyAnLWZpbGUnKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZSwgaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVGaWxlcyhpbnB1dC5maWxlcyk7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIgPSBFeHQuZ2V0KEV4dC5Eb21IZWxwZXIuYXBwZW5kKHRoaXMubWRDb250YWluZXIuZG9tLHtcbiAgICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNsYXNzOiAnc3RhdHVzLWJhcicsXG4gICAgICAgICAgICAgICAgaHRtbDogXygnbWFya2Rvd25lZGl0b3Iuc3RhdHVzX2Jhcl9kaXNhYmxlZCcpXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cblxuICAgICAgICBFeHQuRG9tSGVscGVyLmFwcGVuZCh0aGlzLm1kQ29udGFpbmVyLmRvbSx7XG4gICAgICAgICAgICB0YWc6ICdzcGFuJyxcbiAgICAgICAgICAgIHN0eWxlOiAnY2xlYXI6IGJvdGgnXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICxidWlsZFRvb2xib3g6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMudG9vbEJveCA9IEV4dC5nZXQoRXh0LkRvbUhlbHBlci5hcHBlbmQodGhpcy5jb250ZW50TUQse1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzOiAndG9vbGJveCcsXG4gICAgICAgICAgICBjbjogW3tcbiAgICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNsYXNzOiAncHJldmlldy1idXR0b24nLFxuICAgICAgICAgICAgICAgIGh0bWw6ICc8aSBjbGFzcz1cImljb24gaWNvbi1leWUgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNsYXNzOiAnc3BsaXRzY3JlZW4tYnV0dG9uJyxcbiAgICAgICAgICAgICAgICBodG1sOiAnPGkgY2xhc3M9XCJpY29uIGljb24tcGF1c2UgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNsYXNzOiAnZnVsbHNjcmVlbi1idXR0b24nLFxuICAgICAgICAgICAgICAgIGh0bWw6ICc8aSBjbGFzcz1cImljb24gaWNvbi1leHBhbmQgaWNvbi1sYXJnZVwiPjwvaT4nXG4gICAgICAgICAgICB9XVxuICAgICAgICB9KSk7XG5cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpLnR1cm5PbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jaGlsZCgnaScpLnJlbW92ZUNsYXNzKCdpY29uLXBhdXNlJyk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykuYWRkQ2xhc3MoJ2ljb24tc3RvcCcpO1xuXG4gICAgICAgICAgICB0aGF0LmNvbnRlbnRNRC5wYXJlbnQoKS5wYXJlbnQoKS5hZGRDbGFzcygnc3BsaXQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT2ZmID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykuYWRkQ2xhc3MoJ2ljb24tcGF1c2UnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGQoJ2knKS5yZW1vdmVDbGFzcygnaWNvbi1zdG9wJyk7XG5cbiAgICAgICAgICAgIHRoYXQuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdzcGxpdCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudG9vbEJveC5jaGlsZCgnLmZ1bGxzY3JlZW4tYnV0dG9uJykudHVybk9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykucmVtb3ZlQ2xhc3MoJ2ljb24tZXhwYW5kJyk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykuYWRkQ2xhc3MoJ2ljb24tY29tcHJlc3MnKTtcblxuICAgICAgICAgICAgdGhhdC5mdWxsU2NyZWVuID0gdHJ1ZTtcblxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNwbGl0X2Z1bGxzY3JlZW4nXSB8fCAxKSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhhdC50b29sQm94LmNoaWxkKCcuc3BsaXRzY3JlZW4tYnV0dG9uJykudHVybk9uKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQudG9vbEJveC5jaGlsZCgnLnNwbGl0c2NyZWVuLWJ1dHRvbicpLnR1cm5PZmYoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhhdC5zaG93UHJldmlldygpO1xuICAgICAgICAgICAgdGhhdC5zaG93Q29udGVudCgpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvci5mb2N1cygpO1xuXG4gICAgICAgICAgICB0aGF0LmNvbnRlbnRNRC5wYXJlbnQoKS5wYXJlbnQoKS5hZGRDbGFzcygnZnVsbHNjcmVlbicpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvci5zZXRPcHRpb24oJ21heExpbmVzJywgbnVsbCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy50b29sQm94LmNoaWxkKCcuZnVsbHNjcmVlbi1idXR0b24nKS50dXJuT2ZmID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykuYWRkQ2xhc3MoJ2ljb24tZXhwYW5kJyk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkKCdpJykucmVtb3ZlQ2xhc3MoJ2ljb24tY29tcHJlc3MnKTtcblxuICAgICAgICAgICAgdGhhdC5mdWxsU2NyZWVuID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC5zcGxpdCddIHx8IDApID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnRvb2xCb3guY2hpbGQoJy5zcGxpdHNjcmVlbi1idXR0b24nKS50dXJuT24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC50b29sQm94LmNoaWxkKCcuc3BsaXRzY3JlZW4tYnV0dG9uJykudHVybk9mZigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LmhpZGVQcmV2aWV3KCk7XG4gICAgICAgICAgICB0aGF0LnNob3dDb250ZW50KCk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIHRoYXQuY29udGVudE1ELnBhcmVudCgpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdmdWxsc2NyZWVuJyk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yLnNldE9wdGlvbignbWF4TGluZXMnLCBJbmZpbml0eSk7XG5cbiAgICAgICAgICAgIHRoYXQucHJldmlldy5maXhIZWlnaHQoKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAscmVnaXN0ZXJBY2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmVkaXRvciA9IGFjZS5lZGl0KEV4dC5Eb21RdWVyeS5zZWxlY3ROb2RlKCdkaXYuJyArIHRoaXMubWRFbGVtZW50TmFtZSArICdfbWFya2Rvd24nKSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgbWF4TGluZXM6IEluZmluaXR5LFxuICAgICAgICAgICAgbWluTGluZXM6IDI1LFxuICAgICAgICAgICAgZW5hYmxlQmFzaWNBdXRvY29tcGxldGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIHByaW50TWFyZ2luOiBmYWxzZSxcbiAgICAgICAgICAgIHNob3dHdXR0ZXI6IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnNob3dfZ3V0dGVyJ10gfHwgMSkgPT0gMSxcbiAgICAgICAgICAgIGZvbnRTaXplOiBwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC5mb250X3NpemUnXSkgfHwgMTIsXG4gICAgICAgICAgICBmb250RmFtaWx5OiBNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuZ2VuZXJhbC5mb250X2ZhbWlseSddIHx8ICcnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0VXNlV3JhcE1vZGUodHJ1ZSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRXcmFwTGltaXRSYW5nZSgpO1xuICAgICAgICB0aGlzLmVkaXRvci5yZW5kZXJlci5zZXRTY3JvbGxNYXJnaW4oMTAsIDEwKTtcbiAgICAgICAgdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLnNldFZhbHVlKHRoaXMudGV4dGFyZWEuZ2V0VmFsdWUoKSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRNb2RlKFwiYWNlL21vZGUvbWFya2Rvd25lZGl0b3JcIik7XG4gICAgICAgIHRoaXMuZWRpdG9yLnNldFRoZW1lKFwiYWNlL3RoZW1lL1wiICsgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5nZW5lcmFsLnRoZW1lJ10gfHwgJ21vbm9rYWknKSk7XG5cbiAgICAgICAgdGhpcy5lZGl0b3IuY29tbWFuZHMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBuYW1lOiBcInRlc3RcIixcbiAgICAgICAgICAgIGJpbmRLZXk6IHt3aW46IFwiVGFiXCIsIG1hYzogXCJUYWJcIn0sXG4gICAgICAgICAgICBleGVjOiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGluZSA9IGVkaXRvci5zZXNzaW9uLmdldExpbmUoZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93KTtcbiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSAvXihcXHMqKSg/OihbLSsqXSl8KFxcZCspXFwuKShcXHMrKS8uZXhlYyhsaW5lKTtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNlc3Npb24uaW5kZW50Um93cyhlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKS5yb3csIGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLnJvdywgJ1xcdCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5pbmRlbnQoKTtcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgbGFuZ1Rvb2xzID0gYWNlLnJlcXVpcmUoXCJhY2UvZXh0L2xhbmd1YWdlX3Rvb2xzXCIpO1xuICAgICAgICB2YXIgcmVzb3VyY2VzQ29tcGxldGVyID0ge1xuICAgICAgICAgICAgZ2V0Q29tcGxldGlvbnM6IGZ1bmN0aW9uKGVkaXRvciwgc2Vzc2lvbiwgcG9zLCBwcmVmaXgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByZWZpeC5sZW5ndGggPT09IDApIHsgY2FsbGJhY2sobnVsbCwgW10pOyByZXR1cm4gfVxuXG4gICAgICAgICAgICAgICAgTU9EeC5BamF4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IG1hcmtkb3duRWRpdG9yLmNvbmZpZy5jb25uZWN0b3JVcmxcbiAgICAgICAgICAgICAgICAgICAgLHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnbWdyL3Jlc291cmNlL2dldGxpc3QnXG4gICAgICAgICAgICAgICAgICAgICAgICAscHJlZml4OiBwcmVmaXhcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24ocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGxhbmdUb29scy5hZGRDb21wbGV0ZXIocmVzb3VyY2VzQ29tcGxldGVyKTtcblxuICAgICAgICB0aGlzLmVkaXRvci5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbnRlclwiLCB0aGlzLmNhdGNoQW5kRG9Ob3RoaW5nLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgdGhpcy5jYXRjaEFuZERvTm90aGluZywgZmFsc2UpO1xuICAgICAgICB0aGlzLmVkaXRvci5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgdGhpcy5kcm9wLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9XG5cbiAgICAscmVnaXN0ZXJNYXJrZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnJlbWFya2FibGUgPSBuZXcgUmVtYXJrYWJsZSh7XG4gICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgaGlnaGxpZ2h0OiBmdW5jdGlvbiAoc3RyLCBsYW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKGxhbmcgJiYgaGxqcy5nZXRMYW5ndWFnZShsYW5nKSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBobGpzLmhpZ2hsaWdodChsYW5nLCBzdHIpLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcW1xcWy9nLCAnJiM5MTsmIzkxOycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9dXS9nLCAnJiM5MzsmIzkzOycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge31cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGhsanMuaGlnaGxpZ2h0QXV0byhzdHIpLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxbXFxbL2csICcmIzkxOyYjOTE7Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXV0vZywgJyYjOTM7JiM5MzsnKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZW1hcmthYmxlLmlubGluZS5ydWxlci5kaXNhYmxlKFsgJ2JhY2t0aWNrcycgXSk7XG4gICAgfVxuXG4gICAgLHBhcnNlOiBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICB2YXIgb3V0cHV0ID0gdGhpcy5yZW1hcmthYmxlLnJlbmRlcihpbnB1dCk7XG5cbiAgICAgICAgb3V0cHV0ID0gb3V0cHV0LnJlcGxhY2UoLyU1Qi9nLCAnWycpO1xuICAgICAgICBvdXRwdXQgPSBvdXRwdXQucmVwbGFjZSgvJTVEL2csICddJyk7XG5cbiAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5scC5wYXJzZV9tb2R4X3RhZ3MnXSA9PSAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJzZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5wYXJzZVJlcXVlc3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGltZW91dCA9IHBhcnNlSW50KE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci5scC5wYXJzZV9tb2R4X3RhZ3NfdGltZW91dCddIHx8IDMwMCk7XG5cbiAgICAgICAgICAgIHRoaXMucGFyc2VSZXF1ZXN0ID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIE1PRHguQWpheC5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBtYXJrZG93bkVkaXRvci5jb25maWcuY29ubmVjdG9yVXJsXG4gICAgICAgICAgICAgICAgICAgICxwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ21nci9lZGl0b3IvcHJvY2Vzc2NvbnRlbnQnXG4gICAgICAgICAgICAgICAgICAgICAgICAsY29udGVudDogb3V0cHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAscmVzb3VyY2U6IE1PRHgucmVxdWVzdC5pZFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBpc1VwbG9hZCA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3LnVwZGF0ZShyLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKHRoaXMuZnVsbFNjcmVlbiA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCkucm93ICsgMikgPj0gdGhpcy5lZGl0b3IuZ2V0U2Vzc2lvbigpLmdldFNjcmVlbkxlbmd0aCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3LmRvbS5zY3JvbGxUb3AgPSB0aGlzLnByZXZpZXcuZG9tLnNjcm9sbEhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL31cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcuZml4SGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcyksIHRpbWVvdXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3LnVwZGF0ZShvdXRwdXQpO1xuXG4gICAgICAgICAgICAvL2lmICh0aGlzLmZ1bGxTY3JlZW4gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgodGhpcy5lZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKS5yb3cgKyAyKSA+PSB0aGlzLmVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0U2NyZWVuTGVuZ3RoKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3LmRvbS5zY3JvbGxUb3AgPSB0aGlzLnByZXZpZXcuZG9tLnNjcm9sbEhlaWdodFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgdGhpcy5wcmV2aWV3LmZpeEhlaWdodCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50YU1hcmtkb3duLmRvbS52YWx1ZSA9IHRoaXMuZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuZG9tLnZhbHVlID0gb3V0cHV0O1xuXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuXG4gICAgLGNhdGNoQW5kRG9Ob3RoaW5nOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICAsZHJvcDogZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ltYWdlX3VwbG9hZCddID09IDEgfHwgTU9EeC5jb25maWdbJ21hcmtkb3duZWRpdG9yLnVwbG9hZC5lbmFibGVfZmlsZV91cGxvYWQnXSA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZpbGVzKGUuZGF0YVRyYW5zZmVyLmZpbGVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICxoYW5kbGVGaWxlczogZnVuY3Rpb24oZmlsZXMsIG1vYmlsZSkge1xuICAgICAgICBtb2JpbGUgPSBtb2JpbGUgfHwgMDtcblxuICAgICAgICBFeHQuZWFjaChmaWxlcywgZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgdmFyIGlzSW1hZ2UgPSAvXmltYWdlXFwvLy50ZXN0KGZpbGUudHlwZSk7XG5cbiAgICAgICAgICAgIGlmIChpc0ltYWdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ltYWdlX3VwbG9hZCddID09IDApIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrVHlwZShNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLmltYWdlX3R5cGVzJ10sIGZpbGUpKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsTWVzc2FnZShmaWxlLCAnaW1hZ2UnLCBfKCdtYXJrZG93bmVkaXRvci5lcnIudXBsb2FkLnVuc3VwcG9ydGVkX2ltYWdlJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPiBwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLm1heF9zaXplJ10pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbE1lc3NhZ2UoZmlsZSwgJ2ltYWdlJywgXygnbWFya2Rvd25lZGl0b3IuZXJyLnVwbG9hZC50b29fYmlnJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuY3JvcHBlci5lbmFibGVfY3JvcHBlciddID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgTU9EeC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHh0eXBlOiAnbWFya2Rvd25lZGl0b3Itd2luZG93LWNyb3BwZXInXG4gICAgICAgICAgICAgICAgICAgICAgICAsZmlsZTogZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgLG1kOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICAsbW9iaWxlOiBtb2JpbGVcbiAgICAgICAgICAgICAgICAgICAgfSkuc2hvdygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZShmaWxlLCAnaW1hZ2UnLCBtb2JpbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZW5hYmxlX2ZpbGVfdXBsb2FkJ10gPT0gMCkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tUeXBlKE1PRHguY29uZmlnWydtYXJrZG93bmVkaXRvci51cGxvYWQuZmlsZV90eXBlcyddLCBmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxNZXNzYWdlKGZpbGUsICdmaWxlJywgXygnbWFya2Rvd25lZGl0b3IuZXJyLnVwbG9hZC51bnN1cHBvcnRlZF9maWxlJykpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPiBwYXJzZUludChNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IudXBsb2FkLm1heF9zaXplJ10pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbE1lc3NhZ2UoZmlsZSwgJ2ZpbGUnLCBfKCdtYXJrZG93bmVkaXRvci5lcnIudXBsb2FkLnRvb19iaWcnKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRGaWxlKGZpbGUsICdmaWxlJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG5cbiAgICAsY2hlY2tUeXBlOiBmdW5jdGlvbihhbGxvd2VkVHlwZXMsIGZpbGUpIHtcbiAgICAgICAgYWxsb3dlZFR5cGVzID0gYWxsb3dlZFR5cGVzLnNwbGl0KCcsJyk7XG5cbiAgICAgICAgcmV0dXJuIGFsbG93ZWRUeXBlcy5pbmRleE9mKGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpKSAhPSAtMTtcbiAgICB9XG5cbiAgICAsdXBsb2FkRmlsZTogZnVuY3Rpb24oZmlsZSwgdHlwZSwgbW9iaWxlKSB7XG4gICAgICAgIHR5cGUgPSB0eXBlIHx8ICdmaWxlJztcbiAgICAgICAgbW9iaWxlID0gbW9iaWxlIHx8IDA7XG5cbiAgICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcy5jcmVhdGVVcGxvYWRlcigpO1xuXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdhY3Rpb24nLCAnbWdyL2VkaXRvci8nICsgdHlwZSArICd1cGxvYWQnKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1lJywgZmlsZS5uYW1lKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdyZXNvdXJjZScsIHRoaXMuY29uZmlnLnJlc291cmNlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtb2JpbGUnLCBtb2JpbGUpO1xuXG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9wZW4oJ1BPU1QnLCBtYXJrZG93bkVkaXRvci5jb25maWcuY29ubmVjdG9yVXJsKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1Bvd2VyZWQtQnknLCAnTU9EeCcpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignbW9kQXV0aCcsIEV4dC5BamF4LmRlZmF1bHRIZWFkZXJzLm1vZEF1dGgpO1xuXG4gICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50Lmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGUgPSAoZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDAgfCAwKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlci5jaGlsZCgnLnByb2dyZXNzJykuc2V0V2lkdGgoY29tcGxldGUgKyAnJScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlUHJlZml4ID0gKHR5cGUgPT0gJ2ltYWdlJykgPyAnIScgOiAnJztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZExpbmUgPSAodHlwZSA9PSAnaW1hZ2UnKSA/ICdcXG5cXG4nIDogJ1xcbic7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmluc2VydChpbWFnZVByZWZpeCArICdbJyArIHJlcy5vYmplY3QubmFtZSArICddKCcgKyByZXMub2JqZWN0LnBhdGggKyAnIFwiJyArIHJlcy5vYmplY3QubmFtZSArICdcIiknICsgZW5kTGluZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsVXBsb2FkZXIodXBsb2FkZXIsIHJlcy5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICB4aHIuc2VuZChmb3JtRGF0YSk7XG4gICAgfVxuXG4gICAgLGNyZWF0ZVVwbG9hZGVyOiBmdW5jdGlvbih0eXBlLCBmaWxlTmFtZSkge1xuICAgICAgICB2YXIgdXBsb2FkZXIgPSBFeHQuRG9tSGVscGVyLmluc2VydEZpcnN0KHRoaXMuc3RhdHVzQmFyLHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBodG1sOiAnPGRpdiBjbGFzcz1cInByb2dyZXNzXCI+PGkgY2xhc3M9XCJpY29uIGljb24tc3Bpbm5lciBpY29uLXNwaW5cIj48L2k+IDxzcGFuPicgKyBfKCdtYXJrZG93bmVkaXRvci51cGxvYWRpbmdfJyArIHR5cGUpICsgZmlsZU5hbWUgKyAnPC9zcGFuPjwvZGl2PidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIEV4dC5nZXQodXBsb2FkZXIpO1xuICAgIH1cblxuICAgICxmYWlsVXBsb2FkZXI6IGZ1bmN0aW9uKHVwbG9hZGVyLCBtZXNzYWdlKSB7XG4gICAgICAgIHVwbG9hZGVyLmNoaWxkKCcucHJvZ3Jlc3MnKS5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJy5wcm9ncmVzcycpLnNldFdpZHRoKCcxMDAlJyk7XG5cbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJ2knKS5hZGRDbGFzcygncmVtb3ZlLW1lc3NhZ2UnKTtcbiAgICAgICAgdXBsb2FkZXIuY2hpbGQoJ2knKS5yZXBsYWNlQ2xhc3MoJ2ljb24tc3Bpbm5lcicsICdpY29uLXJlbW92ZScpO1xuICAgICAgICB1cGxvYWRlci5jaGlsZCgnaScpLnJlbW92ZUNsYXNzKCdpY29uLXNwaW4nKTtcblxuICAgICAgICB1cGxvYWRlci5jaGlsZCgnc3BhbicpLmRvbS5pbm5lckhUTUwgKz0gJyBmYWlsZWQuICcgKyBtZXNzYWdlO1xuICAgICAgICB1cGxvYWRlci5jaGlsZCgnLnJlbW92ZS1tZXNzYWdlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLGZhaWxNZXNzYWdlOiBmdW5jdGlvbihmaWxlLCB0eXBlLCBtZXNzYWdlKSB7XG4gICAgICAgIHZhciB1cGxvYWRlciA9IHRoaXMuY3JlYXRlVXBsb2FkZXIodHlwZSwgZmlsZS5uYW1lKTtcbiAgICAgICAgdGhpcy5mYWlsVXBsb2FkZXIodXBsb2FkZXIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgICxpc01vYmlsZURldmljZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIHdpbmRvdy5vcmllbnRhdGlvbiAhPT0gXCJ1bmRlZmluZWRcIikgfHwgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignSUVNb2JpbGUnKSAhPT0gLTEpO1xuICAgIH1cbn0pO1xuXG5NT0R4LmxvYWRSVEUgPSBmdW5jdGlvbihpZCkge1xuICAgIG5ldyBtYXJrZG93bkVkaXRvci5FZGl0b3Ioe1xuICAgICAgICBtZEVsZW1lbnRJZDogaWRcbiAgICB9KTtcbn07XG5cbk1PRHguYWZ0ZXJUVkxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWxzID0gRXh0LnF1ZXJ5KCd0ZXh0YXJlYS5tb2R4LXJpY2h0ZXh0Jyk7XG5cbiAgICBFeHQuZWFjaChlbHMsIGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICBlbGVtZW50ID0gRXh0LmdldChlbGVtZW50KTtcbiAgICAgICAgaWYgKCFlbGVtZW50KSByZXR1cm4gdHJ1ZTtcblxuICAgICAgICBpZiAobWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHNbZWxlbWVudC5pZF0pIHJldHVybiB0cnVlO1xuXG4gICAgICAgIG1hcmtkb3duRWRpdG9yLmxvYWRlZEVsZW1lbnRzW2VsZW1lbnQuaWRdID0gbmV3IG1hcmtkb3duRWRpdG9yLkVkaXRvcih7XG4gICAgICAgICAgICBtZEVsZW1lbnRJZDogZWxlbWVudC5pZFxuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG59O1xuXG5NT0R4LnVubG9hZFRWUlRFID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVscyA9IEV4dC5xdWVyeSgnLm1vZHgtcmljaHRleHQnKTtcblxuICAgIEV4dC5lYWNoKGVscywgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSBFeHQuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmICghbWFya2Rvd25FZGl0b3IubG9hZGVkRWxlbWVudHNbZWxlbWVudC5pZF0pIHJldHVybiB0cnVlO1xuXG4gICAgICAgIG1hcmtkb3duRWRpdG9yLmxvYWRlZEVsZW1lbnRzW2VsZW1lbnQuaWRdLmRlc3Ryb3koKTtcblxuICAgIH0pO1xufTsiLCJtYXJrZG93bkVkaXRvci53aW5kb3cuQ3JvcHBlciA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbiAgICBjb25maWcuY3JvcHBlclNlbGVjdG9yID0gY29uZmlnLmNyb3BwZXJTZWxlY3RvciB8fCAnLmltYWdlLXVwbG9hZC13cmFwcGVyID4gaW1nJztcblxuICAgIEV4dC5hcHBseUlmKGNvbmZpZyx7XG4gICAgICAgIG1vZGFsOiBmYWxzZVxuICAgICAgICAsbGF5b3V0OiAnYXV0bydcbiAgICAgICAgLGNsb3NlQWN0aW9uOiAnaGlkZSdcbiAgICAgICAgLHNoYWRvdzogdHJ1ZVxuICAgICAgICAscmVzaXphYmxlOiB0cnVlXG4gICAgICAgICxjb2xsYXBzaWJsZTogdHJ1ZVxuICAgICAgICAsbWF4aW1pemFibGU6IGZhbHNlXG4gICAgICAgICxhdXRvSGVpZ2h0OiBmYWxzZVxuICAgICAgICAsYXV0b1Njcm9sbDogdHJ1ZVxuICAgICAgICAsYWxsb3dEcm9wOiB0cnVlXG4gICAgICAgICx3aWR0aDogODAwXG4gICAgICAgICxtb2JpbGU6IDBcbiAgICAgICAgLHRpdGxlOiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLmNyb3BfaW1hZ2UnKVxuICAgICAgICAsY2xzOiAnbW9keC13aW5kb3cnXG4gICAgICAgICxodG1sOiAnPGRpdiBjbGFzcz1cImltYWdlLXVwbG9hZC13cmFwcGVyXCI+PGltZyBzcmM9XCInICsgVVJMLmNyZWF0ZU9iamVjdFVSTChjb25maWcuZmlsZSkgKyAnXCI+PC9kaXY+J1xuICAgICAgICAsdGJhcjogW3tcbiAgICAgICAgICAgIHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1hcnJvd3NcIj48L2k+ICcgKyBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLm1vdmUnKVxuICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAscGFyYW06ICdtb3ZlJ1xuICAgICAgICAgICAgLGFjdGlvbjogJ3NldERyYWdNb2RlJ1xuICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2FsbENyb3BwZXJBY3Rpb25cbiAgICAgICAgfSx7XG4gICAgICAgICAgICB0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tY3JvcFwiPjwvaT4gJyArIF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuY3JvcCcpXG4gICAgICAgICAgICAsc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICxwYXJhbTogJ2Nyb3AnXG4gICAgICAgICAgICAsYWN0aW9uOiAnc2V0RHJhZ01vZGUnXG4gICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICB9LHtcbiAgICAgICAgICAgIHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1zZWFyY2gtcGx1c1wiPjwvaT4gJyArIF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuem9vbV9pbicpXG4gICAgICAgICAgICAsc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICxwYXJhbTogMC4xXG4gICAgICAgICAgICAsYWN0aW9uOiAnem9vbSdcbiAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgIH0se1xuICAgICAgICAgICAgdGV4dDogJzxpIGNsYXNzPVwiaWNvbiBpY29uLXNlYXJjaC1taW51c1wiPjwvaT4gJyArIF8oJ21hcmtkb3duZWRpdG9yLmNyb3BwZXIuem9vbV9vdXQnKVxuICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAscGFyYW06IC0wLjFcbiAgICAgICAgICAgICxhY3Rpb246ICd6b29tJ1xuICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2FsbENyb3BwZXJBY3Rpb25cbiAgICAgICAgfSx7XG4gICAgICAgICAgICB0ZXh0OiAnPGkgY2xhc3M9XCJpY29uIGljb24tcm90YXRlLWxlZnRcIj48L2k+ICcgKyBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnJvdGF0ZV9sZWZ0JylcbiAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgLHBhcmFtOiAtOTBcbiAgICAgICAgICAgICxhY3Rpb246ICdyb3RhdGUnXG4gICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICB9LHtcbiAgICAgICAgICAgIHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1yb3RhdGUtcmlnaHRcIj48L2k+ICcgKyBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnJvdGF0ZV9yaWdodCcpXG4gICAgICAgICAgICAsc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICxwYXJhbTogOTBcbiAgICAgICAgICAgICxhY3Rpb246ICdyb3RhdGUnXG4gICAgICAgICAgICAsaGFuZGxlcjogdGhpcy5jYWxsQ3JvcHBlckFjdGlvblxuICAgICAgICB9LHtcbiAgICAgICAgICAgIHRleHQ6ICc8aSBjbGFzcz1cImljb24gaWNvbi1yZW1vdmVcIj48L2k+ICcgKyBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLmNsZWFyX2Nyb3BwZXInKVxuICAgICAgICAgICAgLHNjb3BlOiB0aGlzXG4gICAgICAgICAgICAscGFyYW06IG51bGxcbiAgICAgICAgICAgICxhY3Rpb246ICdjbGVhcidcbiAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLmNhbGxDcm9wcGVyQWN0aW9uXG4gICAgICAgIH1dXG4gICAgICAgICxidXR0b25zOiBbe1xuICAgICAgICAgICAgdGV4dDogXygnY2FuY2VsJylcbiAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgLGhhbmRsZXI6IHRoaXMuY2xvc2VcbiAgICAgICAgfSx7XG4gICAgICAgICAgICB0ZXh0OiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLnVwbG9hZCcpXG4gICAgICAgICAgICAsY2xzOiAncHJpbWFyeS1idXR0b24nXG4gICAgICAgICAgICAsc2NvcGU6IHRoaXNcbiAgICAgICAgICAgICxjcm9wOiAwXG4gICAgICAgICAgICAsaGFuZGxlcjogdGhpcy51cGxvYWRcbiAgICAgICAgfSx7XG4gICAgICAgICAgICB0ZXh0OiBfKCdtYXJrZG93bmVkaXRvci5jcm9wcGVyLmNyb3BfdXBsb2FkJylcbiAgICAgICAgICAgICxjbHM6ICdwcmltYXJ5LWJ1dHRvbidcbiAgICAgICAgICAgICxzY29wZTogdGhpc1xuICAgICAgICAgICAgLGNyb3A6IDFcbiAgICAgICAgICAgICxoYW5kbGVyOiB0aGlzLnVwbG9hZFxuICAgICAgICB9XVxuICAgICAgICAsbGlzdGVuZXJzOiB7XG4gICAgICAgICAgICAnc2hvdyc6IHtcbiAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjcm9wcGVyT3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjcm9wcGVyRWwgPSAkKCcjJyArIHRoaXMuaWQgKyAnICcgKyBjb25maWcuY3JvcHBlclNlbGVjdG9yKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmF0aW8gPSBNT0R4LmNvbmZpZ1snbWFya2Rvd25lZGl0b3IuY3JvcHBlci5hc3BlY3RfcmF0aW8nXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJhdGlvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRpby5yZXBsYWNlKC9bXi06eCgpXFxkLyorLl0vZywgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmF0aW8gPSBldmFsKHJhdGlvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY3JvcHBlck9wdGlvbnMuYXNwZWN0UmF0aW8gPSByYXRpbztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNyb3BwZXJPcHRpb25zLmNyb3AgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZURhdGEgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3tcInhcIjonICsgZGF0YS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcInlcIjonICsgZGF0YS55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcImhlaWdodFwiOicgKyBkYXRhLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXCJ3aWR0aFwiOicgKyBkYXRhLndpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcInJvdGF0ZVwiOicgKyBkYXRhLnJvdGF0ZSArICd9J1xuICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjcm9wcGVyRWwuY3JvcHBlcihjcm9wcGVyT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzY29wZTogdGhpc1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgbWFya2Rvd25FZGl0b3Iud2luZG93LkNyb3BwZXIuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsY29uZmlnKTtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcblxufTtcbkV4dC5leHRlbmQobWFya2Rvd25FZGl0b3Iud2luZG93LkNyb3BwZXIsIEV4dC5XaW5kb3cse1xuICAgIGltYWdlRGF0YTogJydcbiAgICAsdXBsb2FkOiBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcy5jb25maWcubWQuY3JlYXRlVXBsb2FkZXIoJ2ltYWdlJywgdGhpcy5jb25maWcuZmlsZS5uYW1lKTtcblxuICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgdGhpcy5jb25maWcuZmlsZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnYWN0aW9uJywgJ21nci9lZGl0b3IvaW1hZ2V1cGxvYWQnKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdpbWFnZURhdGEnLCB0aGlzLmltYWdlRGF0YSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbmFtZScsIHRoaXMuY29uZmlnLmZpbGUubmFtZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnY3JvcCcsIGJ1dHRvbi5jcm9wKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdyZXNvdXJjZScsIHRoaXMuY29uZmlnLm1kLmNvbmZpZy5yZXNvdXJjZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbW9iaWxlJywgdGhpcy5jb25maWcubW9iaWxlKTtcblxuICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci5vcGVuKCdQT1NUJywgbWFya2Rvd25FZGl0b3IuY29uZmlnLmNvbm5lY3RvclVybCk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdQb3dlcmVkLUJ5JywgJ01PRHgnKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ21vZEF1dGgnLCBFeHQuQWpheC5kZWZhdWx0SGVhZGVycy5tb2RBdXRoKTtcblxuICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5sZW5ndGhDb21wdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbXBsZXRlID0gKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsICogMTAwIHwgMCk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXIuY2hpbGQoJy5wcm9ncmVzcycpLnNldFdpZHRoKGNvbXBsZXRlICsgJyUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWQuZWRpdG9yLmluc2VydCgnIVsnICsgcmVzLm9iamVjdC5uYW1lICsgJ10oJyArIHJlcy5vYmplY3QucGF0aCArICcgXCInICsgcmVzLm9iamVjdC5uYW1lICsgJ1wiKVxcblxcbicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLm1kLmZhaWxVcGxvYWRlcih1cGxvYWRlciwgcmVzLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcblxuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgLGNhbGxDcm9wcGVyQWN0aW9uOiBmdW5jdGlvbihidG4pIHtcbiAgICAgICAgdGhpcy4kY3JvcHBlckVsLmNyb3BwZXIoYnRuLmFjdGlvbiwgYnRuLnBhcmFtKTtcbiAgICB9XG5cbiAgICAsY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLiRjcm9wcGVyRWwuY3JvcHBlcihcImRlc3Ryb3lcIik7XG5cbiAgICAgICAgbWFya2Rvd25FZGl0b3Iud2luZG93LkNyb3BwZXIuc3VwZXJjbGFzcy5jbG9zZS5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLmNvbmZpZy5tZC5lZGl0b3IuZm9jdXMoKTtcbiAgICB9XG59KTtcbkV4dC5yZWcoJ21hcmtkb3duZWRpdG9yLXdpbmRvdy1jcm9wcGVyJyxtYXJrZG93bkVkaXRvci53aW5kb3cuQ3JvcHBlcik7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=